{
  Map<Object,V> entriesToUpdate=new HashMap<Object,V>();
  for (  Map.Entry<Object,V> entry : concurrentHashMap.entrySet()) {
    if (transformer != null) {
      Collection<OIdentifiable> rids=transformer.transformFromValue(entry.getValue());
      if (rids.remove(valueToRemove))       entriesToUpdate.put(entry.getKey(),transformer.transformToValue(rids));
    }
 else     if (entry.getValue().equals(valueToRemove))     entriesToUpdate.put(entry.getKey(),entry.getValue());
  }
  for (  Map.Entry<Object,V> entry : entriesToUpdate.entrySet()) {
    V value=entry.getValue();
    if (value instanceof Collection) {
      Collection col=(Collection)value;
      if (col.isEmpty())       concurrentHashMap.remove(entry.getKey());
 else       concurrentHashMap.put(entry.getKey(),value);
    }
 else     concurrentHashMap.remove(entry.getKey());
  }
  return entriesToUpdate.size();
}
