{
  this((ORecordId)record.getIdentity(),record.toStream(),record.getVersion() - 1,ORecordInternal.getRecordType(record));
  if (rid.getClusterId() == ORID.CLUSTER_ID_INVALID) {
    final OClass clazz;
    if (record instanceof ODocument && (clazz=ODocumentInternal.getImmutableSchemaClass((ODocument)record)) != null) {
      clusterId=clazz.getClusterSelection().getCluster(clazz,(ODocument)record);
    }
 else {
      ODatabaseDocumentInternal db=ODatabaseRecordThreadLocal.INSTANCE.get();
      clusterId=db.getDefaultClusterId();
    }
  }
}
