{
  acquireSharedLock();
  try {
    long size=fileSegment.getFilledUpTo();
    final OClusterEntryIterator it=absoluteIterator();
    final OPhysicalPosition pos=new OPhysicalPosition();
    while (it.hasNext()) {
      pos.clusterPosition=OClusterPositionFactory.INSTANCE.valueOf(it.next());
      getPhysicalPosition(pos);
      if (pos.dataSegmentPos > -1 && pos.recordVersion > -1)       size+=storage.getDataSegmentById(pos.dataSegmentId).getRecordSize(pos.dataSegmentPos);
    }
    return size;
  }
 catch (  IOException e) {
    throw new OIOException("Error on calculating cluster size for: " + getName(),e);
  }
 finally {
    releaseSharedLock();
  }
}
