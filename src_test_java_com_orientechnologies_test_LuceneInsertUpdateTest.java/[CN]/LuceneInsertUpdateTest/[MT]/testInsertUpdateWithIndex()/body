{
  databaseDocumentTx=new ODatabaseDocumentTx(url);
  if (!url.contains("remote:") && databaseDocumentTx.exists()) {
    databaseDocumentTx.open("admin","admin");
    databaseDocumentTx.drop();
    databaseDocumentTx.create();
  }
 else {
    databaseDocumentTx.create();
  }
  OSchema schema=databaseDocumentTx.getMetadata().getSchema();
  if (schema.getClass("City") == null) {
    OClass oClass=schema.createClass("City");
    oClass.createProperty("name",OType.STRING);
    oClass.createIndex("City.name","FULLTEXT",null,null,"LUCENE",new String[]{"name"});
  }
  ODocument doc=new ODocument("City");
  doc.field("name","Rome");
  databaseDocumentTx.save(doc);
  OIndex idx=schema.getClass("City").getClassIndex("City.name");
  Collection<?> coll=(Collection<?>)idx.get("Rome");
  Assert.assertEquals(coll.size(),1);
  doc=databaseDocumentTx.load((ORID)coll.iterator().next());
  Assert.assertEquals(doc.field("name"),"Rome");
  doc.field("name","London");
  databaseDocumentTx.save(doc);
  coll=(Collection<?>)idx.get("Rome");
  Assert.assertEquals(coll.size(),0);
  coll=(Collection<?>)idx.get("London");
  Assert.assertEquals(coll.size(),1);
  doc=databaseDocumentTx.load((ORID)coll.iterator().next());
  Assert.assertEquals(doc.field("name"),"London");
  doc.field("name","Berlin");
  databaseDocumentTx.save(doc);
  coll=(Collection<?>)idx.get("Rome");
  Assert.assertEquals(coll.size(),0);
  coll=(Collection<?>)idx.get("London");
  Assert.assertEquals(coll.size(),0);
  coll=(Collection<?>)idx.get("Berlin");
  Assert.assertEquals(coll.size(),1);
  databaseDocumentTx.drop();
}
