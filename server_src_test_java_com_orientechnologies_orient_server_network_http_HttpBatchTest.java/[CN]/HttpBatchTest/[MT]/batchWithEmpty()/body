{
  String json="{\n" + "\"operations\": [{\n" + "\"type\": \"script\",\n"+ "\"language\": \"SQL\","+ "\"script\": \"let $a = select from User limit 2 \\n"+ "let $b = select sum(foo) from (select from User where name = foo) \\n"+ "return [$a, $b]\""+ "}]\n"+ "}";
  System.out.println(json);
  HttpResponse response=post("batch/" + getDatabaseName()).payload(json,CONTENT.TEXT).getResponse();
  Assert.assertEquals(response.getStatusLine().getStatusCode(),200);
  InputStream stream=response.getEntity().getContent();
  ODocument doc=new ODocument();
  doc.fromJSON(stream);
  stream.close();
  Iterable iterable=doc.field("result");
  Iterator iterator=iterable.iterator();
  Assert.assertTrue(iterator.hasNext());
  iterator.next();
  Assert.assertTrue(iterator.hasNext());
  Object emptyList=iterator.next();
  Assert.assertNotNull(emptyList);
  Assert.assertTrue(emptyList instanceof Iterable);
  Iterator emptyListIterator=((Iterable)emptyList).iterator();
  Assert.assertFalse(emptyListIterator.hasNext());
}
