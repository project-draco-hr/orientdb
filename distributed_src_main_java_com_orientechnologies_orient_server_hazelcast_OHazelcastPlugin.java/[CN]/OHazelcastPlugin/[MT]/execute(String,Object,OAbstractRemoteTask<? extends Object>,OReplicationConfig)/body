{
  String masterNodeId=null;
  try {
    if (replicationData == null) {
      ODistributedThreadLocal.INSTANCE.set(iTask.getNodeSource());
      try {
        return ((OAbstractRemoteTask<? extends Object>)iTask).executeOnLocalNode();
      }
  finally {
        ODistributedThreadLocal.INSTANCE.set(null);
      }
    }
 else {
      if (!checkOperationSequence(iTask))       return null;
      final String dbName=iTask.getDatabaseName();
      if (replicationData != null) {
        iTask.setNodeDestination(replicationData.masterNode);
        replicationData.masterNode=waitUntilMasterNodeIsOnline(iClusterName,iKey,dbName,replicationData.masterNode);
        masterNodeId=replicationData.masterNode;
      }
      if (getLocalNodeId().equals(replicationData.masterNode))       return executeLocallyAndPropagate((OAbstractReplicatedTask<? extends Object>)iTask);
 else       return executeRemotelyAndApplyLocally(iClusterName,iKey,(OAbstractReplicatedTask<? extends Object>)iTask,dbName,replicationData);
    }
  }
 catch (  InterruptedException e) {
    Thread.interrupted();
  }
catch (  Exception e) {
    ODistributedServerLog.error(this,getLocalNodeId(),masterNodeId,DIRECTION.OUT,"error on execution %d.%d of operation in %s mode",e,iTask.getRunId(),iTask.getOperationSerial(),EXECUTION_MODE.SYNCHRONOUS);
    throw new ExecutionException("error on execution of operation " + iTask.getRunId() + "."+ iTask.getOperationSerial()+ " in "+ EXECUTION_MODE.SYNCHRONOUS+ " mode against node "+ masterNodeId,e);
  }
  return null;
}
