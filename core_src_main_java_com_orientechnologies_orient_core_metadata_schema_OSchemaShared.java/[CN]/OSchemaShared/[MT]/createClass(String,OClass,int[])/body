{
  getDatabase().checkSecurity(ODatabaseSecurityResources.SCHEMA,ORole.PERMISSION_CREATE);
  final String key=iClassName.toLowerCase();
  rwLock.writeLock().lock();
  try {
    if (classes.containsKey(key))     throw new OSchemaException("Class " + iClassName + " already exists in current database");
    checkClustersAreAbsent(iClusterIds);
    final StringBuilder cmd=new StringBuilder("create class ");
    cmd.append(iClassName);
    if (iSuperClass != null) {
      cmd.append(" extends ");
      cmd.append(iSuperClass.getName());
    }
    if (iClusterIds != null) {
      if (iClusterIds.length == 1 && iClusterIds[0] == -1)       cmd.append(" abstract");
 else {
        cmd.append(" cluster ");
        for (int i=0; i < iClusterIds.length; ++i) {
          if (i > 0)           cmd.append(',');
 else           cmd.append(' ');
          cmd.append(iClusterIds[i]);
        }
      }
    }
    getDatabase().command(new OCommandSQL(cmd.toString())).execute();
    if (!(getDatabase().getStorage() instanceof OStorageEmbedded))     getDatabase().reload();
    if (classes.containsKey(key))     return classes.get(key);
 else     createClassInternal(iClassName,iSuperClass,iClusterIds);
    OClass cls=classes.get(key);
    addClusterClassMap(cls);
    return cls;
  }
  finally {
    rwLock.writeLock().unlock();
  }
}
