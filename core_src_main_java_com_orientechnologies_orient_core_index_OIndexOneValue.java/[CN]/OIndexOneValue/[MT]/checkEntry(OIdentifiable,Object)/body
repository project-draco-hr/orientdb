{
  checkForRebuild();
  key=getCollatingValue(key);
  final OIdentifiable indexedRID=get(key);
  if (indexedRID != null && !indexedRID.getIdentity().equals(iRecord.getIdentity())) {
    String storageType=getDatabase().getStorage().getType();
    if (storageType.equals(OEngineMemory.NAME) || storageType.equals(OEngineLocal.NAME)) {
      final OTransactionIndexChanges indexChanges=ODatabaseRecordThreadLocal.INSTANCE.get().getTransaction().getIndexChanges(getName());
      if (indexChanges != null) {
        final OTransactionIndexChangesPerKey keyChanges=indexChanges.getChangesPerKey(key);
        if (keyChanges != null) {
          for (          OTransactionIndexChangesPerKey.OTransactionIndexEntry entry : keyChanges.entries) {
            if (entry.operation == OTransactionIndexChanges.OPERATION.REMOVE)             return;
          }
        }
      }
    }
    OLogManager.instance().exception("Cannot index record %s: found duplicated key '%s' in index '%s' previously assigned to the record %s",null,OIndexException.class,key,iRecord,indexedRID);
  }
}
