{
  if (info == null || info.getPersistenceUnitName() == null) {
    throw new IllegalStateException("Name of the persistence unit should not be null");
  }
synchronized (info) {
    if (map != null && !map.isEmpty()) {
      info.getProperties().putAll(map);
    }
    return new OJPAEntityManagerFactory((OJPAProperties)info.getProperties());
  }
}
