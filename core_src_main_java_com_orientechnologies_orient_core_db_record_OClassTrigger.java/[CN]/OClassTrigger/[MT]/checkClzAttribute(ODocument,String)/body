{
  final OClass clz=iDocument.getImmutableSchemaClass();
  if (clz != null && clz.isSubClassOf(CLASSNAME)) {
    OFunction func=null;
    String fieldName=((OClassImpl)clz).getCustom(attr);
    OClass superClz=clz.getSuperClass();
    while (fieldName == null || fieldName.length() == 0) {
      if (superClz == null || superClz.getName().equals(CLASSNAME))       break;
      fieldName=((OClassImpl)superClz).getCustom(attr);
      superClz=superClz.getSuperClass();
    }
    if (fieldName != null && fieldName.length() > 0) {
      final Object[] clzMethod=this.checkMethod(fieldName);
      if (clzMethod != null)       return clzMethod;
      func=ODatabaseRecordThreadLocal.INSTANCE.get().getMetadata().getFunctionLibrary().getFunction(fieldName);
      if (func == null) {
        if (OStringSerializerHelper.contains(fieldName,ORID.SEPARATOR)) {
          try {
            ODocument funcDoc=ODatabaseRecordThreadLocal.INSTANCE.get().load(new ORecordId(fieldName));
            if (funcDoc != null) {
              func=ODatabaseRecordThreadLocal.INSTANCE.get().getMetadata().getFunctionLibrary().getFunction((String)funcDoc.field("name"));
            }
          }
 catch (          Exception ex) {
            OLogManager.instance().error(this,"illegal record id : ",ex.getMessage());
          }
        }
      }
    }
 else {
      final Object funcProp=iDocument.field(attr);
      if (funcProp != null) {
        final String funcName=funcProp instanceof ODocument ? (String)((ODocument)funcProp).field("name") : funcProp.toString();
        func=ODatabaseRecordThreadLocal.INSTANCE.get().getMetadata().getFunctionLibrary().getFunction(funcName);
      }
    }
    return func;
  }
  return null;
}
