{
  if (iLinked == null)   return null;
  OIdentifiable resultRid=null;
  ORID rid;
  if (iLinked instanceof ORID) {
    rid=(ORID)iLinked;
    if (rid.isValid() && rid.isNew()) {
      throw new ODatabaseException("Impossible save a record during serialization");
    }
    resultRid=rid;
  }
 else {
    if (iLinked instanceof String)     iLinked=new ORecordId((String)iLinked);
 else     if (!(iLinked instanceof ORecord)) {
      final String boundDocumentField=OObjectSerializerHelperManager.getInstance().getDocumentBoundField(iLinked.getClass());
      if (boundDocumentField != null)       iLinked=OObjectSerializerHelperManager.getInstance().getFieldValue(iLinked,boundDocumentField);
    }
    if (!(iLinked instanceof OIdentifiable))     throw new IllegalArgumentException("Invalid object received. Expected a OIdentifiable but received type=" + iLinked.getClass().getName() + " and value="+ iLinked);
    ORecord iLinkedRecord=((OIdentifiable)iLinked).getRecord();
    rid=iLinkedRecord.getIdentity();
    if ((rid.isNew() && !rid.isTemporary()) || iLinkedRecord.isDirty()) {
      throw new ODatabaseException("Impossible save a record during  serialization");
    }
    final ODatabaseDocument database=ODatabaseRecordThreadLocal.INSTANCE.get();
    if (iParentRecord != null) {
      if (!database.isRetainRecords())       resultRid=iLinkedRecord.getIdentity();
    }
  }
  if (rid.isValid())   rid.toString(buffer);
  return resultRid;
}
