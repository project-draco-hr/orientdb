{
  if (!rid.isPersistent())   return null;
  final ODistributedRequestId localReqId=new ODistributedRequestId(dManager.getLocalNodeId(),dManager.getNextMessageIdCounter());
  final ODistributedRequestId lockHolder=localDistributedDatabase.lockRecord(rid,localReqId);
  if (lockHolder != null)   throw new ODistributedRecordLockedException(rid,lockHolder);
  if (eventListener != null) {
    try {
      eventListener.onAfterRecordLock(rid);
    }
 catch (    Throwable t) {
      ODistributedServerLog.error(this,dManager.getLocalNodeName(),null,ODistributedServerLog.DIRECTION.NONE,"Caught exception during ODistributedStorageEventListener.onAfterRecordLock",t);
    }
  }
  return localReqId;
}
