{
  if (cls.isAbstract())   throw new IllegalArgumentException("Cannot create a new instance of abstract class");
  final ODatabaseDocument db=ODatabaseRecordThreadLocal.INSTANCE.get();
  final int[] clusterIds=cls.getClusterIds();
  final List<String> clusterNames=new ArrayList<String>(clusterIds.length);
  for (  int c : clusterIds)   clusterNames.add(db.getClusterNameById(c));
  ODistributedConfiguration cfg=manager.getDatabaseConfiguration(databaseName);
  final String bestCluster=cfg.getLocalCluster(clusterNames,nodeName);
  if (bestCluster == null)   throw new OException("Cannot find best cluster for class '" + cls.getName() + "'. ClusterStrategy="+ getName());
  bestClusterId=db.getClusterIdByName(bestCluster);
}
