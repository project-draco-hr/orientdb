{
  if (iExclusiveLock)   messageManagementLock.writeLock().lock();
 else   messageManagementLock.readLock().lock();
  final AtomicBoolean acquiredMessageManagementLock=new AtomicBoolean(true);
  try {
    final Callable<Void> unlockCallback=new Callable<Void>(){
      @Override public Void call() throws Exception {
        if (acquiredMessageManagementLock.compareAndSet(true,false))         if (iExclusiveLock)         messageManagementLock.writeLock().unlock();
 else         messageManagementLock.readLock().unlock();
        return null;
      }
    }
;
    return callback.call(unlockCallback);
  }
  finally {
    if (acquiredMessageManagementLock.compareAndSet(true,false))     if (iExclusiveLock)     messageManagementLock.writeLock().unlock();
 else     messageManagementLock.readLock().unlock();
  }
}
