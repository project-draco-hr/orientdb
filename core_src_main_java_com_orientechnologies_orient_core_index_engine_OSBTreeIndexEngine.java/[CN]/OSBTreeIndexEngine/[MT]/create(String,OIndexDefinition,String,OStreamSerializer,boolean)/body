{
  acquireExclusiveLock();
  try {
    final OBinarySerializer keySerializer=determineKeySerializer(indexDefinition);
    final int keySize=determineKeySize(indexDefinition);
    final ORecordBytes identityRecord=new ORecordBytes();
    ODatabaseDocumentInternal database=getDatabase();
    final OAbstractPaginatedStorage storageLocalAbstract=(OAbstractPaginatedStorage)database.getStorage().getUnderlying();
    database.save(identityRecord,clusterIndexName);
    identity=identityRecord.getIdentity();
    sbTree.create(indexName,keySerializer,(OBinarySerializer<V>)valueSerializer,indexDefinition != null ? indexDefinition.getTypes() : null,storageLocalAbstract,keySize,indexDefinition != null && !indexDefinition.isNullValuesIgnored());
  }
  finally {
    releaseExclusiveLock();
  }
}
