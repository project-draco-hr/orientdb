{
  final long timer=Orient.instance().getProfiler().startChrono();
  lock.acquireExclusiveLock();
  try {
    if (status != STATUS.CLOSED) {
      if (getUsers() > 0) {
        while (removeUser() > 0)         ;
      }
    }
    doClose(true,true);
    try {
      Orient.instance().unregisterStorage(this);
    }
 catch (    Exception e) {
      OLogManager.instance().error(this,"Cannot unregister storage",e);
    }
    if (writeAheadLog != null)     writeAheadLog.delete();
    if (diskCache != null)     diskCache.delete();
    postDeleteSteps();
  }
 catch (  IOException e) {
    throw new OStorageException("Cannot delete database '" + name + "'.",e);
  }
 finally {
    lock.releaseExclusiveLock();
    Orient.instance().getProfiler().stopChrono("db." + name + ".drop","Drop a database",timer,"db.*.drop");
  }
}
