{
  while (true) {
    int freePageIndex=contentSize / 1024;
    freePageIndex-=16;
    if (freePageIndex < 0)     freePageIndex=0;
    long pageIndex;
    do {
      pageIndex=freePageLists[freePageIndex];
      freePageIndex++;
    }
 while (pageIndex < 0 && freePageIndex < 48);
    if (pageIndex < 0)     pageIndex=diskCache.getFilledUpTo(fileId);
 else     freePageIndex--;
    if (freePageIndex < freePageLists.length) {
      long pointer=diskCache.loadAndLockForRead(fileId,pageIndex);
      int realFreePageIndex;
      try {
        OLocalPage localPage=new OLocalPage(pointer,false);
        realFreePageIndex=calculateFreePageIndex(localPage);
      }
  finally {
        diskCache.releaseReadLock(fileId,pageIndex);
      }
      if (realFreePageIndex != freePageIndex) {
        OLogManager.instance().warn(this,"Page in file %s with index %d was placed in wrong free list, this error will be fixed automatically.",name + DEF_EXTENSION,pageIndex);
        updateFreePagesIndex(freePageIndex,pageIndex);
        continue;
      }
    }
    return new FindFreePageResult(pageIndex,freePageIndex);
  }
}
