{
  short[] pos=new short[map.size()];
  int i=0;
  Entry<Object,Object> values[]=new Entry[map.size()];
  short fullPos=OVarIntSerializer.write(bytes,map.size());
  for (  Entry<Object,Object> entry : map.entrySet()) {
    OType type=getTypeFromValue(entry.getKey(),true);
    writeOType(bytes,bytes.alloc((short)1),type);
    writeSingleValue(bytes,entry.getKey(),type);
    pos[i]=bytes.alloc((short)3);
    values[i]=entry;
    i++;
  }
  for (i=0; i < values.length; i++) {
    short pointer=0;
    Object value=values[i].getValue();
    OType type=getTypeFromValue(value,true);
    if (type == null)     continue;
    pointer=writeSingleValue(bytes,value,type);
    OShortSerializer.INSTANCE.serialize(pointer,bytes.bytes,pos[i]);
    writeOType(bytes,(short)(pos[i] + 2),type);
  }
  return fullPos;
}
