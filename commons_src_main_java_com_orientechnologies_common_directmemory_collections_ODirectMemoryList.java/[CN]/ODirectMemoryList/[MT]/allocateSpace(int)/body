{
  final long size=capacity * 8 + 4;
  final long ptr=memory.allocate(size);
  if (ptr == ODirectMemory.NULL_POINTER)   throw new IllegalStateException("There is no enough memory to allocate for capacity = " + capacity);
  long itemPtr=4 + ptr;
  for (int i=0; i < capacity; i++) {
    memory.setLong(itemPtr,ODirectMemory.NULL_POINTER);
    itemPtr+=8;
  }
  memory.setInt(ptr,capacity);
  return ptr;
}
