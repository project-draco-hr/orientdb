{
  ((OClassImpl)iClass).setClusterSelectionInternal(new OLocalClusterStrategy(this,iDatabase.getName(),iClass));
  if (!iClass.isAbstract()) {
    final int[] clusterIds=iClass.getClusterIds();
    final List<String> clusterNames=new ArrayList<String>(clusterIds.length);
    for (    int clusterId : clusterIds)     clusterNames.add(iDatabase.getClusterNameById(clusterId));
    String bestCluster=cfg.getLocalCluster(clusterNames,nodeName);
    if (bestCluster == null) {
      final String newClusterName=(iClass.getName() + "_" + getLocalNodeName()).toLowerCase();
      final Set<String> cfgClusterNames=new HashSet<String>();
      for (      String cl : cfg.getClusterNames())       cfgClusterNames.add(cl);
      if (cfgClusterNames.contains(newClusterName)) {
        ODistributedServerLog.info(this,nodeName,null,DIRECTION.NONE,"class %s, change mastership of cluster '%s' (id=%d) to local node '%s'",iClass,newClusterName,iDatabase.getClusterIdByName(newClusterName),nodeName);
        cfg.setMasterServer(newClusterName,nodeName);
      }
 else {
        ODistributedServerLog.info(this,nodeName,null,DIRECTION.NONE,"class %s, creation of new local cluster '%s' (id=%d)",iClass,newClusterName,iDatabase.getClusterIdByName(newClusterName));
        try {
          iClass.addCluster(newClusterName);
        }
 catch (        OCommandSQLParsingException e) {
          if (!e.getMessage().endsWith("already exists"))           throw e;
        }
        ODistributedServerLog.info(this,nodeName,null,DIRECTION.NONE,"class %s, set mastership of cluster '%s' (id=%d) to '%s'",iClass,newClusterName,iDatabase.getClusterIdByName(newClusterName),nodeName);
        cfg.setMasterServer(newClusterName,nodeName);
      }
      return true;
    }
  }
  return false;
}
