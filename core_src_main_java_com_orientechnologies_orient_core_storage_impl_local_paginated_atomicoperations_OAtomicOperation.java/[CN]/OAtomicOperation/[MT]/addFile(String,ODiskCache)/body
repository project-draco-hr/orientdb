{
  if (newFileNamesId.containsKey(fileName))   throw new OStorageException("File with name " + fileName + " already exists.");
  final long fileId=diskCache.bookFileId();
  newFileNamesId.put(fileName,fileId);
  FileChangesContainer fileChangesContainer=new FileChangesContainer();
  fileChangesContainer.isNew=true;
  fileChangesContainer.fileName=fileName;
  fileChanges.put(fileId,fileChangesContainer);
  deletedFileNames.remove(fileName);
  return fileId;
}
