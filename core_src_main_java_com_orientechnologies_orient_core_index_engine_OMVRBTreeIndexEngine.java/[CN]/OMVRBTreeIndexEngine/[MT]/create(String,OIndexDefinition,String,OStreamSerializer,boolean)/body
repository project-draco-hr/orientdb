{
  acquireExclusiveLock();
  try {
    maxUpdatesBeforeSave=lazyUpdates(isAutomatic);
    if (indexDefinition != null) {
      if (indexDefinition instanceof ORuntimeKeyIndexDefinition) {
        map=new OMVRBTreeDatabaseLazySave<Object,V>(clusterIndexName,((ORuntimeKeyIndexDefinition)indexDefinition).getSerializer(),valueSerializer,1,maxUpdatesBeforeSave);
      }
 else {
        final OBinarySerializer<?> keySerializer;
        if (indexDefinition.getTypes().length > 1) {
          keySerializer=OCompositeKeySerializer.INSTANCE;
        }
 else {
          keySerializer=OBinarySerializerFactory.getInstance().getObjectSerializer(indexDefinition.getTypes()[0]);
        }
        map=new OMVRBTreeDatabaseLazySave<Object,V>(clusterIndexName,(OBinarySerializer<Object>)keySerializer,valueSerializer,indexDefinition.getTypes().length,maxUpdatesBeforeSave);
      }
    }
 else     map=new OMVRBTreeDatabaseLazySave<Object,V>(clusterIndexName,new OSimpleKeySerializer(),valueSerializer,1,maxUpdatesBeforeSave);
    installHooks(indexName);
  }
  finally {
    releaseExclusiveLock();
  }
}
