{
  long prevFreeListItem;
  OAtomicOperation atomicOperation=storage.getAtomicOperationsManager().getCurrentOperation();
  OCacheEntry rootCacheEntry=loadPage(atomicOperation,fileId,ROOT_INDEX,false,diskCache);
  rootCacheEntry.acquireExclusiveLock();
  OSBTreeBucket<K,V> rootBucket=new OSBTreeBucket<K,V>(rootCacheEntry,keySerializer,keyTypes,valueSerializer,getChangesTree(atomicOperation,rootCacheEntry));
  try {
    prevFreeListItem=rootBucket.getValuesFreeListFirstIndex();
    rootBucket.setValuesFreeListFirstIndex(pageIndex);
  }
  finally {
    rootCacheEntry.releaseExclusiveLock();
    releasePage(atomicOperation,rootCacheEntry,diskCache);
  }
  OCacheEntry valueEntry=loadPage(atomicOperation,fileId,pageIndex,false,diskCache);
  valueEntry.acquireExclusiveLock();
  try {
    OSBTreeValuePage valuePage=new OSBTreeValuePage(valueEntry,getChangesTree(atomicOperation,valueEntry),false);
    valuePage.setNextFreeListPage(prevFreeListItem);
  }
  finally {
    valueEntry.releaseExclusiveLock();
    releasePage(atomicOperation,valueEntry,diskCache);
  }
}
