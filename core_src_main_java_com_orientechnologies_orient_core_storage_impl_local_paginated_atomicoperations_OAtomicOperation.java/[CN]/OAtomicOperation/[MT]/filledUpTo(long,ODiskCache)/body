{
  if (deletedFiles.contains(fileId))   throw new OStorageException("File with id " + fileId + " is deleted.");
  FileChangesContainer changesContainer=fileChanges.get(fileId);
  if (changesContainer == null) {
    changesContainer=new FileChangesContainer();
    fileChanges.put(fileId,changesContainer);
  }
 else   if (changesContainer.isNew || changesContainer.maxNewPageIndex > -1)   return changesContainer.maxNewPageIndex + 1;
  return diskCache.getFilledUpTo(fileId);
}
