{
  if (this.function == null)   return;
  isRunning=true;
  final SimpleDateFormat sdf=new SimpleDateFormat("yyyy-MM-dd HH:mm:ss:SSS");
  final Date date=new Date(System.currentTimeMillis());
  OLogManager.instance().warn(this,"execute : " + this.toString() + " at "+ sdf.format(date));
  if (db != null)   ODatabaseRecordThreadLocal.INSTANCE.set(db);
  this.document.field(PROP_STATUS,SCHEDULER_STATUS.RUNNING);
  this.document.field(PROP_STARTTIME,System.currentTimeMillis());
  this.document.save();
  OScriptManager scriptManager=null;
  Bindings binding=null;
  scriptManager=Orient.instance().getScriptManager();
  final OPartitionedObjectPool.PoolEntry<ScriptEngine> entry=scriptManager.acquireDatabaseEngine(db.getName(),function.getLanguage());
  final ScriptEngine scriptEngine=entry.object;
  try {
    binding=scriptEngine.getBindings(ScriptContext.ENGINE_SCOPE);
    scriptManager.bind(binding,(ODatabaseDocumentTx)db,null,getArguments());
    if (this.function.getLanguage() == null)     throw new OConfigurationException("Database function '" + this.function.getName() + "' has no language");
    final String funcStr=scriptManager.getFunctionDefinition(this.function);
    if (funcStr != null) {
      try {
        scriptEngine.eval(funcStr);
      }
 catch (      ScriptException e) {
        scriptManager.throwErrorMessage(e,funcStr);
      }
    }
    if (scriptEngine instanceof Invocable) {
      final Invocable invocableEngine=(Invocable)scriptEngine;
      Object[] args=null;
      Map<Object,Object> iArgs=getArguments();
      if (iArgs != null) {
        args=new Object[iArgs.size()];
        int i=0;
        for (        Entry<Object,Object> arg : iArgs.entrySet())         args[i++]=arg.getValue();
      }
 else {
        args=OCommonConst.EMPTY_OBJECT_ARRAY;
      }
      invocableEngine.invokeFunction(this.function.getName(),args);
    }
  }
 catch (  ScriptException e) {
    throw OException.wrapException(new OCommandScriptException("Error on execution of the script",this.function.getName(),e.getColumnNumber()),e);
  }
catch (  NoSuchMethodException e) {
    throw OException.wrapException(new OCommandScriptException("Error on execution of the script",this.function.getName(),0),e);
  }
catch (  OCommandScriptException e) {
    throw e;
  }
catch (  Exception ex) {
    throw OException.wrapException(new OCommandScriptException("Unknown Exception",this.function.getName(),0),ex);
  }
 finally {
    if (scriptManager != null && binding != null)     scriptManager.unbind(binding,null,getArguments());
    scriptManager.releaseDatabaseEngine(function.getLanguage(),db.getName(),entry);
    OLogManager.instance().warn(this,"Job : " + this.toString() + " Finished!");
    isRunning=false;
    this.document.field(PROP_STATUS,SCHEDULER_STATUS.WAITING);
    this.document.save();
  }
}
