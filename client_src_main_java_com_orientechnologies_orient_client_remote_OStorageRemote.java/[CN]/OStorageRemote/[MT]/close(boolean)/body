{
  lock.acquireExclusiveLock();
  OChannelBinaryClient network=null;
  try {
    try {
      network=beginRequest(OChannelBinaryProtocol.REQUEST_DB_CLOSE);
    }
  finally {
      endRequest(network);
    }
    getResponse(network);
    OStorageRemoteThreadLocal.INSTANCE.get().sessionId=-1;
    if (!checkForClose(iForce))     return;
    if (serviceThread != null) {
      serviceThread.sendShutdown();
      serviceThread.interrupt();
    }
    for (    OChannelBinaryClient n : networkPool)     n.close();
    networkPool.clear();
    level2Cache.shutdown();
    Orient.instance().unregisterStorage(this);
    open=false;
  }
 catch (  OException e) {
    throw e;
  }
catch (  Exception e) {
    OLogManager.instance().debug(this,"Error on closing remote connection: %s",network);
  }
 finally {
    lock.releaseExclusiveLock();
  }
}
