{
  String buildDirectory=System.getProperty("buildDirectory",".");
  if (buildDirectory == null)   buildDirectory=".";
  String uri="plocal:" + buildDirectory + "/city";
  databaseDocumentTx=new ODatabaseDocumentTx(uri);
  if (databaseDocumentTx.exists()) {
    databaseDocumentTx.open("admin","admin");
    databaseDocumentTx.drop();
  }
  databaseDocumentTx.create();
  OSchema schema=databaseDocumentTx.getMetadata().getSchema();
  if (schema.getClass("City") == null) {
    OClass oClass=schema.createClass("City");
    oClass.createProperty("latitude",OType.DOUBLE);
    oClass.createProperty("longitude",OType.DOUBLE);
    oClass.createProperty("name",OType.STRING);
    oClass.createIndex("City.name","FULLTEXT",null,null,"LUCENE",new String[]{"name"});
    oClass.createIndex("City.lat_lng","SPATIAL",null,null,"LUCENE",new String[]{"latitude","longitude"});
  }
  ZipFile zipFile=new ZipFile("files/allCountries.zip");
  Enumeration<? extends ZipEntry> entries=zipFile.entries();
  while (entries.hasMoreElements()) {
    ZipEntry entry=entries.nextElement();
    if (entry.getName().equals("allCountries.txt")) {
      InputStream stream=zipFile.getInputStream(entry);
      lineReader=new LineNumberReader(new InputStreamReader(stream));
    }
  }
  databaseDocumentTx.declareIntent(new OIntentMassiveInsert());
}
