{
  iRequest.getDatabase().checkSecurity(ODatabaseSecurityResources.COMMAND,ORole.PERMISSION_CREATE);
  init(iRequest.getDatabase(),iRequest.getText());
  StringBuilder word=new StringBuilder();
  int oldPos=0;
  int pos=OSQLHelper.nextWord(text,textUpperCase,oldPos,word,true);
  if (pos == -1 || !word.toString().equals(KEYWORD_CREATE))   throw new OCommandSQLParsingException("Keyword " + KEYWORD_CREATE + " not found",text,oldPos);
  oldPos=pos;
  pos=OSQLHelper.nextWord(text,textUpperCase,oldPos,word,true);
  if (pos == -1 || !word.toString().equals(KEYWORD_CLASS))   throw new OCommandSQLParsingException("Keyword " + KEYWORD_CLASS + " not found",text,oldPos);
  oldPos=pos;
  pos=OSQLHelper.nextWord(text,textUpperCase,oldPos,word,false);
  if (pos == -1)   throw new OCommandSQLParsingException("Expected <class>",text,oldPos);
  className=word.toString();
  if (className == null)   throw new OCommandSQLParsingException("Class " + className + " already exists",text,oldPos);
  oldPos=pos;
  while ((pos=OSQLHelper.nextWord(text,textUpperCase,oldPos,word,true)) > -1) {
    final String k=word.toString();
    if (k.equals(KEYWORD_EXTENDS)) {
      oldPos=pos;
      pos=OSQLHelper.nextWord(text,textUpperCase,oldPos,word,false);
      if (pos == -1)       throw new OCommandSQLParsingException("Syntax error after EXTENDS for class " + className + ". Expected the super-class name",text,oldPos);
      if (!database.getMetadata().getSchema().existsClass(word.toString()))       throw new OCommandSQLParsingException("Super-class " + word + " not exists",text,oldPos);
      superClass=database.getMetadata().getSchema().getClass(word.toString());
    }
 else     if (k.equals(KEYWORD_CLUSTER)) {
      oldPos=pos;
      pos=OSQLHelper.nextWord(text,textUpperCase,oldPos,word,false);
      if (pos == -1)       throw new OCommandSQLParsingException("Syntax error after CLUSTER for class " + className + ". Expected the cluster id or name",text,oldPos);
      final String[] clusterIdsAsStrings=word.toString().split(",");
      if (clusterIdsAsStrings.length > 0) {
        clusterIds=new int[clusterIdsAsStrings.length];
        for (int i=0; i < clusterIdsAsStrings.length; ++i) {
          if (Character.isDigit(clusterIdsAsStrings[i].charAt(0)))           clusterIds[i]=Integer.parseInt(clusterIdsAsStrings[i]);
 else           clusterIds[i]=database.getStorage().getClusterIdByName(clusterIdsAsStrings[i]);
          if (database.getStorage().getClusterById(clusterIds[i]) == null)           throw new OCommandSQLParsingException("Cluster with id " + clusterIds[i] + " does not exists",text,oldPos);
        }
      }
    }
    oldPos=pos;
  }
  if (clusterIds == null) {
    final int clusterId=database.getStorage().getClusterIdByName(className);
    if (clusterId > -1) {
      clusterIds=new int[]{clusterId};
    }
  }
  return this;
}
