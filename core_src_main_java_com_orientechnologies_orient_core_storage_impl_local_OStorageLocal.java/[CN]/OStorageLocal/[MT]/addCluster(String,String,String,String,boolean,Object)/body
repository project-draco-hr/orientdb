{
  checkOpeness();
  lock.acquireExclusiveLock();
  try {
    final OCluster cluster;
    if (clusterName != null) {
      clusterName=clusterName.toLowerCase();
      int clusterPos=clusters.length;
      for (int i=0; i < clusters.length; ++i)       if (clusters[i] == null) {
        clusterPos=i;
        break;
      }
      cluster=Orient.instance().getClusterFactory().createCluster(clusterType);
      cluster.configure(this,clusterPos,clusterName,iLocation,getDataSegmentIdByName(iDataSegmentName),iParameters);
    }
 else     cluster=null;
    final int clusterId=registerCluster(cluster);
    if (cluster != null) {
      cluster.create(-1);
      configuration.update();
    }
    return clusterId;
  }
 catch (  Exception e) {
    throw new OStorageException("Error in creation of new cluster '" + clusterName + "' of type: "+ clusterType,e);
  }
 finally {
    lock.releaseExclusiveLock();
  }
}
