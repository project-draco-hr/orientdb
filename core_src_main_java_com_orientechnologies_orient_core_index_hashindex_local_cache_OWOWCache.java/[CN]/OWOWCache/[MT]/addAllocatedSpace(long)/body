{
  allocatedSpace.addAndGet(diff);
  final long ts=System.currentTimeMillis();
  final long lastSpaceCheck=lastDiskSpaceCheck.get();
  if (ts - lastSpaceCheck > diskSizeCheckInterval) {
    final File storageDir=new File(storagePath);
    final long freeSpace=storageDir.getFreeSpace();
    if (freeSpace - allocatedSpace.get() < freeSpaceLimit)     callLowSpaceListeners();
    lastDiskSpaceCheck.lazySet(ts);
  }
}
