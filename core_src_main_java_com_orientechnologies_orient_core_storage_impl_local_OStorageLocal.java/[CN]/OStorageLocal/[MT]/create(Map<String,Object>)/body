{
  final long timer=Orient.instance().getProfiler().startChrono();
  lock.acquireExclusiveLock();
  try {
    if (status != STATUS.CLOSED)     throw new OStorageException("Cannot create new storage '" + name + "' because it is not closed (status:"+ status+ ")");
    addUser();
    final File storageFolder=new File(storagePath);
    if (!storageFolder.exists())     storageFolder.mkdir();
    if (exists())     throw new OStorageException("Cannot create new storage '" + name + "' because it already exists");
    status=STATUS.OPEN;
    init();
    addDataSegment(OStorage.DATA_DEFAULT_NAME);
    addDataSegment(OMetadataDefault.DATASEGMENT_INDEX_NAME);
    addCluster(OStorage.CLUSTER_TYPE.PHYSICAL.toString(),OMetadataDefault.CLUSTER_INTERNAL_NAME,null,null,true);
    configuration.create();
    addCluster(OStorage.CLUSTER_TYPE.PHYSICAL.toString(),OMetadataDefault.CLUSTER_INDEX_NAME,null,OMetadataDefault.DATASEGMENT_INDEX_NAME,true);
    addCluster(OStorage.CLUSTER_TYPE.PHYSICAL.toString(),OMetadataDefault.CLUSTER_MANUAL_INDEX_NAME,null,null,true);
    defaultClusterId=addCluster(OStorage.CLUSTER_TYPE.PHYSICAL.toString(),CLUSTER_DEFAULT_NAME,null,null,false);
    writeAheadLog=new ODiskWriteAheadLog(this);
    atomicOperationsManager=new OAtomicOperationsManager(writeAheadLog);
    txManager.create();
  }
 catch (  OStorageException e) {
    close();
    throw e;
  }
catch (  IOException e) {
    close();
    throw new OStorageException("Error on creation of storage '" + name + "'",e);
  }
 finally {
    lock.releaseExclusiveLock();
    Orient.instance().getProfiler().stopChrono("db." + name + ".create","Create a database",timer,"db.*.create");
  }
}
