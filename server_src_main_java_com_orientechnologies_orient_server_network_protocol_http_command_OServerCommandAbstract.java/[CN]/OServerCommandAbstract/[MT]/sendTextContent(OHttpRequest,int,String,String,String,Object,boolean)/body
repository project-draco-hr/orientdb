{
  final String content;
  final String contentType;
  if (iRequest.url.indexOf('?') > 0 && iRequest.url.indexOf(OHttpUtils.CALLBACK_PARAMETER_NAME,iRequest.url.indexOf('?')) > 0) {
    String callbackFunction=iRequest.url.substring(iRequest.url.indexOf(OHttpUtils.CALLBACK_PARAMETER_NAME,iRequest.url.indexOf('?')) + OHttpUtils.CALLBACK_PARAMETER_NAME.length());
    if (callbackFunction.indexOf('&') > -1)     callbackFunction=callbackFunction.substring(0,callbackFunction.indexOf('&'));
    content=callbackFunction + "(" + iContent+ ")";
    contentType="text/javascript";
  }
 else {
    content=iContent != null ? iContent.toString() : null;
    contentType=iContentType;
  }
  final boolean empty=content == null || content.length() == 0;
  sendStatus(iRequest,empty && iCode == 200 ? 204 : iCode,iReason);
  sendResponseHeaders(iRequest,contentType,iKeepAlive);
  if (iHeaders != null)   writeLine(iRequest,iHeaders);
  final String sessId=iRequest.sessionId != null ? iRequest.sessionId : "-";
  writeLine(iRequest,"Set-Cookie: OSESSIONID=" + sessId + "; Path=/; HttpOnly");
  final byte[] binaryContent=empty ? null : OBinaryProtocol.string2bytes(content);
  writeLine(iRequest,OHttpUtils.HEADER_CONTENT_LENGTH + (empty ? 0 : binaryContent.length));
  writeLine(iRequest,null);
  if (!empty)   writeContent(iRequest,content);
  if (binaryContent != null)   iRequest.channel.outStream.write(binaryContent);
  iRequest.channel.flush();
}
