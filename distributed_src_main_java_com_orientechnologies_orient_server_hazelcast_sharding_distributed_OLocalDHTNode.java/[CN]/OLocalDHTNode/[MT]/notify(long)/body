{
  boolean result=false;
  while (!result) {
    long predecessorId=predecessor.longValue();
    if (predecessorId < 0 || (insideInterval(predecessorId,this.id,nodeId,false))) {
      result=predecessor.compareAndSet(predecessorId,nodeId);
      if (result)       log("New predecessor is " + nodeId);
 else       log("Predecessor setup was failed.");
      if (result && predecessorId < 0 && state == NodeState.JOIN) {
        migrationId=fingerPoints.get(0);
        final ODHTNode mergeNode=nodeLookup.findById(migrationId);
        mergeNode.requestMigration(id);
        state=NodeState.MERGING;
        log("Status was changed to " + state);
      }
      drawRing();
    }
 else     result=true;
  }
}
