{
  if (!(iCurrentRecord instanceof ODocument))   return null;
  ODatabaseRecord currentDb=ODatabaseRecordThreadLocal.INSTANCE.get();
  if (currentDb == null)   currentDb=iCurrentRecord.getDatabase();
  currentDb=(ODatabaseRecord)currentDb.getDatabaseOwner();
  final OGraphDatabase db;
  if (currentDb instanceof OGraphDatabase)   db=(OGraphDatabase)currentDb;
 else {
    db=new OGraphDatabase(currentDb.getURL());
    currentDb.close();
    ODatabaseRecordThreadLocal.INSTANCE.set(db);
  }
  if (result == null)   result=new ArrayList<Object>();
  if (iRequester.getParameters() != null)   currentParameters=new HashMap<Object,Object>();
  final Object scriptResult=OGremlinHelper.execute(db,(String)iParameters[0],iRequester != null ? iRequester.getParameters() : null,currentParameters,result,new OGremlinHelper.OGremlinCallback(){
    @Override public boolean call(    GremlinScriptEngine iEngine,    OrientGraph iGraph){
      final OrientElement graphElement;
      final ODocument document=(ODocument)iCurrentRecord;
      if (db.isVertex(document))       graphElement=new OrientVertex(iGraph,document);
 else       if (db.isEdge(document))       graphElement=new OrientEdge(iGraph,document);
 else       return false;
      iEngine.getBindings(ScriptContext.ENGINE_SCOPE).put("current",graphElement);
      return true;
    }
  }
,null);
  return scriptResult;
}
