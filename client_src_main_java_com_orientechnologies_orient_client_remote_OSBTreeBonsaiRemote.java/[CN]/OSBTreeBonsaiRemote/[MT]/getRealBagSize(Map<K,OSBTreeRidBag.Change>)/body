{
  OStorageRemote storage=(OStorageRemote)ODatabaseRecordThreadLocal.INSTANCE.get().getStorage().getUnderlying();
  OChannelBinaryAsynchClient client=null;
  try {
    client=storage.beginRequest(OChannelBinaryProtocol.REQUEST_RIDBAG_GET_SIZE);
    OCollectionNetworkSerializer.INSTANCE.writeCollectionPointer(client,getCollectionPointer());
    final OSBTreeRidBag.ChangeSerializationHelper changeSerializer=OSBTreeRidBag.ChangeSerializationHelper.INSTANCE;
    final byte[] stream=new byte[OIntegerSerializer.INT_SIZE + changeSerializer.getChangesSerializedSize(changes.size())];
    changeSerializer.serializeChanges(changes,keySerializer,stream,0);
    client.writeBytes(stream);
    storage.endRequest(client);
    int result;
    try {
      storage.beginResponse(client);
      result=client.readInt();
    }
  finally {
      storage.endResponse(client);
    }
    return result;
  }
 catch (  IOException e) {
    storage.getEngine().getConnectionManager().remove(client);
    throw new ODatabaseException("Can't get by real bag size sb-tree bonsai.",e);
  }
catch (  RuntimeException e2) {
    storage.getEngine().getConnectionManager().release(client);
    throw e2;
  }
}
