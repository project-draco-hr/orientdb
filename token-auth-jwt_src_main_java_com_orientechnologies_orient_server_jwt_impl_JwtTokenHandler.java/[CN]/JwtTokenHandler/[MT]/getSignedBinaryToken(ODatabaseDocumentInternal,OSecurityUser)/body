{
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  try {
    OrientJwtHeader header=new OrientJwtHeader();
    header.setAlgorithm("HS256");
    header.setKeyId("");
    serializeBinaryHeader(header,baos);
    OJwtPayload payload=createPayload(db,user);
    serializeBinaryPayload(payload,baos);
    byte[] signature=signToken(header,baos.toByteArray());
    baos.write(signature);
  }
 catch (  RuntimeException e) {
    throw e;
  }
catch (  Exception e) {
    throw new OException(e);
  }
  return baos.toByteArray();
}
