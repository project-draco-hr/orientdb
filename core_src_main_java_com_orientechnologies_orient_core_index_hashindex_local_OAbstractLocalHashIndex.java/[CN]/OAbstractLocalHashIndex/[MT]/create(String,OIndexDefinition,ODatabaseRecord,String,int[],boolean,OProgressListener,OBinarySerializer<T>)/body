{
  acquireExclusiveLock();
  try {
    configuration=new ODocument();
    this.indexDefinition=indexDefinition;
    this.name=name;
    storage=(OStorageLocalAbstract)database.getStorage();
    final ORecord<?> emptyRecord=new ORecordBytes(new byte[]{});
    emptyRecord.save(clusterIndexName);
    identity=emptyRecord.getIdentity();
    OBinarySerializer<Object> keySerializer=(OBinarySerializer<Object>)detectKeySerializer(indexDefinition);
    if (clusterIdsToIndex != null)     for (    final int id : clusterIdsToIndex)     clustersToIndex.add(database.getClusterNameById(id));
    keyHashFunction.setValueSerializer(keySerializer);
    localHashTable.create(name,keySerializer,valueSerializer,storage);
    updateConfiguration();
    if (rebuild)     rebuild(progressListener);
    return this;
  }
  finally {
    releaseExclusiveLock();
  }
}
