{
  if (database == null) {
    final OServerUserConfiguration replicatorUser=manager.getServerInstance().getUser(ODistributedAbstractPlugin.REPLICATOR_USER);
    database=(ODatabaseDocumentTx)manager.getServerInstance().openDatabase("document",databaseName,replicatorUser.name,replicatorUser.password);
  }
 else   if (database.isClosed()) {
    final OServerUserConfiguration replicatorUser=manager.getServerInstance().getUser(ODistributedAbstractPlugin.REPLICATOR_USER);
    database.open(replicatorUser.name,replicatorUser.password);
  }
 else {
    OSecurity security=database.getMetadata().getSecurity();
    if (security == null || security instanceof OSecurityNull) {
      final OServerUserConfiguration replicatorUser=manager.getServerInstance().getUser(ODistributedAbstractPlugin.REPLICATOR_USER);
      createReplicatorUser(database,replicatorUser);
      database=(ODatabaseDocumentTx)manager.getServerInstance().openDatabase("document",databaseName,replicatorUser.name,replicatorUser.password);
    }
  }
}
