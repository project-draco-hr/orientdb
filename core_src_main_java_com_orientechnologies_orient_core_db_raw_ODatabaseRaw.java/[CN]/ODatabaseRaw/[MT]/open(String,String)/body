{
  try {
    if (status == STATUS.OPEN)     throw new IllegalStateException("Database " + getName() + " is already open");
    if (storage.isClosed()) {
      storage.open(iUserName,iUserPassword,properties);
    }
 else     if (storage instanceof OStorageProxy) {
      final String name=((OStorageProxy)storage).getUserName();
      if (!name.equals(iUserName)) {
        storage.close();
        storage.open(iUserName,iUserPassword,properties);
      }
    }
    status=STATUS.OPEN;
  }
 catch (  OStorageException e) {
    throw e;
  }
catch (  OException e) {
    throw e;
  }
catch (  Exception e) {
    throw new ODatabaseException("Cannot open database",e);
  }
  return (DB)this;
}
