{
  int position=1;
  int size=buffer[0];
  if (!nativeAcceleration)   for (int i=0; i < size; i++) {
    if (keysToUpdate[i]) {
      keysToUpdate[i]=false;
    }
    position+=KEY_SIZE;
  }
  position=FIRST_VALUE_POS;
  for (int i=0; i < size; i++) {
    if (positionsToUpdate[i]) {
      OPhysicalPosition physicalPosition=positions[i];
      CONVERTER.putInt(buffer,position,physicalPosition.dataSegmentId);
      position+=4;
      CONVERTER.putLong(buffer,position,physicalPosition.dataSegmentPos);
      position+=8;
      buffer[position]=physicalPosition.recordType;
      position+=1;
      CONVERTER.putInt(buffer,position,physicalPosition.recordVersion);
      position+=4;
      positionsToUpdate[i]=false;
    }
 else     position+=VALUE_SIZE;
  }
  if (overflowWasChanged)   CONVERTER.putLong(buffer,OVERFLOW_POS,overflowBucketIndex + 1);
}
