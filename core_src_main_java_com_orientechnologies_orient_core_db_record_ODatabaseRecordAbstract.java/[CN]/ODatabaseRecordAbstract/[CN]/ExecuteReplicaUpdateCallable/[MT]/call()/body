{
  final ORecordMetadata loadedRecordMetadata=getRecordMetadata(rid);
  final boolean result;
  if (loadedRecordMetadata == null)   result=processReplicaAdd();
 else   if (loadedRecordMetadata.getRecordVersion().compareTo(record.getRecordVersion()) < 0)   result=processReplicaUpdate(loadedRecordMetadata);
 else   return false;
  if (!result)   throw new IllegalStateException("Passed in replica was not stored in DB");
  return true;
}
