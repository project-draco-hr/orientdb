{
  ODatabaseDocumentTx db=new ODatabaseDocumentTx("memory:txPoint");
  try {
    db.create();
    OSchema schema=db.getMetadata().getSchema();
    OClass v=schema.getClass("V");
    OClass oClass=schema.createClass("City");
    oClass.setSuperClass(v);
    oClass.createProperty("location",OType.EMBEDDED,schema.getClass("OPoint"));
    oClass.createProperty("name",OType.STRING);
    db.command(new OCommandSQL("CREATE INDEX City.location ON City(location) SPATIAL ENGINE LUCENE")).execute();
    OIndex idx=db.getMetadata().getIndexManager().getIndex("City.location");
    ODocument rome=newCity("Rome",12.5,41.9);
    ODocument london=newCity("London",-0.1275,51.507222);
    db.begin();
    db.command(new OCommandSQL("insert into City set name = 'Test' , location = ST_GeomFromText('" + PWKT + "')")).execute();
    db.save(rome);
    db.save(london);
    String query="select * from City where location && 'LINESTRING(-160.06393432617188 21.996535232496047,-160.1099395751953 21.94304553343818,-160.169677734375 21.89399562866819,-160.21087646484375 21.844928843026818,-160.21018981933594 21.787556698550834)' ";
    List<ODocument> docs=db.query(new OSQLSynchQuery<ODocument>(query));
    Assert.assertEquals(1,docs.size());
    Assert.assertEquals(3,idx.getSize());
    db.rollback();
    query="select * from City where location && 'LINESTRING(-160.06393432617188 21.996535232496047,-160.1099395751953 21.94304553343818,-160.169677734375 21.89399562866819,-160.21087646484375 21.844928843026818,-160.21018981933594 21.787556698550834)' ";
    docs=db.query(new OSQLSynchQuery<ODocument>(query));
    Assert.assertEquals(0,docs.size());
    Assert.assertEquals(0,idx.getSize());
  }
  finally {
    db.drop();
  }
}
