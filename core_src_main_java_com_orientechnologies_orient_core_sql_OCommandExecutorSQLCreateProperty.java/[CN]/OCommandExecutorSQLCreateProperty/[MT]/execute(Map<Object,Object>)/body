{
  if (type == null)   throw new OCommandExecutionException("Can't execute the command because it hasn't been parsed yet");
  final OClassImpl sourceClass=(OClassImpl)database.getMetadata().getSchema().getClass(className);
  if (sourceClass == null)   throw new OCommandExecutionException("Source class '" + className + "' not found");
  OPropertyImpl prop=(OPropertyImpl)sourceClass.getProperty(fieldName);
  if (prop != null)   throw new OCommandExecutionException("Property '" + className + "."+ fieldName+ "' already exists. Remove it before to retry.");
  OClass linkedClass=null;
  OType linkedType=null;
  if (linked != null) {
    linkedClass=database.getMetadata().getSchema().getClass(linked);
    if (linkedClass == null)     linkedType=OType.valueOf(linked.toUpperCase());
  }
  prop=sourceClass.addPropertyInternal(fieldName,type,linkedType,linkedClass);
  sourceClass.saveInternal();
  return prop.getId();
}
