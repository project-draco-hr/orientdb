{
  if (!(getStorage() instanceof OStorageLocal)) {
    OLogManager.instance().error(this,"We can not freeze non local storage. " + "If you use remote client please use OServerAdmin instead.");
    return;
  }
  final long startTime=OProfiler.getInstance().startChrono();
  final Collection<? extends OIndex<?>> indexes=getMetadata().getIndexManager().getIndexes();
  final List<OIndexMVRBTreeAbstract<?>> indexesToLock=prepareIndexesToFreeze(indexes);
  freezeIndexes(indexesToLock,true);
  flushIndexes(indexesToLock);
  super.freeze(throwException);
  OProfiler.getInstance().stopChrono("document.database.freeze",startTime);
}
