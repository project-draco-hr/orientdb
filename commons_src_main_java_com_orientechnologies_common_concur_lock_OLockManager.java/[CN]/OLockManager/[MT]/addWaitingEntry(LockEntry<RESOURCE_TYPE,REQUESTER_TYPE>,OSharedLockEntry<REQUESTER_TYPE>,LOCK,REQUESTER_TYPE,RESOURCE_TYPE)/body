{
  assert(Thread.holdsLock(this));
  LockEntry<RESOURCE_TYPE,REQUESTER_TYPE> newEntry=new LockEntry<RESOURCE_TYPE,REQUESTER_TYPE>(iLockType,iRequester,iResource,LOCK_STATUS.WILLWAIT);
  LockEntry<RESOURCE_TYPE,REQUESTER_TYPE> lastWaiter=iCurrentLock;
  while (lastWaiter.nextWaiter != null)   lastWaiter=lastWaiter.nextWaiter;
  lastWaiter.nextWaiter=newEntry;
  if (iCurrentSharedLock != null) {
    newEntry.countSharedLocks+=iCurrentSharedLock.countSharedLocks;
    iCurrentSharedLock.countSharedLocks=1;
    removeSharedLockEntry(iCurrentLock,iCurrentSharedLock.requester);
  }
  return newEntry;
}
