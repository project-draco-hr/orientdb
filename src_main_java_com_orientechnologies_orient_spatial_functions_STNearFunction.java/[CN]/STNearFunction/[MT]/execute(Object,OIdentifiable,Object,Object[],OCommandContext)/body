{
  Shape shape=factory.fromDoc((ODocument)iParams[0]);
  Map map=(Map)iParams[1];
  Shape shape1=factory.fromMapGeoJson((Map)map.get("shape"));
  double distance=0;
  Number n=(Number)map.get("maxDistance");
  if (n != null) {
    distance=n.doubleValue();
  }
  Point p=(Point)shape1;
  Circle circle=factory.SPATIAL_CONTEXT.makeCircle(p.getX(),p.getY(),DistanceUtils.dist2Degrees(distance,DistanceUtils.EARTH_MEAN_RADIUS_KM));
  double docDistDEG=factory.SPATIAL_CONTEXT.getDistCalc().distance((Point)shape,p);
  final double docDistInKM=DistanceUtils.degrees2Dist(docDistDEG,DistanceUtils.EARTH_EQUATORIAL_RADIUS_KM);
  iContext.setVariable("distance",docDistInKM);
  return shape.relate(circle) == SpatialRelation.WITHIN;
}
