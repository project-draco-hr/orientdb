{
  syncObject.lock();
  try {
    if (!activeOperations.isEmpty())     throw new OStorageException("Can not change end of WAL because there are active atomic operations in the log.");
    LogSegment last=logSegments.get(logSegments.size() - 1);
    if (last.filledUpTo() == 0) {
      return;
    }
    last.stopFlush(true);
    last=new LogSegment(new File(walLocation,getSegmentName(last.order + 1)),maxPagesCacheSize);
    last.init();
    last.startFlush();
    logSegments.add(last);
  }
  finally {
    syncObject.unlock();
  }
}
