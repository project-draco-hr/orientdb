{
  boolean needToUpdate=false;
  if (!parentRid.isValid() && parent != null) {
    if (!parent.record.getIdentity().isValid()) {
      parent.save();
      needToUpdate=true;
    }
    parentRid=parent.record.getIdentity();
  }
  if (!leftRid.isValid() && left != null) {
    if (!left.record.getIdentity().isValid()) {
      left.save();
      needToUpdate=true;
    }
    leftRid=left.record.getIdentity();
  }
  if (!rightRid.isValid() && right != null) {
    if (!right.record.getIdentity().isValid()) {
      right.save();
      needToUpdate=true;
    }
    rightRid=right.record.getIdentity();
  }
  if (needToUpdate) {
    markDirty();
    save();
  }
  return needToUpdate;
}
