{
  final int version=document.getVersion();
  if (document.fields() == 0 && document.getIdentity().isPersistent()) {
    document.reload();
    if (version > -1 && document.getVersion() != version)     if (OFastConcurrentModificationException.enabled())     throw OFastConcurrentModificationException.instance();
 else     throw new OConcurrentModificationException(document.getIdentity(),document.getVersion(),version,ORecordOperation.DELETED);
  }
  final ODocumentFieldWalker documentFieldWalker=new ODocumentFieldWalker();
  final RidBagDeleter ridBagDeleter=new RidBagDeleter();
  documentFieldWalker.walkDocument(document,ridBagDeleter);
}
