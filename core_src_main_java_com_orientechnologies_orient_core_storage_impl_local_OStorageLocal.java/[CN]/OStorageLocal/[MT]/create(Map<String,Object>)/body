{
  final long timer=OProfiler.getInstance().startChrono();
  final boolean locked=lock.acquireExclusiveLock();
  try {
    if (open)     throw new OStorageException("Can't create new storage " + name + " because it isn't closed");
    addUser();
    level2cache.startup();
    final File storageFolder=new File(storagePath);
    if (!storageFolder.exists())     storageFolder.mkdir();
    if (exists())     throw new OStorageException("Can't create new storage " + name + " because it already exists");
    open=true;
    addDataSegment(OStorage.DATA_DEFAULT_NAME);
    addCluster(OStorage.CLUSTER_INTERNAL_NAME,OStorage.CLUSTER_TYPE.PHYSICAL);
    addCluster(OStorage.CLUSTER_INDEX_NAME,OStorage.CLUSTER_TYPE.PHYSICAL);
    defaultClusterId=addCluster(OStorage.CLUSTER_DEFAULT_NAME,OStorage.CLUSTER_TYPE.PHYSICAL);
    configuration.create();
    txManager.create();
  }
 catch (  OStorageException e) {
    close();
    throw e;
  }
catch (  IOException e) {
    close();
    throw new OStorageException("Error on creation of storage: " + name,e);
  }
 finally {
    lock.releaseExclusiveLock(locked);
    OProfiler.getInstance().stopChrono("storage." + name + ".create",timer);
  }
}
