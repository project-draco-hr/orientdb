{
  if (!rid.isPersistent())   return null;
  final ODistributedRequestId localReqId=new ODistributedRequestId(dManager.getLocalNodeId(),dManager.getNextMessageIdCounter());
  if (!(localDistributedDatabase.lockRecord(rid,localReqId)))   throw new ODistributedRecordLockedException(rid);
  if (eventListener != null) {
    try {
      eventListener.onAfterRecordLock(rid);
    }
 catch (    Throwable t) {
      ODistributedServerLog.error(this,dManager.getLocalNodeName(),null,ODistributedServerLog.DIRECTION.NONE,"Caught exception during ODistributedStorageEventListener.onAfterRecordLock",t);
    }
  }
  return localReqId;
}
