{
  acquireExclusiveLock();
  try {
    long offset=holeSegment.popLastEntryPosition();
    final long[] pos;
    if (offset > -1)     pos=fileSegment.getRelativePosition(offset);
 else {
      pos=fileSegment.allocateSpace(RECORD_SIZE);
      offset=fileSegment.getAbsolutePosition(pos);
    }
    OFile file=fileSegment.files[(int)pos[0]];
    long p=pos[1];
    file.writeShort(p,(short)iDataSegmentId);
    file.writeLong(p+=OBinaryProtocol.SIZE_SHORT,iPosition);
    file.writeByte(p+=OBinaryProtocol.SIZE_LONG,iRecordType);
    final long returnedPosition=offset / RECORD_SIZE;
    updateBoundsAfterInsertion(returnedPosition);
    return returnedPosition;
  }
  finally {
    releaseExclusiveLock();
  }
}
