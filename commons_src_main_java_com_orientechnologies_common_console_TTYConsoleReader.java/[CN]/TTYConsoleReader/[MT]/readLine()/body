{
  String consoleInput="";
  try {
    StringBuffer buffer=new StringBuffer();
    int historyNum=history.size();
    while (true) {
      boolean escape=false;
      int next=System.in.read();
      if (next == 27) {
        escape=true;
        System.in.read();
        next=System.in.read();
      }
      if (escape) {
        if (next == UP_CHAR && !history.isEmpty()) {
          if (history.size() > 0) {
            StringBuffer cleaner=new StringBuffer();
            for (int i=0; i < buffer.length(); i++) {
              cleaner.append(" ");
            }
            rewriteConsole(cleaner);
            historyNum=historyNum > 0 ? historyNum - 1 : 0;
            buffer=new StringBuffer(history.get(historyNum));
            rewriteConsole(buffer);
          }
        }
        if (next == DOWN_CHAR && !history.isEmpty()) {
          if (history.size() > 0) {
            StringBuffer cleaner=new StringBuffer();
            for (int i=0; i < buffer.length(); i++) {
              cleaner.append(" ");
            }
            rewriteConsole(cleaner);
            historyNum=historyNum < history.size() ? historyNum + 1 : history.size();
            if (historyNum == history.size()) {
              buffer=new StringBuffer("");
            }
 else {
              buffer=new StringBuffer(history.get(historyNum));
            }
            rewriteConsole(buffer);
          }
        }
 else {
        }
      }
 else {
        if (next == NEW_LINE_CHAR) {
          System.out.println();
          break;
        }
 else         if (next == DEL_CHAR) {
          if (buffer.length() > 0) {
            buffer.deleteCharAt(buffer.length() - 1);
            StringBuffer cleaner=new StringBuffer(buffer);
            cleaner.append(" ");
            rewriteConsole(cleaner);
            rewriteConsole(buffer);
          }
        }
 else         if (next == HORIZONTAL_TAB_CHAR) {
          StringBuffer cleaner=new StringBuffer();
          for (int i=0; i < buffer.length(); i++) {
            cleaner.append(" ");
          }
          buffer=writeHint(buffer);
          rewriteConsole(cleaner);
          rewriteConsole(buffer);
        }
 else {
          if (next > UNIT_SEPARATOR_CHAR && next < DEL_CHAR) {
            System.out.print((char)next);
            buffer.append((char)next);
          }
 else {
            System.out.println();
            System.out.print(buffer);
          }
        }
        historyNum=history.size();
      }
    }
    consoleInput=buffer.toString();
    history.remove(consoleInput);
    history.add(consoleInput);
    historyNum=history.size();
  }
 catch (  IOException e) {
    return null;
  }
  return consoleInput;
}
