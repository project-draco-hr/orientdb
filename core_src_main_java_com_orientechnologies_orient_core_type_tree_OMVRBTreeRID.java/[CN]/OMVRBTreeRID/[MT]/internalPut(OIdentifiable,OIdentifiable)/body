{
  if (e == null)   return null;
  ((OMVRBTreeRIDProvider)dataProvider).lazyUnmarshall();
  if (e.getIdentity().isNew()) {
    final ORecord<?> record=e.getRecord();
    if (record == null)     throw new OTransactionException("Cannot insert item in mvrb-tree because the transactional item was not found.");
    if (newEntries == null)     newEntries=new IdentityHashMap<ORecord<?>,Object>();
 else     if (newEntries.containsKey(record))     return record;
    newEntries.put(record,NEWMAP_VALUE);
    setDirty();
    return null;
  }
  final OIdentifiable oldValue=super.internalPut(e,null);
  if (!isMarshalling()) {
    if (oldValue != null)     fireCollectionChangedEvent(new OMultiValueChangeEvent<OIdentifiable,OIdentifiable>(OMultiValueChangeEvent.OChangeType.UPDATE,e,e,oldValue));
 else     fireCollectionChangedEvent(new OMultiValueChangeEvent<OIdentifiable,OIdentifiable>(OMultiValueChangeEvent.OChangeType.ADD,e,e));
  }
  return oldValue;
}
