{
  acquireExclusiveLock();
  try {
    if (valuesTransformer == null)     return map.size();
    OMVRBTreeEntry<Object,V> rootEntry=map.getRoot();
    long size=0;
    OMVRBTreeEntry<Object,V> currentEntry=rootEntry;
    map.setPageIndex(0);
    while (currentEntry != null) {
      size+=valuesTransformer.transformFromValue(currentEntry.getValue()).size();
      currentEntry=OMVRBTree.next(currentEntry);
    }
    map.setPageIndex(0);
    currentEntry=OMVRBTree.previous(rootEntry);
    while (currentEntry != null) {
      size+=valuesTransformer.transformFromValue(currentEntry.getValue()).size();
      currentEntry=OMVRBTree.previous(currentEntry);
    }
    return size;
  }
  finally {
    releaseExclusiveLock();
  }
}
