{
  final int expectedSize=960;
  final OBuddyMemory memory=new OBuddyMemory(expectedSize,64);
  Assert.assertEquals(memory.freeSpace(),expectedSize);
  final int chunkCount=expectedSize / 64;
  final List<Integer> pointers=new ArrayList<Integer>(chunkCount);
  for (int i=0; i < chunkCount; i++) {
    int pointer=memory.allocate(64 - OBuddyMemory.SYSTEM_INFO_SIZE);
    Assert.assertTrue(pointer != ODirectMemory.NULL_POINTER);
    pointers.add(pointer);
  }
  int nullPointer=memory.allocate(64 - OBuddyMemory.SYSTEM_INFO_SIZE);
  Assert.assertTrue(nullPointer == ODirectMemory.NULL_POINTER);
  for (  Integer pointer : pointers) {
    memory.free(pointer);
  }
  Assert.assertEquals(memory.freeSpace(),expectedSize);
}
