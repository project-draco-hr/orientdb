{
  final String localNode=manager.getLocalNodeName();
  manager.loadDatabaseConfiguration(databaseName,manager.getDistributedConfigFile(databaseName));
  final ODistributedConfiguration cfg=manager.getDatabaseConfiguration(databaseName);
  for (  String clusterName : cfg.getClusterNames()) {
    final List<List<String>> partitions=cfg.getPartitions(clusterName);
    if (partitions != null)     for (    List<String> partition : partitions) {
      for (      String node : partition)       if (node.equals(localNode))       return;
    }
  }
  boolean dirty=false;
  for (  String clusterName : cfg.getClusterNames()) {
    final List<List<String>> partitions=cfg.getPartitions(clusterName);
    if (partitions != null)     for (int p=0; p < partitions.size(); ++p) {
      List<String> partition=partitions.get(p);
      for (      String node : partition)       if (node.equalsIgnoreCase(ODistributedConfiguration.NEW_NODE_TAG)) {
        ODistributedServerLog.info(this,manager.getLocalNodeName(),null,DIRECTION.NONE,"adding node '%s' in partition: %s.%s.%d",localNode,databaseName,clusterName,p);
        partition.add(localNode);
        dirty=true;
        break;
      }
    }
  }
  if (dirty) {
    final ODocument doc=cfg.serialize();
    manager.getConfigurationMap().put(OHazelcastPlugin.CONFIG_DATABASE_PREFIX + databaseName,doc);
    manager.updateDatabaseConfiguration(databaseName,doc);
  }
}
