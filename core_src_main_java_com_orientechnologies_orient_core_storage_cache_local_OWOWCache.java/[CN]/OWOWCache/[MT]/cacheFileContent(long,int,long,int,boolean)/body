{
  final OFileClassic fileClassic=files.get(intId);
  if (fileClassic == null)   throw new IllegalArgumentException("File with id " + intId + " not found in WOW Cache");
  final OLogSequenceNumber lastLsn;
  if (writeAheadLog != null)   lastLsn=writeAheadLog.getFlushedLsn();
 else   lastLsn=new OLogSequenceNumber(-1,-1);
  final long firstPageStartPosition=startPageIndex * pageSize;
  final long firstPageEndPosition=firstPageStartPosition + pageSize;
  if (fileClassic.getFileSize() >= firstPageEndPosition) {
    final OSessionStoragePerformanceStatistic sessionStoragePerformanceStatistic=OSessionStoragePerformanceStatistic.getStatisticInstance();
    if (sessionStoragePerformanceStatistic != null) {
      sessionStoragePerformanceStatistic.startPageReadFromFileTimer();
    }
    storagePerformanceStatistic.startPageReadFromFileTimer();
    int pagesRead=0;
    try {
      if (pageCount == 1) {
        final byte[] content=new byte[pageSize + 2 * PAGE_PADDING];
        fileClassic.read(firstPageStartPosition,content,pageSize,PAGE_PADDING);
        final ODirectMemoryPointer pointer=ODirectMemoryPointerFactory.instance().createPointer(content);
        final OCachePointer dataPointer=new OCachePointer(pointer,lastLsn,fileId,startPageIndex);
        pagesRead=1;
        return new OCachePointer[]{dataPointer};
      }
      final long maxPageCount=(fileClassic.getFileSize() - firstPageStartPosition) / pageSize;
      final int realPageCount=Math.min((int)maxPageCount,pageCount);
      final byte[] content=new byte[realPageCount * pageSize];
      fileClassic.read(firstPageStartPosition,content,content.length);
      final OCachePointer[] dataPointers=new OCachePointer[realPageCount];
      for (int n=0; n < dataPointers.length; n++) {
        final byte[] pageContent=new byte[pageSize + 2 * PAGE_PADDING];
        System.arraycopy(content,n * pageSize,pageContent,PAGE_PADDING,pageSize);
        final ODirectMemoryPointer pointer=ODirectMemoryPointerFactory.instance().createPointer(pageContent);
        dataPointers[n]=new OCachePointer(pointer,lastLsn,fileId,startPageIndex + n);
      }
      pagesRead=dataPointers.length;
      return dataPointers;
    }
  finally {
      if (sessionStoragePerformanceStatistic != null) {
        sessionStoragePerformanceStatistic.stopPageReadFromFileTimer(pagesRead);
      }
      storagePerformanceStatistic.stopPageReadFromFileTimer(pagesRead);
    }
  }
 else   if (addNewPages) {
    final int space=(int)(firstPageEndPosition - fileClassic.getFileSize());
    if (space > 0)     fileClassic.allocateSpace(space);
    addAllocatedSpace(space);
    final byte[] content=new byte[pageSize + 2 * PAGE_PADDING];
    final ODirectMemoryPointer pointer=ODirectMemoryPointerFactory.instance().createPointer(content);
    OCachePointer dataPointer=new OCachePointer(pointer,lastLsn,fileId,startPageIndex);
    return new OCachePointer[]{dataPointer};
  }
 else   return new OCachePointer[0];
}
