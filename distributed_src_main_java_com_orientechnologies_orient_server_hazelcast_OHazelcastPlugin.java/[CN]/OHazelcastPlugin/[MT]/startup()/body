{
  if (!enabled)   return;
  OGlobalConfiguration.RID_BAG_EMBEDDED_TO_SBTREEBONSAI_THRESHOLD.setValue(Integer.MAX_VALUE);
  OGlobalConfiguration.RID_BAG_SBTREEBONSAI_TO_EMBEDDED_THRESHOLD.setValue(-1);
  OGlobalConfiguration.STORAGE_TRACK_CHANGED_RECORDS_IN_WAL.setValue(true);
  super.startup();
  status=NODE_STATUS.STARTING;
  final String localNodeName=getLocalNodeName();
  activeNodes.clear();
  try {
    hazelcastInstance=configureHazelcast();
    nodeId=hazelcastInstance.getCluster().getLocalMember().getUuid();
    OLogManager.instance().info(this,"Starting distributed server '%s' (hzID=%s)...",localNodeName,nodeId);
    timeOffset=System.currentTimeMillis() - hazelcastInstance.getCluster().getClusterTime();
    activeNodes.put(localNodeName,hazelcastInstance.getCluster().getLocalMember());
    membershipListenerRegistration=hazelcastInstance.getCluster().addMembershipListener(this);
    OServer.registerServerInstance(localNodeName,serverInstance);
    final IMap<String,Object> configurationMap=(IMap<String,Object>)getConfigurationMap();
    configurationMap.addEntryListener(this,true);
    for (    Member m : hazelcastInstance.getCluster().getMembers()) {
      if (!m.getUuid().equals(getLocalNodeId())) {
        final String memberName=getNodeName(m);
        if (memberName != null)         activeNodes.put(memberName,m);
 else         if (!m.equals(hazelcastInstance.getCluster().getLocalMember()))         ODistributedServerLog.warn(this,localNodeName,null,DIRECTION.NONE,"Cannot find configuration for member: %s",m);
      }
    }
    publishLocalNodeConfiguration();
    if (!configurationMap.containsKey(CONFIG_NODE_PREFIX + nodeId)) {
      ODistributedServerLog.error(this,localNodeName,null,DIRECTION.NONE,"Error on registering local node on cluster");
      System.exit(1);
    }
    messageService=new OHazelcastDistributedMessageService(this);
    installNewDatabases(true);
    loadDistributedDatabases();
    setNodeStatus(NODE_STATUS.ONLINE);
    publishLocalNodeConfiguration();
    final long delay=OGlobalConfiguration.DISTRIBUTED_PUBLISH_NODE_STATUS_EVERY.getValueAsLong();
    if (delay > 0)     Orient.instance().scheduleTask(new TimerTask(){
      @Override public void run(){
        publishLocalNodeConfiguration();
      }
    }
,delay,delay);
  }
 catch (  Exception e) {
    ODistributedServerLog.error(this,localNodeName,null,DIRECTION.NONE,"Error on starting distributed plugin",e);
    System.exit(1);
  }
}
