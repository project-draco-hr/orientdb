{
  if (deletedFiles.contains(fileId))   throw new OStorageException("File with id " + fileId + " is deleted.");
  FileChangesContainer changesContainer=fileChanges.get(fileId);
  if (changesContainer == null) {
    changesContainer=new FileChangesContainer();
    fileChanges.put(fileId,changesContainer);
  }
  FilePageChangesContainer pageChangesContainer=changesContainer.pageChangesMap.get(pageIndex);
  if (pageChangesContainer == null) {
    pageChangesContainer=new FilePageChangesContainer();
    changesContainer.pageChangesMap.put(pageIndex,pageChangesContainer);
  }
  if (changesContainer.isNew) {
    if (pageIndex <= changesContainer.maxNewPageIndex)     return new OCacheEntry(fileId,pageIndex,new OCachePointer((ODirectMemoryPointer)null,new OLogSequenceNumber(-1,-1)),false);
 else     return null;
  }
 else {
    final long filledUpTo=filledUpTo(fileId,diskCache);
    if (pageIndex < filledUpTo) {
      if (pageChangesContainer.isNew)       return new OCacheEntry(fileId,pageIndex,new OCachePointer((ODirectMemoryPointer)null,new OLogSequenceNumber(-1,-1)),false);
 else       return diskCache.load(fileId,pageIndex,checkPinnedPages);
    }
  }
  return null;
}
