{
  if (rid.clusterId > -1 && getStorageVersions().classesAreDetectedByClusterId() && isNew && record instanceof ODocument) {
    final ODocument recordSchemaAware=(ODocument)record;
    final OClass recordClass=ODocumentInternal.getImmutableSchemaClass(recordSchemaAware);
    final OClass clusterIdClass=((OMetadataInternal)metadata).getImmutableSchemaSnapshot().getClassByClusterId(rid.clusterId);
    if (recordClass == null && clusterIdClass != null || clusterIdClass == null && recordClass != null || (recordClass != null && !recordClass.equals(clusterIdClass)))     throw new OSchemaException("Record saved into cluster '" + iClusterName + "' should be saved with class '"+ clusterIdClass+ "' but has been created with class '"+ recordClass+ "'");
  }
}
