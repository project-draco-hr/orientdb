{
  final List<OrientGraphContext> contextsToRemove=new ArrayList<OrientGraphContext>();
synchronized (contexts) {
    for (    OrientGraphContext contextItem : contexts) {
      if (!contextItem.thread.isAlive())       contextsToRemove.add(contextItem);
    }
  }
  final OrientGraphContext context=getContext(false);
  if (context != null)   contextsToRemove.add(context);
  for (  OrientGraphContext contextItem : contextsToRemove) {
    try {
      if (!contextItem.rawGraph.isClosed())       contextItem.rawGraph.commit();
    }
 catch (    RuntimeException e) {
      OLogManager.instance().error(this,"Error during context close for db " + url,e);
      throw e;
    }
catch (    Exception e) {
      OLogManager.instance().error(this,"Error during context close for db " + url,e);
      throw new OException("Error during context close for db " + url,e);
    }
 finally {
      try {
        contextItem.rawGraph.close();
      }
 catch (      Exception e) {
        OLogManager.instance().error(this,"Error during context close for db " + url,e);
      }
    }
  }
synchronized (contexts) {
    for (    OrientGraphContext contextItem : contextsToRemove)     contexts.remove(contextItem);
  }
  threadContext.set(null);
}
