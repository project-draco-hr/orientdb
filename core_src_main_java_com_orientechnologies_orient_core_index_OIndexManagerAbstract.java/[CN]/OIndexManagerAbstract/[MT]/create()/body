{
  acquireExclusiveLock();
  try {
    try {
      save(OMetadataDefault.CLUSTER_INTERNAL_NAME);
    }
 catch (    Exception e) {
      if (document.getIdentity().getClusterPosition().isPersistent()) {
        document.getIdentity().reset();
        save(OMetadataDefault.CLUSTER_INTERNAL_NAME);
      }
    }
    getDatabase().getStorage().getConfiguration().indexMgrRecordId=document.getIdentity().toString();
    getDatabase().getStorage().getConfiguration().update();
    createIndex(DICTIONARY_NAME,OClass.INDEX_TYPE.DICTIONARY.toString(),new OSimpleKeyIndexDefinition(OType.STRING),null,null);
  }
  finally {
    releaseExclusiveLock();
  }
}
