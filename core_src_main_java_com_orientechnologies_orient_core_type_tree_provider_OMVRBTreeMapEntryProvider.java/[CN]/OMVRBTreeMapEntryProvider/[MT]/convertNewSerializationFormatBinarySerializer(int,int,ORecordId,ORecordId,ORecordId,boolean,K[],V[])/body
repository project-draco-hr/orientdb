{
  int bufferSize=2 * OIntegerSerializer.INT_SIZE;
  bufferSize+=OLinkSerializer.INSTANCE.getObjectSize(oldParentRid) * 3;
  bufferSize+=OBooleanSerializer.BOOLEAN_SIZE;
  bufferSize+=OIntegerSerializer.INT_SIZE;
  final OBinarySerializer<K> keySerializer=((OMVRBTreeMapProvider<K,V>)treeDataProvider).keySerializer;
  final OBinarySerializer<V> valueSerializer=(OBinarySerializer<V>)((OMVRBTreeMapProvider<K,V>)treeDataProvider).valueSerializer;
  for (int i=0; i < oldSize; ++i)   bufferSize+=keySerializer.getObjectSize(oldKeys[i]);
  for (int i=0; i < oldSize; ++i)   bufferSize+=valueSerializer.getObjectSize(oldValues[i]);
  byte[] outBuffer=new byte[bufferSize];
  int offset=serializeMetadata(outBuffer,oldSize,oldPageSize,oldParentRid,oldLeftRid,oldRightRid,oldColor);
  for (int i=0; i < oldSize; i++) {
    keySerializer.serialize(oldKeys[i],outBuffer,offset);
    offset+=keySerializer.getObjectSize(oldKeys[i]);
  }
  for (int i=0; i < oldSize; i++) {
    valueSerializer.serialize(oldValues[i],outBuffer,offset);
    offset+=valueSerializer.getObjectSize(oldValues[i]);
  }
  return outBuffer;
}
