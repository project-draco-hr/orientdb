{
  acquireWriteLock();
  try {
    final int offset=getFilledUpTo();
    final int size=getFileSize();
    if (getFreeSpace() < iSize) {
      if (maxSize > 0 && maxSize - size < iSize)       throw new IllegalArgumentException("Cannot enlarge file since the configured max size (" + OFileUtils.getSizeAsString(maxSize) + ") was reached! "+ toString());
      int newFileSize=size;
      if (newFileSize == 0)       newFileSize=DEFAULT_SIZE;
      int stepSizeInBytes=incrementSize > 0 ? incrementSize : -1 * size / 100 * incrementSize;
      while (newFileSize - offset <= iSize) {
        newFileSize+=stepSizeInBytes;
        if (newFileSize == 0)         newFileSize=iSize;
        if (newFileSize > maxSize && maxSize > 0)         newFileSize=maxSize;
      }
      setSize(newFileSize);
    }
    setFilledUpTo(offset + iSize);
    return offset;
  }
  finally {
    releaseWriteLock();
  }
}
