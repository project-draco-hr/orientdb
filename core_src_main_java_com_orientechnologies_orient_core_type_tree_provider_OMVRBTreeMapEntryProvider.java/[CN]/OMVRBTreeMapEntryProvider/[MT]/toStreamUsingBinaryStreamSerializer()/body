{
  int bufferSize=2 * OIntegerSerializer.INT_SIZE;
  bufferSize+=OLinkSerializer.INSTANCE.getObjectSize(parentRid) * 3;
  bufferSize+=OBooleanSerializer.BOOLEAN_SIZE;
  bufferSize+=OIntegerSerializer.INT_SIZE;
  for (int i=0; i < size; ++i)   bufferSize+=getKeySize(i);
  final byte[] outBuffer=new byte[bufferSize * 2];
  int offset=serializeMetadata(outBuffer,size,pageSize,parentRid,leftRid,rightRid,color);
  for (int i=0; i < size; i++) {
    offset=serializeKey(outBuffer,offset,i);
  }
  final OMemoryStream outStream=new OMemoryStream(outBuffer);
  try {
    outStream.jump(offset);
    for (int i=0; i < size; ++i)     serializedValues[i]=outStream.set(serializeStreamValue(i));
    buffer=outStream.toByteArray();
  }
  finally {
    outStream.close();
  }
  if (stream == null)   stream=new OMemoryStream(buffer);
 else   stream.setSource(buffer);
}
