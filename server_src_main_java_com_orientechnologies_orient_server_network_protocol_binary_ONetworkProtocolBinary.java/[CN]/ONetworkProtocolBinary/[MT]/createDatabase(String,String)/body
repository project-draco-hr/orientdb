{
  checkServerAccess("database.create");
  OLogManager.instance().info(this,"Creating database '%s' of type '%s'",iDbName,iStorageMode);
  final String path;
  if (iStorageMode.equals(OEngineLocal.NAME)) {
    if (OServerMain.server().existsStoragePath(iDbName))     throw new IllegalArgumentException("Database '" + iDbName + "' already exists.");
    path=iStorageMode + ":${ORIENTDB_HOME}/databases/" + iDbName+ "/"+ iDbName;
  }
 else   if (iStorageMode.equals(OEngineMemory.NAME)) {
    if (OServerMain.server().getMemoryDatabases().containsKey(iDbName))     throw new IllegalArgumentException("Database '" + iDbName + "' already exists.");
    path=iStorageMode + ":" + iDbName;
  }
 else   throw new IllegalArgumentException("Can't create databse: storage mode '" + iStorageMode + "' is not supported.");
  connection.database=new ODatabaseDocumentTx(path);
  connection.database.create();
  if (iStorageMode.equals(OEngineLocal.NAME)) {
    connection.database.close();
  }
 else   if (iStorageMode.equals(OEngineMemory.NAME)) {
    OServerMain.server().getMemoryDatabases().put(iDbName,connection.database);
  }
  underlyingDatabase=((ODatabaseRaw)((ODatabaseComplex<?>)connection.database.getUnderlying()).getUnderlying());
  invokeHandlerCallbackOnClientConnection();
  return connection.database;
}
