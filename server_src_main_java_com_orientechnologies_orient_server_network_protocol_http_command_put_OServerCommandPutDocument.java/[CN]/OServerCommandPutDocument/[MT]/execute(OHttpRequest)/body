{
  final String[] urlParts=checkSyntax(iRequest.url,2,"Syntax error: document/<database>[/<record-id>]");
  iRequest.data.commandInfo="Edit Document";
  ODatabaseDocumentTx db=null;
  ORecordId recordId=null;
  final ODocument doc;
  try {
    db=getProfiledDatabaseInstance(iRequest);
    if (urlParts.length > 2) {
      final int parametersPos=urlParts[2].indexOf('?');
      final String rid=parametersPos > -1 ? urlParts[2].substring(0,parametersPos) : urlParts[2];
      recordId=new ORecordId(rid);
      if (!recordId.isValid())       throw new IllegalArgumentException("Invalid Record ID in request: " + recordId);
      doc=new ODocument(db,recordId);
    }
 else     doc=new ODocument(db);
    doc.fromJSON(iRequest.content);
    if (!recordId.isValid())     recordId=(ORecordId)doc.getIdentity();
    if (!recordId.isValid())     throw new IllegalArgumentException("Invalid Record ID in request: " + recordId);
    doc.save();
  }
  finally {
    if (db != null)     OSharedDocumentDatabase.release(db);
  }
  sendTextContent(iRequest,OHttpUtils.STATUS_OK_CODE,"OK",null,OHttpUtils.CONTENT_TEXT_PLAIN,"Record " + recordId + " updated successfully.");
  return false;
}
