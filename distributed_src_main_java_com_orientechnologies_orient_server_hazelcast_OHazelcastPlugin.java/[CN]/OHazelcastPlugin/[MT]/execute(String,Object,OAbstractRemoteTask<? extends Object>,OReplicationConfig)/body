{
  String masterNodeId=null;
  try {
    if (iReplicationData == null || !(iTask instanceof OAbstractReplicatedTask)) {
      ODistributedThreadLocal.INSTANCE.set(iTask.getNodeSource());
      try {
        return ((OAbstractRemoteTask<? extends Object>)iTask).executeOnLocalNode();
      }
  finally {
        ODistributedThreadLocal.INSTANCE.set(null);
      }
    }
 else {
      if (!checkOperationSequence(iTask))       return null;
      final String dbName=iTask.getDatabaseName();
      if (iReplicationData != null) {
        iTask.setNodeDestination(iReplicationData.masterNode);
        iReplicationData.masterNode=waitUntilMasterNodeIsOnline(iClusterName,iKey,dbName,iReplicationData.masterNode);
        masterNodeId=iReplicationData.masterNode;
      }
      if (getLocalNodeId().equals(iReplicationData.masterNode))       return executeLocallyAndPropagate((OAbstractReplicatedTask<? extends Object>)iTask,iReplicationData);
 else       return executeRemotelyAndApplyLocally(iClusterName,iKey,(OAbstractReplicatedTask<? extends Object>)iTask,dbName,iReplicationData);
    }
  }
 catch (  InterruptedException e) {
    Thread.interrupted();
  }
catch (  ONeedRetryException e) {
    ODistributedServerLog.debug(this,getLocalNodeId(),masterNodeId,DIRECTION.OUT,"error on execution %d.%d of operation in %s mode raising a ONeedRetryException",iTask.getRunId(),iTask.getOperationSerial(),EXECUTION_MODE.SYNCHRONOUS);
    throw e;
  }
catch (  Exception e) {
    ODistributedServerLog.error(this,getLocalNodeId(),masterNodeId,DIRECTION.OUT,"error on execution %d.%d of operation in %s mode",e,iTask.getRunId(),iTask.getOperationSerial(),EXECUTION_MODE.SYNCHRONOUS);
    throw new ExecutionException("error on execution of operation " + iTask.getRunId() + "."+ iTask.getOperationSerial()+ " in "+ EXECUTION_MODE.SYNCHRONOUS+ " mode against node "+ masterNodeId,e);
  }
  return null;
}
