{
  channel.acquireExclusiveLock();
  try {
    channel.writeByte(OChannelBinaryProtocol.RESPONSE_STATUS_ERROR);
    channel.writeInt(iClientTxId);
    Throwable current;
    if (t instanceof OLockException && t.getCause() instanceof ODatabaseException)     current=t.getCause();
 else     current=t;
    while (current != null) {
      channel.writeByte((byte)1);
      channel.writeString(current.getClass().getName());
      channel.writeString(current != null ? current.getMessage() : null);
      current=current.getCause();
    }
    channel.writeByte((byte)0);
    channel.flush();
    if (OLogManager.instance().isLevelEnabled(logClientExceptions))     OLogManager.instance().log(this,logClientExceptions,"Sent run-time exception to the client %s: %s",current,channel.socket.getRemoteSocketAddress(),t);
  }
  finally {
    channel.releaseExclusiveLock();
  }
}
