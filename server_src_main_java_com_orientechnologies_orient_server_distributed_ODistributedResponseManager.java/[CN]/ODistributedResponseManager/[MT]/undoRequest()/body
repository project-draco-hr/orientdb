{
  if (!realignRecordClusters()) {
    for (    ODistributedResponse r : getReceivedResponses()) {
      final ORemoteTask task=request.getTask();
      if (task instanceof OAbstractReplicatedTask) {
        final ORemoteTask undoTask=((OAbstractReplicatedTask)task).getUndoTask(request.getId());
        if (undoTask != null) {
          final String targetNode=r.getExecutorNodeName();
          if (dManager.getLocalNodeName().equals(targetNode)) {
            try {
              undoTask.execute(request.getId(),dManager.getServerInstance(),dManager,(ODatabaseDocumentTx)ODatabaseRecordThreadLocal.INSTANCE.get());
            }
 catch (            Exception e) {
              ODistributedServerLog.error(this,dManager.getLocalNodeName(),targetNode,DIRECTION.NONE,"Error executing undo message (%s) on local node for request (%s)",undoTask,request);
            }
          }
 else {
            ODistributedServerLog.warn(this,dManager.getLocalNodeName(),targetNode,DIRECTION.OUT,"Sending undo message (%s) for request (%s) to server %s",undoTask,request,targetNode);
            dManager.sendRequest(request.getDatabaseName(),null,OMultiValue.getSingletonList(targetNode),undoTask,ODistributedRequest.EXECUTION_MODE.RESPONSE,null,null);
          }
        }
      }
    }
  }
}
