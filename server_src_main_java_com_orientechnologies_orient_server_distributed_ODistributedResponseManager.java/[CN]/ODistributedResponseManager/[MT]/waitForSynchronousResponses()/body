{
  final long beginTime=System.currentTimeMillis();
  synchronousResponsesLock.lock();
  try {
    long currentTimeout=synchTimeout;
    while (currentTimeout > 0 && ((waitForLocalNode && !receivedCurrentNode) || receivedResponses < expectedSynchronousResponses)) {
      if (synchronousResponsesArrived.await(currentTimeout,TimeUnit.MILLISECONDS))       break;
      final long elapsed=System.currentTimeMillis() - beginTime;
      currentTimeout=synchTimeout - elapsed;
    }
    return receivedResponses >= expectedSynchronousResponses;
  }
  finally {
    synchronousResponsesLock.unlock();
    Orient.instance().getProfiler().stopChrono("distributed.replication.synchResponses","Time to collect all the synchronous responses from distributed nodes",beginTime);
  }
}
