{
  if (projections != null) {
    final ODocument doc=(ODocument)(iRecord != null ? iRecord.getRecord() : null);
    final ODocument result=new ODocument().setOrdered(true);
    ((ORecordId)result.getIdentity()).clusterId=-2;
    ((ORecordId)result.getIdentity()).clusterPosition=resultCount;
    boolean canExcludeResult=false;
    Object value;
    for (    Entry<String,Object> projection : projections.entrySet()) {
      final Object v=projection.getValue();
      if (v.equals("*")) {
        doc.copy(result);
        value=null;
      }
 else       if (v.toString().startsWith("$")) {
        value=context != null ? context.getVariable(v.toString().substring(1)) : null;
      }
 else       if (v instanceof OSQLFilterItemField)       value=((OSQLFilterItemField)v).getValue(doc,null);
 else       if (v instanceof OSQLFunctionRuntime) {
        final OSQLFunctionRuntime f=(OSQLFunctionRuntime)v;
        canExcludeResult=f.filterResult();
        value=f.execute(doc,this);
      }
 else       value=v;
      if (value != null)       result.field(projection.getKey(),value);
    }
    if (canExcludeResult && result.isEmpty())     return null;
    if (anyFunctionAggregates)     return null;
    result.unsetDirty();
    return result;
  }
  return iRecord;
}
