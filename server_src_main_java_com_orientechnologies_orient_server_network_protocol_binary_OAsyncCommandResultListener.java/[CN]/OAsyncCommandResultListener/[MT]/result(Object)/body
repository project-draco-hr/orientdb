{
  if (empty.compareAndSet(true,false))   try {
    protocol.sendOk(txId);
  }
 catch (  IOException ignored) {
  }
  try {
    fetchRecord(iRecord,new ORemoteFetchListener(){
      @Override protected void sendRecord(      ORecord iLinked){
        if (!alreadySent.contains(iLinked.getIdentity())) {
          alreadySent.add(iLinked.getIdentity());
          try {
            if (protocol.connection.data.protocolVersion >= 17) {
              protocol.channel.writeByte((byte)2);
              protocol.writeIdentifiable(iLinked);
            }
          }
 catch (          IOException e) {
            OLogManager.instance().error(this,"Cannot write against channel",e);
          }
        }
      }
    }
);
    alreadySent.add(((OIdentifiable)iRecord).getIdentity());
    protocol.channel.writeByte((byte)1);
    protocol.writeIdentifiable(((OIdentifiable)iRecord).getRecord());
  }
 catch (  IOException e) {
    return false;
  }
  return true;
}
