{
  ODatabaseDocumentTx database=ODatabaseDocumentPool.global().acquire(getDatabaseURL(serverInstance.get(0)),"admin","admin");
  try {
    new ODocument("Customer").fields("name","Jay","surname","Miner").save();
    new ODocument("Customer").fields("name","Luke","surname","Skywalker").save();
    new ODocument("Provider").fields("name","Yoda","surname","Nothing").save();
    List<ODocument> result=database.query(new OSQLSynchQuery<OIdentifiable>("select count(*) from Person"));
    beginInstances=result.get(0).field("count");
  }
  finally {
    database.close();
  }
  System.out.println("Creating Writers and Readers threads...");
  final ExecutorService writerExecutors=Executors.newCachedThreadPool();
  final ExecutorService readerExecutors=Executors.newCachedThreadPool();
  int i=0;
  List<Callable<Void>> writerWorkers=new ArrayList<Callable<Void>>();
  for (  ServerRun server : serverInstance) {
    for (int j=0; j < writerCount; j++) {
      Writer writer=new Writer(i++,getDatabaseURL(server));
      writerWorkers.add(writer);
    }
  }
  List<Future<Void>> futures=writerExecutors.invokeAll(writerWorkers);
  List<Reader> readerWorkers=new ArrayList<Reader>();
  for (  ServerRun server : serverInstance) {
    Reader reader=new Reader(getDatabaseURL(server));
    readerWorkers.add(reader);
  }
  List<Future<Void>> rFutures=readerExecutors.invokeAll(readerWorkers);
  System.out.println("Threads started, waiting for the end");
  for (  Future<Void> future : futures) {
    future.get();
  }
  writerExecutors.shutdown();
  Assert.assertTrue(writerExecutors.awaitTermination(1,TimeUnit.MINUTES));
  System.out.println("All writer threads have finished, shutting down readers");
  readerExecutors.shutdown();
  for (  Reader r : readerWorkers) {
    r.running=false;
  }
  for (  Future<Void> future : rFutures) {
    future.cancel(true);
  }
  Assert.assertTrue(writerExecutors.awaitTermination(1,TimeUnit.MINUTES));
  System.out.println("All threads have finished, shutting down server instances");
  for (  ServerRun server : serverInstance) {
    printStats(getDatabaseURL(server));
  }
  checkInsertedEntries();
  checkIndexedEntries();
  dropIndexNode1();
  recreateIndexNode2();
}
