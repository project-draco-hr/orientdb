{
  checkSyntax(iRequest.url,2,"Syntax error: batch/<database>");
  iRequest.data.commandInfo="Execute multiple requests in one shot";
  ODatabaseDocumentTx db=null;
  ODocument batch=null;
  int executed=0;
  try {
    db=getProfiledDatabaseInstance(iRequest);
    batch=new ODocument().fromJSON(iRequest.content);
    Boolean tx=batch.field("transaction");
    if (tx == null)     tx=false;
    final Collection<Map<Object,Object>> operations;
    try {
      operations=batch.field("operations");
    }
 catch (    Exception e) {
      throw new IllegalArgumentException("Expected 'operations' field as a collection of objects");
    }
    if (operations == null || operations.isEmpty())     throw new IllegalArgumentException("Input JSON has no operations to execute");
    if (tx)     db.begin();
    for (    Map<Object,Object> operation : operations) {
      final String type=(String)operation.get("type");
      if (type.equals("c")) {
        final ODocument doc=getRecord(operation);
        doc.save();
        executed++;
      }
 else       if (type.equals("u")) {
        final ODocument doc=getRecord(operation);
        doc.save();
        executed++;
      }
 else       if (type.equals("d")) {
        final ODocument doc=getRecord(operation);
        db.delete(doc.getIdentity());
        executed++;
      }
 else       if (type.equals("cmd")) {
        final String language=(String)operation.get("language");
        final String command=(String)operation.get("command");
        final OCommandRequestText cmd=(OCommandRequestText)OCommandManager.instance().getRequester(language);
        cmd.setText(command);
        db.command(cmd).execute();
        executed++;
      }
 else       if (type.equals("script")) {
        final String language=(String)operation.get("language");
        final Object script=operation.get("script");
        StringBuilder text=new StringBuilder();
        if (OMultiValue.isMultiValue(script)) {
          int i=0;
          for (          Object o : OMultiValue.getMultiValueIterable(script)) {
            if (o != null) {
              if (i > 0)               text.append("\n");
              text.append(o.toString());
            }
          }
        }
 else         text.append(script);
        db.command(new OCommandScript(language,text.toString())).execute();
        executed++;
      }
    }
    if (tx)     db.commit();
  }
  finally {
    if (db != null)     db.close();
  }
  iResponse.send(OHttpUtils.STATUS_OK_CODE,OHttpUtils.STATUS_OK_DESCRIPTION,OHttpUtils.CONTENT_TEXT_PLAIN,executed,null,true);
  return false;
}
