{
  if (rec == null)   return;
  try {
    if (rec.getIdentity().isValid())     rec.load();
    if (recordExported > 0)     writer.append(",");
    writer.append(rec.toJSON("rid,type,version,class,attribSameRow,indent:4"));
  }
 catch (  Throwable t) {
    throw new ODatabaseExportException("Error on exporting record #" + rec.getIdentity() + " with content (as string): "+ new String(rec.toStream()),t);
  }
  recordExported++;
  recordNum++;
  if (recordTot > 10 && (recordNum + 1) % (recordTot / 10) == 0)   listener.onMessage(".");
}
