{
  setDataCommandInfo("Connect");
  readConnectionData();
  connection.serverUser=server.serverLogin(channel.readString(),channel.readString(),"connect");
  beginResponse();
  try {
    sendOk(clientTxId);
    channel.writeInt(connection.id);
    if (connection.data.protocolVersion > OChannelBinaryProtocol.PROTOCOL_VERSION_26) {
      connection.data.serverUsername=connection.serverUser.name;
      connection.data.serverUser=true;
      byte[] token;
      if (tokenHandler != null) {
        token=tokenHandler.getSignedBinaryToken(null,null,connection.data);
      }
 else       token=new byte[]{};
      channel.writeBytes(token);
    }
  }
  finally {
    endResponse();
  }
}
