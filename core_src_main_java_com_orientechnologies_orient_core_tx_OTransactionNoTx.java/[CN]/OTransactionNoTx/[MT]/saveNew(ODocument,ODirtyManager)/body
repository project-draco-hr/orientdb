{
  LinkedList<ODocument> path=new LinkedList<ODocument>();
  ORecord next=document;
  do {
    if (next instanceof ODocument) {
      path.push((ODocument)next);
      ORecord nextToInspect=null;
      List<OIdentifiable> toSave=manager.getPointed(document);
      if (toSave != null) {
        for (        OIdentifiable oIdentifiable : toSave) {
          if (oIdentifiable.getIdentity().isNew()) {
            if (oIdentifiable instanceof ORecord)             nextToInspect=(ORecord)oIdentifiable;
 else             nextToInspect=oIdentifiable.getRecord();
            break;
          }
        }
      }
      if (nextToInspect != null) {
        if (path.contains(nextToInspect)) {
          OSerializationSetThreadLocal.checkAndAdd((ODocument)nextToInspect);
          database.executeSaveRecord(nextToInspect,null,nextToInspect.getRecordVersion(),true,OPERATION_MODE.SYNCHRONOUS,false,null,null);
          path.pollFirst();
          next=path.pollFirst();
        }
 else         next=nextToInspect;
      }
 else {
        database.executeSaveRecord(next,null,next.getRecordVersion(),true,OPERATION_MODE.SYNCHRONOUS,false,null,null);
        path.pollFirst();
        next=path.pollFirst();
      }
    }
 else {
      database.executeSaveRecord(next,null,next.getRecordVersion(),true,OPERATION_MODE.SYNCHRONOUS,false,null,null);
      next=path.pollFirst();
    }
  }
 while (next != null);
}
