{
  int currentPos=0;
  final StringBuilder word=new StringBuilder();
  currentPos=OSQLHelper.nextWord(text,textUpperCase,currentPos,word,true);
  if (!word.toString().equals(KEYWORD_SELECT))   return -1;
  int fromPosition=textUpperCase.indexOf(KEYWORD_FROM,currentPos);
  if (fromPosition == -1)   throw new OQueryParsingException("Missed " + KEYWORD_FROM,text,currentPos);
  Object projectionValue;
  final String projectionString=text.substring(currentPos,fromPosition).trim();
  if (projectionString.length() > 0 && !projectionString.equals("*")) {
    projections=new HashMap<String,Object>();
    final String[] items=projectionString.split(",");
    String fieldName;
    int pos;
    for (    String projection : items) {
      projection=projection.trim();
      fieldName=null;
      pos=projection.toUpperCase().indexOf(KEYWORD_AS);
      if (pos > -1) {
        fieldName=projection.substring(pos + KEYWORD_AS.length()).trim();
        projection=projection.substring(0,pos).trim();
        if (projections.containsKey(fieldName))         throw new OCommandSQLParsingException("Field '" + fieldName + "' is duplicated in current SELECT, choose a different name");
      }
 else {
        pos=projection.indexOf('.');
        fieldName=pos > -1 ? projection.substring(0,pos) : projection;
        fieldName=OSQLHelper.stringContent(fieldName);
        for (int fieldIndex=2; projections.containsKey(fieldName); ++fieldIndex) {
          fieldName+=fieldIndex;
        }
      }
      if (projection.startsWith("FLATTEN(")) {
        List<String> pars=OStringSerializerHelper.getParameters(projection);
        if (pars.size() != 1)         throw new OCommandSQLParsingException("FLATTEN operator expects the field name as parameter. Example FLATTEN( outEdges )");
        flattenField=pars.get(0).trim();
        projections=null;
        continue;
      }
      projectionValue=OSQLHelper.parseValue(database,this,projection);
      projections.put(fieldName,projectionValue);
      if (!anyFunctionAggregates && projectionValue instanceof OSQLFunctionRuntime && ((OSQLFunctionRuntime)projectionValue).aggregateResults())       anyFunctionAggregates=true;
    }
  }
  currentPos=fromPosition + KEYWORD_FROM.length() + 1;
  return currentPos;
}
