{
  final OMemoryOutputStream buffer=new OMemoryOutputStream();
  try {
    buffer.add(text);
    if (parameters == null || parameters.size() == 0) {
      buffer.add(false);
      buffer.add(false);
    }
 else {
      final Map<Object,Object> params=new HashMap<Object,Object>();
      final Map<Object,byte[]> compositeKeyParams=new HashMap<Object,byte[]>();
      for (      final Entry<Object,Object> paramEntry : parameters.entrySet())       if (paramEntry.getValue() instanceof OCompositeKey)       compositeKeyParams.put(paramEntry.getKey(),OCompositeKeySerializer.INSTANCE.toStream(database,paramEntry.getValue()));
 else       params.put(paramEntry.getKey(),paramEntry.getValue());
      buffer.add(!params.isEmpty());
      if (!params.isEmpty()) {
        final ODocument param=new ODocument(database);
        param.field("params",params);
        buffer.add(param.toStream());
      }
      buffer.add(!compositeKeyParams.isEmpty());
      if (!compositeKeyParams.isEmpty()) {
        final ODocument compositeKey=new ODocument(database);
        compositeKey.field("compositeKeyParams",compositeKeyParams);
        buffer.add(compositeKey.toStream());
      }
    }
  }
 catch (  IOException e) {
    throw new OSerializationException("Error while marshalling OCommandRequestTextAbstract impl",e);
  }
  return buffer.toByteArray();
}
