{
  filesLock.writeLock().lock();
  try {
    if (flush)     flush(fileId);
 else     removeCachedPages(fileId);
    files.get(fileId).close();
  }
  finally {
    filesLock.writeLock().unlock();
  }
}
