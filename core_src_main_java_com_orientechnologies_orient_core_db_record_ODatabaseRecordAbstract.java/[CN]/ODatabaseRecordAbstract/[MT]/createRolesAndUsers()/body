{
  final OClass roleClass=metadata.getSchema().createClass("ORole");
  roleClass.createProperty("mode",OType.BYTE);
  roleClass.createProperty("rules",OType.EMBEDDEDMAP,OType.BYTE);
  final OClass userClass=metadata.getSchema().createClass("OUser");
  userClass.createProperty("roles",OType.LINKSET,roleClass);
  metadata.getSchema().save();
  final ORole adminRole=metadata.getSecurity().createRole(ORole.ADMIN,ORole.ALLOW_MODES.ALLOW_ALL_BUT);
  user=metadata.getSecurity().createUser(OUser.ADMIN,OUser.ADMIN,new String[]{adminRole.getName()});
  final ORole readerRole=metadata.getSecurity().createRole("reader",ORole.ALLOW_MODES.DENY_ALL_BUT);
  readerRole.addRule(ODatabaseSecurityResources.DATABASE,ORole.PERMISSION_READ);
  readerRole.addRule(ODatabaseSecurityResources.CLUSTER + "." + OStorage.CLUSTER_INTERNAL_NAME,ORole.PERMISSION_READ);
  readerRole.addRule(ODatabaseSecurityResources.CLUSTER + ".orole",ORole.PERMISSION_READ);
  readerRole.addRule(ODatabaseSecurityResources.CLUSTER + ".ouser",ORole.PERMISSION_READ);
  readerRole.addRule(ODatabaseSecurityResources.ALL_CLASSES,ORole.PERMISSION_READ);
  readerRole.addRule(ODatabaseSecurityResources.ALL_CLUSTERS,ORole.PERMISSION_READ);
  readerRole.addRule(ODatabaseSecurityResources.QUERY,ORole.PERMISSION_READ);
  readerRole.addRule(ODatabaseSecurityResources.COMMAND,ORole.PERMISSION_READ);
  readerRole.addRule(ODatabaseSecurityResources.RECORD_HOOK,ORole.PERMISSION_READ);
  readerRole.save();
  metadata.getSecurity().createUser("reader","reader",new String[]{readerRole.getName()});
  final ORole writerRole=metadata.getSecurity().createRole("writer",ORole.ALLOW_MODES.DENY_ALL_BUT);
  writerRole.addRule(ODatabaseSecurityResources.DATABASE,ORole.PERMISSION_READ);
  writerRole.addRule(ODatabaseSecurityResources.CLUSTER + "." + OStorage.CLUSTER_INTERNAL_NAME,ORole.PERMISSION_READ);
  writerRole.addRule(ODatabaseSecurityResources.CLUSTER + ".orole",ORole.PERMISSION_READ);
  writerRole.addRule(ODatabaseSecurityResources.CLUSTER + ".ouser",ORole.PERMISSION_READ);
  writerRole.addRule(ODatabaseSecurityResources.ALL_CLASSES,ORole.PERMISSION_ALL);
  writerRole.addRule(ODatabaseSecurityResources.ALL_CLUSTERS,ORole.PERMISSION_ALL);
  writerRole.addRule(ODatabaseSecurityResources.QUERY,ORole.PERMISSION_READ);
  writerRole.addRule(ODatabaseSecurityResources.COMMAND,ORole.PERMISSION_ALL);
  writerRole.addRule(ODatabaseSecurityResources.RECORD_HOOK,ORole.PERMISSION_ALL);
  writerRole.save();
  metadata.getSecurity().createUser("writer","writer",new String[]{writerRole.getName()});
}
