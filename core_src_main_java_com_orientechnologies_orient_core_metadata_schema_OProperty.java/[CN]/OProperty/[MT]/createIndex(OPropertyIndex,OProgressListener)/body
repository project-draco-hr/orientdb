{
  if (index != null)   throw new IllegalStateException("Index already created");
  try {
    index=iIndexInstance;
    index.create(document.getDatabase(),this,OStorage.CLUSTER_INDEX_NAME,iProgressListener);
    setDirty();
    if (document.getDatabase() != null) {
      index.lazySave();
      document.getDatabase().getMetadata().getSchema().save();
    }
  }
 catch (  OIndexException e) {
    if (index != null) {
      index.clear();
      document.getDatabase().getMetadata().getSchema().save();
    }
    throw e;
  }
catch (  Exception e) {
    if (index != null) {
      index.clear();
      document.getDatabase().getMetadata().getSchema().save();
    }
    OLogManager.instance().exception("Unable to create index of type '%s' for property: %s",e,ODatabaseException.class,iIndexInstance.toString(),toString());
  }
  return index;
}
