{
  if (firstMasterRecord != null) {
    int index=firstMasterRecord.getSegment() - logSegments.get(0).getOrder();
    if (logSegments.size() <= index || index < 0) {
      firstMasterRecord=null;
    }
 else {
      LogSegment firstMasterRecordSegment=logSegments.get(index);
      if (firstMasterRecordSegment.filledUpTo() <= firstMasterRecord.getPosition())       firstMasterRecord=null;
    }
  }
  if (secondMasterRecord != null) {
    int index=secondMasterRecord.getSegment() - logSegments.get(0).getOrder();
    if (logSegments.size() <= index || index < 0) {
      secondMasterRecord=null;
    }
 else {
      LogSegment secondMasterRecordSegment=logSegments.get(index);
      if (secondMasterRecordSegment.filledUpTo() <= secondMasterRecord.getPosition())       secondMasterRecord=null;
    }
  }
  if (firstMasterRecord != null && secondMasterRecord != null)   return;
  if (firstMasterRecord == null && secondMasterRecord == null) {
    masterRecordLSNHolder.setLength(0);
    masterRecordLSNHolder.getFD().sync();
    lastCheckpoint=null;
  }
 else {
    if (secondMasterRecord == null)     secondMasterRecord=firstMasterRecord;
 else     firstMasterRecord=secondMasterRecord;
    lastCheckpoint=firstMasterRecord;
    writeMasterRecord(0,firstMasterRecord);
    writeMasterRecord(1,secondMasterRecord);
  }
}
