{
  final long dataPtr;
  if (data != null) {
    dataPtr=memory.allocate(serializer.getObjectSize(data));
    if (dataPtr == ODirectMemory.NULL_POINTER)     throw new IllegalStateException("There is no enough memory to allocate for item " + data);
    memory.set(dataPtr,data,serializer);
  }
 else   dataPtr=ODirectMemory.NULL_POINTER;
  final long offset=index * 8 + 4;
  final long oldPtr=memory.getLong(ptr + offset);
  if (oldPtr != ODirectMemory.NULL_POINTER)   memory.free(oldPtr);
  memory.setLong(ptr + offset,dataPtr);
}
