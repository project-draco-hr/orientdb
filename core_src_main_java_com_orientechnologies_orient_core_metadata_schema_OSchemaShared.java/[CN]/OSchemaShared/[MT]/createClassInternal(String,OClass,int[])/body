{
  if (iClusterIds == null || iClusterIds.length == 0)   throw new IllegalArgumentException("clusterIds list can't be null or empty");
  getDatabase().checkSecurity(ODatabaseSecurityResources.SCHEMA,ORole.PERMISSION_CREATE);
  final String key=iClassName.toLowerCase();
  lock.acquireExclusiveLock();
  try {
    if (classes.containsKey(key))     throw new OSchemaException("Class " + iClassName + " already exists in current database");
    final OClassImpl cls=new OClassImpl(this,classes.size(),iClassName,iClusterIds);
    classes.put(key,cls);
    if (cls.getShortName() != null)     classes.put(cls.getShortName().toLowerCase(),cls);
    if (iSuperClass != null)     cls.setSuperClassInternal(iSuperClass);
    saveInternal();
    return cls;
  }
  finally {
    lock.releaseExclusiveLock();
  }
}
