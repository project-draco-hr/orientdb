{
  final OImmutableClass cls=ODocumentInternal.getImmutableSchemaClass(iDocument);
  if (cls != null && cls.isRestricted()) {
    final ODatabaseDocument db=ODatabaseRecordThreadLocal.INSTANCE.get();
    if (db.getUser() == null)     return true;
    if (db.getUser().isRuleDefined(ORule.ResourceGeneric.BYPASS_RESTRICTED,null))     if (db.getUser().checkIfAllowed(ORule.ResourceGeneric.BYPASS_RESTRICTED,null,ORole.PERMISSION_READ) != null)     return true;
    final ODocument doc;
    if (iReadOriginal)     doc=(ODocument)db.load(iDocument.getIdentity());
 else     doc=iDocument;
    return db.getMetadata().getSecurity().isAllowed((Set<OIdentifiable>)doc.field(OSecurityShared.ALLOW_ALL_FIELD),(Set<OIdentifiable>)doc.field(iAllowOperation));
  }
  return true;
}
