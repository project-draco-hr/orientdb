{
  final ORecordInternal<?> replicaToAdd;
  if (record instanceof ODocument) {
    if (rid == null)     replicaToAdd=new ODocument();
 else     replicaToAdd=load(rid,"*:0",false,true,OStorage.LOCKING_STRATEGY.DEFAULT);
    ((ODocument)replicaToAdd).merge((ODocument)record,false,false);
    replicaToAdd.getRecordVersion().copyFrom(record.getRecordVersion());
    replicaToAdd.setIdentity(this.rid);
  }
 else   replicaToAdd=(ORecordInternal<?>)record.copy();
  return replicaToAdd;
}
