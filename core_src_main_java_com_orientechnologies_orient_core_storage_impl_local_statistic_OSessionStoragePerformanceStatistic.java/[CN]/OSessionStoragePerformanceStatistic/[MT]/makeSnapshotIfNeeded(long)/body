{
  if (currentTime < 0) {
    currentTime=nanoTimer.getNano();
  }
  if (lastSnapshotTimestamp == -1)   lastSnapshotTimestamp=0;
  if (lastSnapshotTimestamp < 0 || currentTime - lastSnapshotTimestamp >= intervalBetweenSnapshots) {
    snapshot=new PerformanceSnapshot(performanceCountersHolder,countersByComponent);
    lastSnapshotTimestamp=currentTime;
    if (cleanOnSnapshot) {
      performanceCountersHolder.clean();
      for (      PerformanceCountersHolder pch : countersByComponent.values()) {
        pch.clean();
      }
    }
  }
}
