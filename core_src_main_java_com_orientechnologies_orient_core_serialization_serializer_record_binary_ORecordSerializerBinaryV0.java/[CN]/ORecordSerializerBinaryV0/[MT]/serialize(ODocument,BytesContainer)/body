{
  short[] pos=new short[document.fields()];
  int i=0;
  Entry<String,?> values[]=new Entry[document.fields()];
  for (  Entry<String,Object> entry : document) {
    writeString(bytes,entry.getKey());
    pos[i]=bytes.alloc((short)3);
    values[i]=entry;
    i++;
  }
  OVarIntSerializer.write(bytes,0);
  for (i=0; i < values.length; i++) {
    short pointer=0;
    Object value=values[i].getValue();
    if (value != null) {
      OType type=getFieldType(document,values[i].getKey(),value);
      if (type == null)       continue;
      pointer=writeSingleValue(bytes,value,type);
      OShortSerializer.INSTANCE.serialize(pointer,bytes.bytes,pos[i]);
      writeOType(bytes,(short)(pos[i] + 2),type);
    }
  }
}
