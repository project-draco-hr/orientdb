{
  ODatabaseFlat db1=new ODatabaseFlat(url);
  db1.open("admin","admin");
  ODatabaseFlat db2=new ODatabaseFlat(url);
  db2.open("admin","admin");
  ORecordFlat record1=new ORecordFlat(db1);
  record1.value("This is the first version").save();
  try {
    db1.begin();
    record1.load();
    ORecordFlat record2=db2.load(record1.getIdentity());
    db2.save(record2.value("This is the second version"));
    db1.save(record1.value("This is the third version"));
    db1.commit();
    Assert.assertTrue(false);
  }
 catch (  OResponseProcessingException e) {
    Assert.assertTrue(e.getCause() instanceof OConcurrentModificationException);
    db1.rollback();
  }
catch (  OConcurrentModificationException e) {
    Assert.assertTrue(true);
    db1.rollback();
  }
 finally {
    db1.close();
    db2.close();
  }
}
