{
  long totalRecords=0;
  final String[] clusters=database.getClusterNames().toArray(new String[database.getClusterNames().size()]);
  int level=1;
  listener.onMessage("\nExporting records...");
  writer.beginCollection(level,true,"records");
  for (  String clusterName : clusters) {
    long recordTot=database.countClusterElements(clusterName);
    listener.onMessage("\n- Exporting record of cluster '" + clusterName + "'...");
    long recordNum=0;
    for (    ORecordInternal<?> rec : database.browseCluster(clusterName))     exportRecord(recordTot,recordNum++,rec);
    listener.onMessage("OK (records=" + recordTot + ")");
    totalRecords+=recordTot;
  }
  writer.endCollection(level,true);
  listener.onMessage("\n\nDone. Exported " + totalRecords + " records\n");
  return totalRecords;
}
