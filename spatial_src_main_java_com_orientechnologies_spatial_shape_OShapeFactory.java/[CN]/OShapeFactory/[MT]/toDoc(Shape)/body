{
  ODocument doc=null;
  if (Point.class.isAssignableFrom(shape.getClass())) {
    doc=factories.get(OPointShapeBuilder.NAME).toDoc(shape);
  }
 else   if (Rectangle.class.isAssignableFrom(shape.getClass())) {
    doc=factories.get(ORectangleShapeBuilder.NAME).toDoc(shape);
  }
 else   if (JtsGeometry.class.isAssignableFrom(shape.getClass())) {
    JtsGeometry geometry=(JtsGeometry)shape;
    Geometry geom=geometry.getGeom();
    doc=factories.get("O" + geom.getClass().getSimpleName()).toDoc(shape);
  }
 else   if (ShapeCollection.class.isAssignableFrom(shape.getClass())) {
    ShapeCollection collection=(ShapeCollection)shape;
    if (isMultiPolygon(collection)) {
      doc=factories.get("OMultiPolygon").toDoc(createMultiPolygon(collection));
    }
 else     if (isMultiPoint(collection)) {
      doc=factories.get("OMultiPoint").toDoc(createMultiPoint(collection));
    }
 else     if (isMultiLine(collection)) {
      doc=factories.get("OMultiLineString").toDoc(createMultiLine(collection));
    }
 else {
      doc=factories.get("OGeometryCollection").toDoc(shape);
    }
  }
  return doc;
}
