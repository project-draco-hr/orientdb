{
  LockEntry<RESOURCE_TYPE,REQUESTER_TYPE> lock=tryToAcquireLock(iRequester,iResourceId,iLockType);
  if (lock.status == LOCK_STATUS.LIVE)   return;
synchronized (lock) {
    lock.status=LOCK_STATUS.WAITING;
    long time=iTimeout > 0 ? System.currentTimeMillis() : 0;
    do {
      try {
        lock.wait(iTimeout <= 0 ? Long.MAX_VALUE : iTimeout);
      }
 catch (      InterruptedException e) {
      }
    }
 while (lock.status == LOCK_STATUS.WAITING && (iTimeout > 0 && time + iTimeout > System.currentTimeMillis()));
    if (lock.status == LOCK_STATUS.WAITING) {
      lock.status=LOCK_STATUS.EXPIRED;
      throw new OLockException("Resource " + iResourceId + " is locked");
    }
  }
}
