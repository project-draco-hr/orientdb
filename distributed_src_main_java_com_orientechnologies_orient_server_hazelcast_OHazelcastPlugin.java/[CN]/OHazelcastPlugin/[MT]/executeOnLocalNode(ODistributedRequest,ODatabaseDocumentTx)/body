{
  if (database != null && !(database.getStorage() instanceof ODistributedStorage))   throw new ODistributedException("Distributed storage was not installed for database '" + database.getName() + "'. Implementation found: "+ database.getStorage().getClass().getName());
  final ORemoteTask task=req.getTask();
  try {
    if (database != null)     ((ODistributedStorage)database.getStorage()).setLastOperationId(req.getId());
    Object result=task.execute(serverInstance,this,database);
    if (result instanceof Throwable && !(result instanceof OException))     ODistributedServerLog.error(this,nodeName,req.getSenderNodeName(),DIRECTION.IN,"error on executing request %d (%s) on local node: ",(Throwable)result,req.getId(),req.getTask());
    if (!(result instanceof DataSerializable))     result=new OSerializableWrappedResponse((Serializable)result);
    return (DataSerializable)result;
  }
 catch (  Throwable e) {
    if (!(e instanceof OException))     ODistributedServerLog.error(this,nodeName,req.getSenderNodeName(),DIRECTION.IN,"error on executing distributed request %d on local node: %s",e,req.getId(),req.getTask());
    return new OSerializableWrappedResponse(e);
  }
}
