{
  ODocument doc=null;
  if (Point.class.isAssignableFrom(shape.getClass())) {
    doc=factories.get(Point.class.getSimpleName()).toDoc(shape);
  }
 else   if (Rectangle.class.isAssignableFrom(shape.getClass())) {
    doc=factories.get(Rectangle.class.getSimpleName()).toDoc(shape);
  }
 else   if (JtsGeometry.class.isAssignableFrom(shape.getClass())) {
    JtsGeometry geometry=(JtsGeometry)shape;
    Geometry geom=geometry.getGeom();
    doc=factories.get(geom.getClass().getSimpleName()).toDoc(shape);
  }
 else   if (ShapeCollection.class.isAssignableFrom(shape.getClass())) {
    ShapeCollection collection=(ShapeCollection)shape;
    if (isMultiPolygon(collection)) {
      doc=factories.get("MultiPolygon").toDoc(createMultiPolygon(collection));
    }
 else     if (isMultiPoint(collection)) {
      doc=factories.get("MultiPoint").toDoc(createMultiPoint(collection));
    }
 else     if (isMultiLine(collection)) {
      doc=factories.get("MultiLineString").toDoc(createMultiLine(collection));
    }
 else {
      doc=factories.get("GeometryCollection").toDoc(shape);
    }
  }
  return doc;
}
