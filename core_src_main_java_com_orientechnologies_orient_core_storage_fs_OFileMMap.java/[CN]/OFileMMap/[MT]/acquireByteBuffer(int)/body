{
  if (iSize > BYTEBUFFER_POOLABLE_SIZE) {
    try {
      OProfiler.getInstance().updateStat("MMap.extraBufferSize",iSize);
      return ByteBuffer.allocate(iSize);
    }
 catch (    OutOfMemoryError e) {
      OLogManager.instance().error(this,"Error on allocating direct buffer of size %d bytes",e,iSize);
      throw e;
    }
  }
  final ByteBuffer buffer;
  if (bufferPool.isEmpty()) {
    buffer=ByteBuffer.allocateDirect(BYTEBUFFER_POOLABLE_SIZE);
    OProfiler.getInstance().updateStat("MMap.pooledBufferSize",BYTEBUFFER_POOLABLE_SIZE);
  }
 else {
    buffer=bufferPool.poll();
    OProfiler.getInstance().updateCounter("MMap.pooledBuffers",-1);
  }
  buffer.limit(iSize);
  return buffer;
}
