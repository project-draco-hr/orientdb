{
  if (map.size() == 0)   return 0;
  acquireExclusiveLock();
  try {
    OMVRBTreeEntry<Object,Set<OIdentifiable>> rootEntry=map.getRoot();
    long size=0;
    OMVRBTreeEntry<Object,Set<OIdentifiable>> currentEntry=rootEntry;
    map.setPageIndex(0);
    while (currentEntry != null) {
      size+=currentEntry.getValue().size();
      currentEntry=OMVRBTree.next(currentEntry);
    }
    map.setPageIndex(0);
    currentEntry=OMVRBTree.previous(rootEntry);
    while (currentEntry != null) {
      size+=currentEntry.getValue().size();
      currentEntry=OMVRBTree.previous(currentEntry);
    }
    return size;
  }
  finally {
    releaseExclusiveLock();
  }
}
