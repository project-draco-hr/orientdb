{
  final OSessionStoragePerformanceStatistic statistic=performanceStatisticManager.getSessionPerformanceStatistic();
  if (statistic != null)   statistic.startFuzzyCheckpointTimer();
  try {
    OLogSequenceNumber minLsn=findMinLsn(writeAheadLog.getFlushedLsn(),writeCachePages);
    OLogManager.instance().debug(this,"Start fuzzy checkpoint flushed LSN is %s",minLsn);
    try {
      writeAheadLog.logFuzzyCheckPointStart(minLsn);
      for (      Long fileId : files.keySet()) {
        final OClosableEntry<Long,OFileClassic> entry=files.acquire(fileId);
        try {
          final OFileClassic fileClassic=entry.get();
          fileClassic.synch();
        }
  finally {
          files.release(entry);
        }
      }
      writeAheadLog.logFuzzyCheckPointEnd();
      writeAheadLog.flush();
      if (minLsn.compareTo(new OLogSequenceNumber(-1,-1)) > 0)       writeAheadLog.cutTill(minLsn);
    }
 catch (    IOException ioe) {
      OLogManager.instance().error(this,"Error during fuzzy checkpoint",ioe);
    }
    OLogManager.instance().debug(this,"End fuzzy checkpoint");
  }
  finally {
    if (statistic != null)     statistic.stopFuzzyCheckpointTimer();
  }
}
