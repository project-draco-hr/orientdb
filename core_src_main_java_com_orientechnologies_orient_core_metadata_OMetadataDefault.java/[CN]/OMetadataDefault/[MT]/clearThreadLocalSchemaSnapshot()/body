{
  ThreadLocalSchemaSnapshot schemaSnapshot=threadLocalSchemaSnapshot.get();
  if (schemaSnapshot.snapshotCounter <= 0)   throw new IllegalStateException("Thread local schema snapshot is cleared more times than it is done");
  schemaSnapshot.snapshotCounter--;
  if (schemaSnapshot.snapshotCounter == 0)   threadLocalSchemaSnapshot.set(null);
}
