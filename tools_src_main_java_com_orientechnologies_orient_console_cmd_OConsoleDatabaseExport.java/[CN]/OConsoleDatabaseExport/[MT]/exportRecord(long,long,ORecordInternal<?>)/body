{
  if (rec == null)   return;
  try {
    if (rec.getIdentity().isValid())     rec.load();
    if (recordExported > 0)     writer.append(",");
    writer.append(rec.toJSON("rid,type,version,class,attribSameRow,indent:4"));
  }
 catch (  Throwable t) {
    byte[] buffer=rec.toStream();
    throw new ODatabaseExportException("Error on exporting record #" + rec.getIdentity() + ". It seems corrupted; size: "+ buffer.length+ " bytes, raw content (as string): "+ new String(buffer),t);
  }
  recordExported++;
  recordNum++;
  if (recordTot > 10 && (recordNum + 1) % (recordTot / 10) == 0)   listener.onMessage(".");
}
