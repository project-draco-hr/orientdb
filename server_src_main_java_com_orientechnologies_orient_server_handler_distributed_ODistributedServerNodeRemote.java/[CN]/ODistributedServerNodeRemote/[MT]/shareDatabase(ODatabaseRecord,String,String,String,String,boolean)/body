{
  if (status != STATUS.CONNECTED)   throw new ODistributedSynchronizationException("Can't share database '" + iDatabase.getName() + "' on remote server node '"+ iRemoteServerName+ "' because is disconnected");
  final String dbName=iDatabase.getName();
  channel.acquireExclusiveLock();
  try {
    status=STATUS.SYNCHRONIZING;
    OLogManager.instance().info(this,"Sharing database '" + dbName + "' to remote server "+ iRemoteServerName+ "...");
    channel.writeByte(OChannelDistributedProtocol.REQUEST_DISTRIBUTED_DB_SHARE_RECEIVER);
    channel.writeInt(clientTxId);
    channel.writeString(dbName);
    channel.writeString(iDbUser);
    channel.writeString(iDbPasswd);
    channel.writeString(iEngineName);
    OLogManager.instance().info(this,"Exporting database '%s' via streaming to remote server node: %s...",iDatabase.getName(),iRemoteServerName);
    new ODatabaseExport(iDatabase,new OChannelBinaryOutputStream(channel),this).exportDatabase();
    OLogManager.instance().info(this,"Database exported correctly");
    final OServerNodeDatabaseEntry databaseEntry=new OServerNodeDatabaseEntry();
    databaseEntry.databaseName=dbName;
    databaseEntry.userName=iDbUser;
    databaseEntry.userPassword=iDbPasswd;
    try {
      channel.beginResponse(clientTxId);
      databaseEntry.sessionId=channel.readInt();
      databaseEntry.version=channel.readLong();
      databases.put(dbName,databaseEntry);
    }
  finally {
      channel.endResponse();
    }
  }
  finally {
    channel.releaseExclusiveLock();
  }
  status=STATUS.CONNECTED;
}
