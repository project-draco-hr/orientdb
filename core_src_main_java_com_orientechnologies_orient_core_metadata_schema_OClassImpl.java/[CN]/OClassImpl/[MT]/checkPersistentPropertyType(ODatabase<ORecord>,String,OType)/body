{
  StringBuilder builder=new StringBuilder(256);
  builder.append("select count(*) from ").append(name).append(" where ");
  builder.append(propertyName).append(".type() not in [");
  Iterator<OType> cur=type.getCastable().iterator();
  while (cur.hasNext()) {
    builder.append('"').append(cur.next().name()).append('"');
    if (cur.hasNext())     builder.append(",");
  }
  builder.append("] and ").append(propertyName).append(" is not null ");
  if (type.isMultiValue())   builder.append(" and ").append(propertyName).append(".size() <> 0 ");
  List<ODocument> res=database.command(new OCommandSQL(builder.toString())).execute();
  if (((Long)res.get(0).field("count")) > 0)   throw new OSchemaException("The database contains some schemaless data in the property " + name + "."+ propertyName+ " that is not compatible with the type "+ type);
}
