{
  if (rec == null)   return;
  try {
    if (rec.getIdentity().isValid())     rec.load();
    if (recordExported > 0)     writer.append(",");
    writer.append(rec.toJSON("rid,type,version,class,attribSameRow,indent:4,keepTypes"));
  }
 catch (  Throwable t) {
    byte[] buffer=rec.toStream();
    OLogManager.instance().error(this,"Error on exporting record #%s. It seems corrupted; size: %d bytes, raw content (as string): %s",t,rec.getIdentity(),buffer.length,new String(buffer));
  }
  recordExported++;
  recordNum++;
  if (recordTot > 10 && (recordNum + 1) % (recordTot / 10) == 0)   listener.onMessage(".");
}
