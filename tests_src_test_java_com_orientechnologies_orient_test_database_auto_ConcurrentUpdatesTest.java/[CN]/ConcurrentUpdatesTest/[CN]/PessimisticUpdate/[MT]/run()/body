{
  try {
    for (int i=0; i < PESSIMISTIC_CYCLES; i++) {
      String cmd="update " + rid + " increment total = 1";
      if (lock)       cmd+=" lock record";
      for (int retry=0; retry < MAX_RETRIES; ++retry) {
        try {
          db.command(new OCommandSQL(cmd)).execute();
          counter.incrementAndGet();
          break;
        }
 catch (        OResponseProcessingException e) {
          if (e.getCause() instanceof ONeedRetryException) {
            Assert.assertTrue(e.getCause() instanceof ONeedRetryException);
            System.out.println("SQL UPDATE - Retry " + Thread.currentThread().getName() + " "+ i+ " - "+ retry+ "/"+ MAX_RETRIES+ "...");
          }
 else {
            e.printStackTrace();
            Assert.assertTrue(false);
          }
        }
catch (        ONeedRetryException e) {
          System.out.println("SQL UPDATE - Retry " + Thread.currentThread().getName() + " "+ i+ " - "+ retry+ "/"+ MAX_RETRIES+ "...");
        }
      }
    }
  }
 catch (  Throwable e) {
    e.printStackTrace();
    Assert.assertTrue(false);
  }
}
