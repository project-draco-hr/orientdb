{
  setDataCommandInfo("Update record");
  checkDatabase();
  final ORecordId rid=channel.readRID();
  final byte[] buffer=channel.readBytes();
  final ORecordVersion version=channel.readVersion();
  final byte recordType=channel.readByte();
  final byte mode=channel.readByte();
  final ORecordVersion newVersion=updateRecord(connection.database,rid,buffer,version,recordType);
  if (mode < 2) {
    beginResponse();
    try {
      sendOk(clientTxId);
      channel.writeVersion(newVersion);
    }
  finally {
      endResponse();
    }
  }
}
