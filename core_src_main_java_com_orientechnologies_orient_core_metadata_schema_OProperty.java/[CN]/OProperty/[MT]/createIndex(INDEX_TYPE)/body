{
  if (index != null)   throw new IllegalStateException("Index already created");
  OPropertyIndex tempIndex=null;
  try {
switch (iType) {
case UNIQUE:
      tempIndex=new OPropertyIndexUnique(document.getDatabase(),this,OStorage.CLUSTER_INDEX_NAME);
    break;
case NOTUNIQUE:
  tempIndex=new OPropertyIndexNotUnique(document.getDatabase(),this,OStorage.CLUSTER_INDEX_NAME);
break;
case FULLTEXT:
tempIndex=new OFullTextIndex(document.getDatabase(),this,OStorage.CLUSTER_INDEX_NAME);
break;
}
tempIndex.rebuild();
setDirty();
if (document.getDatabase() != null) {
tempIndex.lazySave();
document.getDatabase().getMetadata().getSchema().save();
}
index=tempIndex;
}
 catch (OIndexException e) {
throw e;
}
catch (Exception e) {
OLogManager.instance().exception("Unable to create '%s' index for property: %s",e,ODatabaseException.class,iType,toString());
}
return index;
}
