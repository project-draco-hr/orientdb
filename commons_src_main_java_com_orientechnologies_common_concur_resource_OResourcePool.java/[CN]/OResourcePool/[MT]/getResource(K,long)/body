{
  try {
    if (!sem.tryAcquire(iMaxWaitMillis,TimeUnit.MILLISECONDS))     throw new OLockException("Can't acquire lock on requested resource: " + iKey);
  }
 catch (  InterruptedException e) {
    throw new OLockException("Can't acquire lock on requested resource: " + iKey,e);
  }
  V res=resources.poll();
  if (res != null) {
    listener.reuseResource(iKey,res);
    return res;
  }
  try {
    res=listener.createNewResource(iKey);
    return res;
  }
 catch (  Exception e) {
    sem.release();
    throw new OLockException("Error on creation of the new resource in the pool",e);
  }
}
