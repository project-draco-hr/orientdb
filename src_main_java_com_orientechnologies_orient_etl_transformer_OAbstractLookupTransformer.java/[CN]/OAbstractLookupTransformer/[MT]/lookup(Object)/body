{
  Object result=null;
  if (joinValue != null) {
    if (sqlQuery == null && index == null) {
      if (lookup.toUpperCase().startsWith("SELECT"))       sqlQuery=new OSQLSynchQuery<ODocument>(lookup);
 else {
        index=db.getMetadata().getIndexManager().getIndex(lookup);
        if (index == null) {
          debug("WARNING: index %s not found. Lookups could be really slow",lookup);
          final String[] parts=lookup.split("\\.");
          sqlQuery=new OSQLSynchQuery<ODocument>("SELECT FROM " + parts[0] + " WHERE "+ parts[1]+ " = ?");
        }
      }
    }
    if (index != null) {
      final OType idxFieldType=index.getDefinition().getTypes()[0];
      joinValue=idxFieldType.convert(joinValue,idxFieldType.getDefaultJavaType());
      result=index.get(joinValue);
    }
 else     result=db.query(sqlQuery,joinValue);
    if (result != null)     if (result instanceof Collection) {
      if (!((Collection)result).isEmpty())       result=((Collection<OIdentifiable>)result).iterator().next().getRecord();
 else       result=null;
    }
 else     if (result instanceof OIdentifiable)     result=((OIdentifiable)result).getRecord();
  }
  return result;
}
