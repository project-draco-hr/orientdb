{
  if (iMaxFetch > -1 && iListener.size() >= iMaxFetch)   return;
  Object fieldValue;
  Integer depthLevel;
  final Integer anyFieldDepthLevel=iFetchPlan != null ? iFetchPlan.get(ANY_FIELD) : Integer.valueOf(-1);
  try {
    for (    String fieldName : iRootRecord.fieldNames()) {
      fieldValue=iRootRecord.field(fieldName);
      if (fieldValue == null || !(fieldValue instanceof ODocument) && (!(fieldValue instanceof Collection<?>) || (((Collection<?>)fieldValue).size() > 0 && !(((Collection<?>)fieldValue).iterator().next() instanceof ODocument))) && (!(fieldValue instanceof Map<?,?>) || (((Map<?,?>)fieldValue).size() > 0 && !(((Map<?,?>)fieldValue).values().iterator().next() instanceof ODocument))))       continue;
      depthLevel=getDepthLevel(iRootRecord,iFetchPlan,fieldName);
      if (depthLevel == null)       depthLevel=anyFieldDepthLevel;
      if (depthLevel == 0)       continue;
      if (depthLevel > -1 && iCurrentLevel >= depthLevel)       continue;
      Object userObject;
      if (fieldValue instanceof ODocument) {
        final ODocument linked=(ODocument)fieldValue;
        try {
          userObject=iListener.fetchLinked(iRootRecord,iUserObject,fieldName,linked);
          if (userObject != null)           fetch(linked,userObject,iFetchPlan,fieldName,iCurrentLevel + 1,iMaxFetch,iListener);
        }
 catch (        ORecordNotFoundException e) {
          OLogManager.instance().error(null,"Linked record %s was not found",linked);
        }
      }
 else       if (fieldValue instanceof Collection<?>) {
        final Collection<ODocument> linked=(Collection<ODocument>)fieldValue;
        userObject=iListener.fetchLinked(iRootRecord,iUserObject,fieldName,linked);
        if (userObject != null)         for (        ODocument d : (Collection<ODocument>)userObject) {
          if (d != null)           fetch(d,d,iFetchPlan,fieldName,iCurrentLevel + 1,iMaxFetch,iListener);
        }
      }
 else       if (fieldValue instanceof Map<?,?>) {
        final Map<String,ODocument> linked=(Map<String,ODocument>)fieldValue;
        userObject=iListener.fetchLinked(iRootRecord,iUserObject,fieldName,linked);
        if (userObject != null)         for (        ODocument d : ((Map<String,ODocument>)userObject).values()) {
          if (d != null)           fetch(d,d,iFetchPlan,fieldName,iCurrentLevel + 1,iMaxFetch,iListener);
        }
      }
      if (iMaxFetch > -1 && iListener.size() >= iMaxFetch)       return;
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    OLogManager.instance().error(null,"Fetching error on record %s",e,iRootRecord.getIdentity());
  }
}
