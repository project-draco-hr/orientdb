{
  Object fieldValue;
  List<ORecordId> refs;
  final StringBuilder buffer=new StringBuilder();
  char c;
  boolean ignore;
  for (  String fieldName : iDocument.fieldNames()) {
    fieldValue=iDocument.field(fieldName);
    if (fieldValue != null) {
      final List<String> words=OStringSerializerHelper.split(fieldValue.toString(),' ');
      for (      String word : words) {
        buffer.setLength(0);
        for (int i=0; i < word.length(); ++i) {
          c=word.charAt(i);
          ignore=false;
          for (int k=0; k < ignoreChars.length(); ++k)           if (c == ignoreChars.charAt(k)) {
            ignore=true;
            break;
          }
          if (!ignore)           buffer.append(c);
        }
        word=buffer.toString();
        if (stopWords.contains(word))         continue;
        refs=map.get(word);
        if (refs == null)         refs=new ArrayList<ORecordId>();
        refs.add((ORecordId)iDocument.getIdentity());
        map.put(word,refs);
      }
    }
  }
  try {
    map.save();
  }
 catch (  IOException e) {
    throw new OIndexException("Can't save tree map for Full Text index '" + config.field(FIELD_NAME) + "'");
  }
}
