{
  addUser();
  lock.acquireExclusiveLock();
  try {
    connectionUserName=iUserName;
    connectionUserPassword=iUserPassword;
    connectionOptions=iOptions != null ? new HashMap<String,Object>(iOptions) : null;
    openRemoteDatabase();
    final OStorageConfiguration storageConfiguration=new OStorageRemoteConfiguration(this,ODatabaseDocumentTx.getDefaultSerializer().toString());
    storageConfiguration.load();
    configuration=storageConfiguration;
    componentsFactory=new OCurrentStorageComponentsFactory(configuration);
  }
 catch (  Exception e) {
    if (!OGlobalConfiguration.STORAGE_KEEP_OPEN.getValueAsBoolean())     close();
    if (e instanceof RuntimeException)     throw (RuntimeException)e;
 else     throw new OStorageException("Cannot open the remote storage: " + name,e);
  }
 finally {
    lock.releaseExclusiveLock();
  }
}
