{
  try {
    if (!segment.getFile().isOpen())     return;
    final byte[] buffer=toStream();
    final int requiredSpace=buffer.length + OBinaryProtocol.SIZE_INT;
    if (segment.getFile().getFileSize() < requiredSpace)     segment.getFile().setSize(requiredSpace);
    segment.getFile().allocateSpace(buffer.length + OBinaryProtocol.SIZE_INT);
    segment.getFile().writeInt(0,buffer.length);
    segment.getFile().write(OBinaryProtocol.SIZE_INT,buffer);
  }
 catch (  Exception e) {
    throw new OSerializationException("Error on update storage configuration",e);
  }
}
