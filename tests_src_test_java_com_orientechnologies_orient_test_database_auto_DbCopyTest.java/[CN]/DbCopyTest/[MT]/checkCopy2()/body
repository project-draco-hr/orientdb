{
  final String className="DbCopyTest2";
  database.getMetadata().getSchema().createClass(className);
  final ODatabaseDocumentTx otherDB=database.copy();
  try {
    Thread thread=new Thread(){
      @Override public void run(){
        otherDB.activateOnCurrentThread();
        for (int i=0; i < 20; i++) {
          ODocument doc=otherDB.newInstance(className);
          doc.field("num",i);
          doc.save();
          try {
            Thread.sleep(10);
          }
 catch (          InterruptedException e) {
            e.printStackTrace();
          }
        }
      }
    }
;
    thread.start();
    for (int i=0; i < 5; i++) {
      ODocument doc=database.newInstance(className);
      doc.field("num",i);
      doc.save();
      try {
        Thread.sleep(10);
      }
 catch (      InterruptedException e) {
        e.printStackTrace();
      }
    }
    database.close();
    try {
      thread.join();
    }
 catch (    InterruptedException e) {
      Assert.fail();
    }
    otherDB.activateOnCurrentThread();
    List<ODocument> result=otherDB.query(new OSQLSynchQuery<ODocument>("SELECT FROM " + className));
    Assert.assertEquals(result.size(),25);
  }
  finally {
    otherDB.close();
  }
}
