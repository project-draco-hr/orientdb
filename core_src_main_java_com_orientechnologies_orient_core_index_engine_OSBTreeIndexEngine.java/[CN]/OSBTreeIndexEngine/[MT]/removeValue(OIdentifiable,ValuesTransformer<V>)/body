{
  acquireExclusiveLock();
  try {
    final Set<Object> keySetToRemove=new HashSet<Object>();
    if (sbTree.size() == 0)     return 0;
    final Object firstKey=sbTree.firstKey();
    final Object lastKey=sbTree.lastKey();
    sbTree.loadEntriesBetween(firstKey,true,lastKey,true,new OSBTree.RangeResultListener<Object,V>(){
      @Override public boolean addResult(      OTree.BucketEntry<Object,V> entry){
        if (transformer == null) {
          if (entry.getValue().equals(value))           keySetToRemove.add(entry.getKey());
        }
 else {
          Collection<OIdentifiable> identifiables=transformer.transformFromValue(entry.getValue());
          for (          OIdentifiable identifiable : identifiables) {
            if (identifiable.equals(value))             keySetToRemove.add(entry.getKey());
          }
        }
        return true;
      }
    }
);
    for (    Object keyToRemove : keySetToRemove)     sbTree.remove(keyToRemove);
    return keySetToRemove.size();
  }
  finally {
    releaseExclusiveLock();
  }
}
