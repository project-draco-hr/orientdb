{
  iClusterName=iClusterName.toLowerCase();
  lock.acquireExclusiveLock();
  try {
    int clusterId=clusters.size();
    for (int i=0; i < clusters.size(); ++i) {
      if (clusters.get(i) == null) {
        clusterId=i;
        break;
      }
    }
    final OClusterMemory cluster=(OClusterMemory)Orient.instance().getClusterFactory().createCluster(OClusterMemory.TYPE,forceListBased);
    cluster.configure(this,clusterId,iClusterName,iLocation,getDataSegmentIdByName(iDataSegmentName),iParameters);
    if (clusterId == clusters.size())     clusters.add(cluster);
 else     clusters.set(clusterId,cluster);
    clusterMap.put(iClusterName,cluster);
    return clusterId;
  }
  finally {
    lock.releaseExclusiveLock();
  }
}
