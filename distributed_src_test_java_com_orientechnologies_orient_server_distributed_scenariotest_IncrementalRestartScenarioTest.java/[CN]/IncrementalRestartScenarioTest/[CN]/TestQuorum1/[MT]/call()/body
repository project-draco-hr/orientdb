{
  List<ODocument> result=null;
  final ODatabaseDocumentTx dbServer1=new ODatabaseDocumentTx(databaseUrl1).open("admin","admin");
  try {
    banner("Test with quorum = 1");
    OHazelcastPlugin manager=(OHazelcastPlugin)serverInstance.get(0).getServerInstance().getDistributedManager();
    ODistributedConfiguration databaseConfiguration=manager.getDatabaseConfiguration("distributed-inserttxha");
    ODocument cfg=databaseConfiguration.serialize();
    cfg.field("writeQuorum",1);
    cfg.field("version",(Integer)cfg.field("version") + 1);
    manager.updateCachedDatabaseConfiguration("distributed-inserttxha",cfg,true,true);
    assertEquals(1,cfg.field("writeQuorum"));
    System.out.println("Network fault on server2.\n");
    simulateServerFault(serverInstance.get(1),"net-fault");
    assertFalse(serverInstance.get(1).isActive());
    System.out.println("Network fault on server3.\n");
    simulateServerFault(serverInstance.get(2),"net-fault");
    assertFalse(serverInstance.get(2).isActive());
    ODatabaseRecordThreadLocal.INSTANCE.set(dbServer1);
    try {
      new ODocument("Person").fields("name","Jay","surname","Miner").save();
      new ODocument("Person").fields("name","Luke","surname","Skywalker").save();
      new ODocument("Person").fields("name","Yoda","surname","Nothing").save();
    }
 catch (    Exception e) {
      e.printStackTrace();
      assertTrue("Record not inserted even though writeQuorum=1.",false);
    }
    result=dbServer1.query(new OSQLSynchQuery<OIdentifiable>("select count(*) from Person"));
    assertEquals(1,result.size());
    assertEquals(3,((Number)result.get(0).field("count")).intValue());
    try {
      serverInstance.get(1).startServer(getDistributedServerConfiguration(serverInstance.get(1)));
      System.out.println("Server 2 restarted.");
      assertTrue(serverInstance.get(1).isActive());
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
    executeWritesOnServers.remove(2);
    executeMultipleWrites(executeWritesOnServers,"plocal");
    checkWritesAboveCluster(executeWritesOnServers,executeWritesOnServers);
    try {
      serverInstance.get(2).startServer(getDistributedServerConfiguration(serverInstance.get(2)));
      System.out.println("Server 2 restarted.");
      assertTrue(serverInstance.get(2).isActive());
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
    executeWritesOnServers.clear();
    executeWritesOnServers.add(serverInstance.get(2));
    executeMultipleWrites(executeWritesOnServers,"plocal");
    checkWritesAboveCluster(serverInstance,serverInstance);
  }
 catch (  Exception e) {
    e.printStackTrace();
    assertTrue(e.getMessage(),false);
  }
 finally {
    if (dbServer1 != null) {
      ODatabaseRecordThreadLocal.INSTANCE.set(dbServer1);
      dbServer1.close();
      ODatabaseRecordThreadLocal.INSTANCE.set(null);
    }
  }
  return null;
}
