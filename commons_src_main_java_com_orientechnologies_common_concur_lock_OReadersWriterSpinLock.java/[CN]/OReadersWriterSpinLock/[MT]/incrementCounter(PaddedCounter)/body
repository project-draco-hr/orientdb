{
  long attempts=0;
  long cnt=counter.get();
  while (!counter.compareAndSet(cnt,cnt + 1)) {
    attempts++;
    if (attempts > NCPU)     LockSupport.parkNanos(1);
    cnt=counter.get();
  }
}
