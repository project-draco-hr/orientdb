{
  Object geometry=query.get(SHAPE);
  ODocument docGeom=null;
  if (geometry == null) {
    throw new OIndexEngineException("Invalid spatial query. Missing shape field " + query,null);
  }
  if (geometry instanceof ODocument) {
    docGeom=(ODocument)geometry;
  }
 else   if (geometry instanceof Map) {
    String type=(String)((Map)geometry).get(SHAPE_TYPE);
    ODocument doc=new ODocument(type);
    doc.field(COORDINATES,((Map)geometry).get(COORDINATES));
    docGeom=doc;
  }
  return factory.fromDoc(docGeom);
}
