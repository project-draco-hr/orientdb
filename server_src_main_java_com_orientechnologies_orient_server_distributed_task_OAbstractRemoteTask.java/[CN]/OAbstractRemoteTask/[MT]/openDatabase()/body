{
  inheritedDatabase=true;
  final ODatabaseRecord db=ODatabaseRecordThreadLocal.INSTANCE.getIfDefined();
  if (db != null && db.getName().equals(databaseName) && !db.isClosed()) {
    if (db instanceof ODatabaseDocumentTx)     return (ODatabaseDocumentTx)db;
 else     if (db.getDatabaseOwner() instanceof ODatabaseDocumentTx)     return (ODatabaseDocumentTx)db.getDatabaseOwner();
  }
  inheritedDatabase=false;
  final OServerUserConfiguration replicatorUser=serverInstance.getUser(ODistributedAbstractPlugin.REPLICATOR_USER);
  return (ODatabaseDocumentTx)serverInstance.openDatabase("document",databaseName,replicatorUser.name,replicatorUser.password);
}
