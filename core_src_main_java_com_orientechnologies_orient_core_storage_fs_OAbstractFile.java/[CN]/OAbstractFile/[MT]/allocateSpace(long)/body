{
  acquireWriteLock();
  try {
    final long offset=getFilledUpTo();
    final long size=getFileSize();
    if (getFreeSpace() < iSize) {
      if (maxSize > 0 && maxSize - size < iSize)       throw new IllegalArgumentException("Cannot enlarge file since the configured max size (" + OFileUtils.getSizeAsString(maxSize) + ") was reached! "+ toString());
      long newFileSize=size;
      if (newFileSize == 0)       newFileSize=DEFAULT_SIZE;
      long stepSizeInBytes=Math.max(1024,incrementSize > 0 ? incrementSize : -1 * size / 100 * incrementSize);
      while (newFileSize - offset <= iSize) {
        newFileSize+=stepSizeInBytes;
      }
      if (newFileSize > maxSize && maxSize > 0)       newFileSize=maxSize;
      setSize(newFileSize);
    }
    setFilledUpTo(offset + iSize);
    return offset;
  }
  finally {
    releaseWriteLock();
  }
}
