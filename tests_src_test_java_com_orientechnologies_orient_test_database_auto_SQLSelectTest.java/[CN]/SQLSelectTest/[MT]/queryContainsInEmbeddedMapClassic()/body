{
  database.open("admin","admin");
  Map<String,ODocument> customReferences=new HashMap<String,ODocument>();
  customReferences.put("first",new ODocument("name","Luca","surname","Garulli"));
  customReferences.put("second",new ODocument("name","Jay","surname","Miner"));
  ODocument doc=new ODocument(database,"Profile");
  doc.field("customReferences",customReferences,OType.EMBEDDEDMAP);
  doc.save();
  List<ODocument> resultset=database.query(new OSQLSynchQuery<ODocument>("select from Profile where customReferences CONTAINSKEY 'first'"));
  Assert.assertEquals(resultset.size(),1);
  Assert.assertEquals(resultset.get(0).getIdentity(),doc.getIdentity());
  resultset=database.query(new OSQLSynchQuery<ODocument>("select from Profile where customReferences CONTAINSVALUE ( name like 'Ja%')"));
  Assert.assertEquals(resultset.size(),1);
  Assert.assertEquals(resultset.get(0).getIdentity(),doc.getIdentity());
  resultset=database.query(new OSQLSynchQuery<ODocument>("select from Profile where customReferences[second]['name'] like 'Ja%'"));
  Assert.assertEquals(resultset.size(),1);
  Assert.assertEquals(resultset.get(0).getIdentity(),doc.getIdentity());
  resultset=database.query(new OSQLSynchQuery<ODocument>("select customReferences[second]['name'] as value from Profile where customReferences[second]['name'] is not null"));
  Assert.assertEquals(resultset.size(),1);
  doc.delete();
  database.close();
}
