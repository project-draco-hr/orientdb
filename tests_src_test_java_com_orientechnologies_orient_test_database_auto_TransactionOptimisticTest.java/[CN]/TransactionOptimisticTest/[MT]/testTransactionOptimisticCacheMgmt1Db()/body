{
  ODatabaseFlat db=new ODatabaseFlat(url);
  db.open("admin","admin");
  ORecordFlat record=new ORecordFlat(db);
  record.value("This is the first version").save();
  try {
    db.begin();
    record.load();
    int v1=record.getRecordVersion().getCounter();
    record.value("This is the second version").save();
    db.commit();
    record.reload();
    Assert.assertEquals(record.getRecordVersion().getCounter(),v1 + 1);
    Assert.assertTrue(record.value().contains("second"));
  }
  finally {
    db.close();
  }
}
