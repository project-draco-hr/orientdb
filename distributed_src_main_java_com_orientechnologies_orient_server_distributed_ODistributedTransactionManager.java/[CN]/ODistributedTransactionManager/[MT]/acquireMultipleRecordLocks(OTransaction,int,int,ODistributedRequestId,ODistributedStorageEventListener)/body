{
  for (  ORecordOperation op : iTx.getAllRecordEntries()) {
    boolean recordLocked=false;
    for (int retry=1; retry <= maxAutoRetry; ++retry) {
      if (localDistributedDatabase.lockRecord(op.record,localReqId)) {
        recordLocked=true;
        if (eventListener != null) {
          try {
            eventListener.onAfterRecordLock((ORecordId)op.record.getIdentity());
          }
 catch (          Throwable t) {
            ODistributedServerLog.error(this,dManager.getLocalNodeName(),null,ODistributedServerLog.DIRECTION.NONE,"Caught exception during ODistributedStorageEventListener.onAfterRecordLock",t);
          }
        }
        break;
      }
      if (autoRetryDelay > -1)       Thread.sleep(autoRetryDelay);
    }
    if (!recordLocked)     throw new ODistributedRecordLockedException(op.record.getIdentity());
  }
}
