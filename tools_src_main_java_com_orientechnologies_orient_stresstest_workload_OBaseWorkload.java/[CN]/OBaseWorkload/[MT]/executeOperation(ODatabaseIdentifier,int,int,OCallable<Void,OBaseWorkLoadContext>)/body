{
  final OWorkLoadResult result=new OWorkLoadResult();
  if (operationTotal == 0)   return result;
  final int totalPerThread=operationTotal / concurrencyLevel;
  final int totalPerLastThread=totalPerThread + operationTotal % concurrencyLevel;
  final ArrayList<Long> operationTiming=new ArrayList<Long>(operationTotal);
  for (int i=0; i < operationTotal; ++i)   operationTiming.add(null);
  final Thread[] thread=new Thread[concurrencyLevel];
  for (int t=0; t < concurrencyLevel; ++t) {
    final int currentThread=t;
    thread[t]=new Thread(new Runnable(){
      @Override public void run(){
        final OBaseWorkLoadContext context=getContext();
        context.threadId=currentThread;
        context.totalPerThread=context.threadId < concurrencyLevel - 1 ? totalPerThread : totalPerLastThread;
        context.init(dbIdentifier);
        try {
          final int startIdx=totalPerThread * context.threadId;
          for (int i=0; i < context.totalPerThread; ++i) {
            context.currentIdx=startIdx + i;
            final long startOp=System.nanoTime();
            try {
              callback.call(context);
            }
 catch (            Exception e) {
              errors.add(e.toString());
              if (errors.size() > MAX_ERRORS) {
                e.printStackTrace();
                break;
              }
            }
 finally {
              operationTiming.set(context.currentIdx,System.nanoTime() - startOp);
            }
          }
        }
  finally {
          context.close();
        }
      }
    }
);
  }
  final long startTime=System.currentTimeMillis();
  for (int t=0; t < concurrencyLevel; ++t) {
    thread[t].start();
  }
  for (int t=0; t < concurrencyLevel; ++t) {
    try {
      thread[t].join();
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
  }
  result.totalTime=System.currentTimeMillis() - startTime;
  Collections.sort(operationTiming);
  result.avgNs=(int)(result.totalTime * 1000000 / operationTiming.size());
  result.percentileAvg=getPercentile(operationTiming,result.avgNs);
  result.percentile99Ns=operationTiming.get((int)(operationTiming.size() * 99f / 100f));
  result.percentile99_9Ns=operationTiming.get((int)(operationTiming.size() * 99.9f / 100f));
  return result;
}
