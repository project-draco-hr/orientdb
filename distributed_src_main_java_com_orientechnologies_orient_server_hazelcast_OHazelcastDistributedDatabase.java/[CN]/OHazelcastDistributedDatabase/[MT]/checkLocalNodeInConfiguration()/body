{
  final Lock lock=manager.getLock(databaseName);
  lock.lock();
  try {
    ODocument dCfg=(ODocument)manager.getConfigurationMap().get(manager.CONFIG_DATABASE_PREFIX + databaseName);
    final ODistributedConfiguration cfg;
    if (dCfg == null)     cfg=manager.getDatabaseConfiguration(databaseName);
 else     cfg=new ODistributedConfiguration(dCfg);
    final List<String> foundPartition=cfg.addNewNodeInServerList(manager.getLocalNodeName());
    if (foundPartition != null) {
      manager.setDatabaseStatus(databaseName,ODistributedServerManager.DB_STATUS.OFFLINE);
      ODistributedServerLog.info(this,manager.getLocalNodeName(),null,DIRECTION.NONE,"adding node '%s' in partition: db=%s %s",manager.getLocalNodeName(),databaseName,foundPartition);
      manager.updateCachedDatabaseConfiguration(databaseName,cfg.serialize(),true,true);
    }
  }
  finally {
    lock.unlock();
  }
}
