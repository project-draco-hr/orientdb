{
  final OClass clz=iDocument.getSchemaClass();
  if (clz != null && clz.isSubClassOf(CLASSNAME)) {
    OFunction func=null;
    final String fieldName=((OClassImpl)clz).getCustom(attr);
    if (fieldName != null && fieldName.length() > 0) {
      func=ODatabaseRecordThreadLocal.INSTANCE.get().getMetadata().getFunctionLibrary().getFunction(fieldName);
      if (func == null) {
        ODocument funcDoc=ODatabaseRecordThreadLocal.INSTANCE.get().load(new ORecordId(fieldName));
        if (funcDoc != null) {
          func=ODatabaseRecordThreadLocal.INSTANCE.get().getMetadata().getFunctionLibrary().getFunction((String)funcDoc.field("name"));
        }
      }
    }
 else {
      final ODocument funcDoc=iDocument.field(attr);
      if (funcDoc != null) {
        func=ODatabaseRecordThreadLocal.INSTANCE.get().getMetadata().getFunctionLibrary().getFunction((String)funcDoc.field("name"));
      }
    }
    return func;
  }
  return null;
}
