{
  checkOpeness();
  final boolean locked=acquireExclusiveLock();
  try {
    OStorageDataConfiguration conf=new OStorageDataConfiguration(configuration,iSegmentName);
    configuration.dataSegments.add(conf);
    final int pos=registerDataSegment(conf);
    if (pos == -1)     throw new OConfigurationException("Can't add segment " + conf.name + " because it's already part of current storage");
    dataSegments[pos].create(-1);
    configuration.update();
    return pos;
  }
 catch (  Throwable e) {
    OLogManager.instance().error(this,"Error on creation of new data segment '" + iSegmentName + "' in: "+ iSegmentFileName,e,OStorageException.class);
    return -1;
  }
 finally {
    releaseExclusiveLock(locked);
  }
}
