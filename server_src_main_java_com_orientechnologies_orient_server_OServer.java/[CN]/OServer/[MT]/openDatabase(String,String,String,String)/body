{
  final String path=getStoragePath(iDbUrl);
  final ODatabaseInternal<?> database=Orient.instance().getDatabaseFactory().createDatabase(iDbType,path);
  final OStorage storage=database.getStorage();
  if (database.isClosed()) {
    if (database.getStorage() instanceof ODirectMemoryStorage) {
      if (!storage.exists())       try {
        database.create();
      }
 catch (      OStorageException e) {
      }
      if (database.isClosed())       database.open(user,password);
    }
 else {
      try {
        database.open(user,password);
      }
 catch (      OSecurityException e) {
        try {
          serverLogin(user,password,"database.passthrough");
        }
 catch (        OSecurityException ex) {
          throw e;
        }
        database.resetInitialization();
        database.setProperty(ODatabase.OPTIONS.SECURITY.toString(),Boolean.FALSE);
        database.open(user,password);
      }
    }
  }
  return database;
}
