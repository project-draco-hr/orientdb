{
  if (!enabled || iNewLockType == iCurrentLockType)   return;
  final CountableLock lock;
  final Object internalLock=internalLock(iResourceId);
synchronized (internalLock) {
    lock=map.get(iResourceId);
    if (lock == null)     throw new OLockException("Error on releasing a non acquired lock by the requester '" + iRequester + "' against the resource: '"+ iResourceId+ "'");
    if (iCurrentLockType == LOCK.SHARED)     lock.readLock().unlock();
 else     lock.writeLock().unlock();
    if (iNewLockType == LOCK.SHARED)     lock.readLock().lock();
 else     lock.writeLock().lock();
  }
}
