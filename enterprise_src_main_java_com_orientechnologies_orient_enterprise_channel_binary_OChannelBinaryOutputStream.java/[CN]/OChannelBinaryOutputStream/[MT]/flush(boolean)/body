{
  channel.getLockWrite().lock();
  try {
    channel.out.writeInt(pos);
    if (pos > 0) {
      channel.out.write(buffer,0,pos);
      pos=0;
    }
    channel.out.writeByte(iContinue ? 1 : 0);
    channel.out.flush();
  }
  finally {
    channel.getLockWrite().unlock();
  }
}
