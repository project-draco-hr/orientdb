{
  iDocument=checkForLoading(iDocument);
  final OClass cls=iDocument.getSchemaClass();
  if (cls == null)   return;
  final Collection<OIndex<?>> indexes=(Collection<OIndex<?>>)getDatabase().getMetadata().getIndexManager().getIndexes();
  if (!indexes.isEmpty()) {
    final Set<String> dirtyFields=new HashSet<String>(Arrays.asList(iDocument.getDirtyFields()));
    if (!dirtyFields.isEmpty()) {
      for (      final OIndex<?> index : indexes) {
        if (index.getInternal() instanceof OLuceneIndex && index.getConfiguration().field("metadata") != null) {
          if (index.getDefinition() instanceof OCompositeIndexDefinition)           processCompositeIndexUpdate(index,dirtyFields,iDocument);
 else           processSingleIndexUpdate(index,dirtyFields,iDocument);
          if (iDocument.isTrackingChanges()) {
            iDocument.setTrackingChanges(false);
            iDocument.setTrackingChanges(true);
          }
        }
      }
    }
  }
}
