{
  if (database != null) {
    if (!database.isClosed()) {
      database.activateOnCurrentThread();
      database.close();
    }
    database=null;
  }
  if (protocol != null)   protocol.sendShutdown();
}
