{
  if (cls.isAbstract())   throw new IllegalArgumentException("Cannot create a new instance of abstract class");
  final ODatabaseDocument db=ODatabaseRecordThreadLocal.INSTANCE.get();
  final int[] clusterIds=cls.getClusterIds();
  final List<String> clusterNames=new ArrayList<String>(clusterIds.length);
  for (  int c : clusterIds)   clusterNames.add(db.getClusterNameById(c));
  final ODistributedConfiguration cfg=manager.getDatabaseConfiguration(databaseName);
  String bestCluster=cfg.getLocalCluster(clusterNames,nodeName);
  if (bestCluster == null) {
    OLogManager.instance().warn(this,"Cannot find best cluster for class '%s'. Configured servers for clusters %s are %s",cls.getName(),clusterNames,cfg.getServers(clusterNames));
    throw new ODatabaseException("Cannot find best cluster for class '" + cls.getName() + "' on server '"+ nodeName+ "'. ClusterStrategy="+ getName());
  }
  bestClusterId=db.getClusterIdByName(bestCluster);
}
