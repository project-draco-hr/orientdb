{
  final int operations_write=1000;
  final int operations_read=1;
  final int dbs=10;
  final Semaphore sem=new Semaphore(4,true);
  final AtomicInteger activeDBs=new AtomicInteger(dbs);
  final Set<String> times=Collections.newSetFromMap(new ConcurrentHashMap<String,Boolean>());
  for (int i=0; i < dbs; i++) {
    final String dbUrl=baseUrl + i;
    sem.acquire();
    Thread t=new Thread(new Runnable(){
      public void run(){
        ODatabaseDocumentTx tx=new ODatabaseDocumentTx(dbUrl);
        try {
          ODatabaseHelper.deleteDatabase(tx);
          System.out.println("Thread " + this + " is creating database "+ dbUrl);
          System.out.flush();
          ODatabaseHelper.createDatabase(tx,dbUrl);
        }
 catch (        IOException e) {
          e.printStackTrace();
        }
        try {
          System.out.println("(" + getDbId(tx) + ") "+ "Created");
          System.out.flush();
          if (tx.isClosed()) {
            tx.open("admin","admin");
          }
          long start=System.currentTimeMillis();
          for (int j=0; j < operations_write; j++) {
            ODocument dummy=new ODocument("DummyObject");
            dummy.field("name","name" + j);
            dummy=tx.save(dummy);
            Assert.assertEquals(((ORID)dummy.getIdentity()).getClusterPosition(),j);
            if ((j + 1) % 20000 == 0) {
              System.out.println("(" + getDbId(tx) + ") "+ "Operations (WRITE) executed: "+ (j + 1));
              System.out.flush();
            }
          }
          long end=System.currentTimeMillis();
          String time="(" + getDbId(tx) + ") "+ "Executed operations (WRITE) in: "+ (end - start)+ " ms";
          System.out.println(time);
          System.out.flush();
          times.add(time);
          start=System.currentTimeMillis();
          for (int j=0; j < operations_read; j++) {
            List<DummyObject> l=tx.query(new OSQLSynchQuery<DummyObject>(" select * from DummyObject "));
            Assert.assertEquals(l.size(),operations_write);
            if ((j + 1) % 20000 == 0) {
              System.out.println("(" + getDbId(tx) + ") "+ "Operations (READ) executed: "+ j+ 1);
              System.out.flush();
            }
          }
          end=System.currentTimeMillis();
          time="(" + getDbId(tx) + ") "+ "Executed operations (READ) in: "+ (end - start)+ " ms";
          System.out.println(time);
          System.out.flush();
          times.add(time);
        }
  finally {
          try {
            tx.close();
            System.out.println("Thread " + this + "  is dropping database "+ dbUrl);
            System.out.flush();
            ODatabaseHelper.deleteDatabase(tx);
            sem.release();
            activeDBs.decrementAndGet();
          }
 catch (          Exception e) {
          }
        }
      }
    }
);
    t.start();
  }
  while (activeDBs.get() != 0) {
    Thread.sleep(300);
  }
  System.out.println("Test testDocumentMultipleDBsThreaded ended");
  System.out.flush();
}
