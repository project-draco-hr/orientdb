{
  if (!iClusterSegment.addPhysicalPosition(ppos)) {
    if (sequentialPositionGeneration) {
      do {
        lockManager.releaseLock(Thread.currentThread(),iRid,LOCK.EXCLUSIVE);
        iRid.clusterPosition=positionGenerator++;
        ppos.clusterPosition=iRid.clusterPosition;
        lockManager.acquireLock(Thread.currentThread(),iRid,LOCK.EXCLUSIVE);
        iDataSegment.setRecordRid(ppos.dataSegmentPos,iRid);
      }
 while (!iClusterSegment.addPhysicalPosition(ppos));
    }
 else {
      iDataSegment.deleteRecord(ppos.dataSegmentPos);
      throw new ORecordDuplicatedException("Record with rid=" + iRid.toString() + " already exists in the database",iRid);
    }
  }
}
