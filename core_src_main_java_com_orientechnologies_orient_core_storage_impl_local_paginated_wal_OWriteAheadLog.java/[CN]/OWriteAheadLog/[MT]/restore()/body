{
synchronized (syncObject) {
    for (    LogSegment logSegment : logSegments) {
      logSegment.restore();
    }
    logSize=0;
    for (    LogSegment logSegment : logSegments) {
      logSize+=logSegment.size();
    }
    if (firstMasterRecord != null) {
      LogSegment firstMasterRecordSegment=logSegments.get(firstMasterRecord.getSegment());
      if (firstMasterRecordSegment.size() <= firstMasterRecord.getPosition())       firstMasterRecord=null;
    }
    if (secondMasterRecord != null) {
      LogSegment secondMasterRecordSegment=logSegments.get(secondMasterRecord.getSegment());
      if (secondMasterRecordSegment.size() <= secondMasterRecord.getPosition())       secondMasterRecord=null;
    }
    if (firstMasterRecord == null && secondMasterRecord == null) {
      masterRecordLSNHolder.setLength(0);
      masterRecordLSNHolder.getFD().sync();
      lastCheckpoint=null;
    }
 else {
      if (secondMasterRecord == null)       secondMasterRecord=firstMasterRecord;
 else       firstMasterRecord=secondMasterRecord;
      lastCheckpoint=firstMasterRecord;
      writeMasterRecord(0,firstMasterRecord);
      writeMasterRecord(1,secondMasterRecord);
    }
  }
}
