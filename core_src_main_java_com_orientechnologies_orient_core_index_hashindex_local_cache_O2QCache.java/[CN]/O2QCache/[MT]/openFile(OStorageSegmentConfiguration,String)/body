{
synchronized (syncObject) {
    long fileId=fileCounter++;
    final OMultiFileSegment multiFileSegment=new OMultiFileSegment(storageLocal,fileConfiguration,fileExtension,pageSize);
    if (multiFileSegment.getFile(0).exists())     multiFileSegment.open();
 else     multiFileSegment.create(pageSize);
    files.put(fileId,multiFileSegment);
    filesPages.put(fileId,new HashSet<Long>());
    dirtyPages.put(fileId,new TreeSet<Long>());
    return fileId;
  }
}
