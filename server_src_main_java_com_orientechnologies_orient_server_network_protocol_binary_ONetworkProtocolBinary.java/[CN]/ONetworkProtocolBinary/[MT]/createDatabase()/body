{
  setDataCommandInfo("Create database");
  String dbName=channel.readString();
  String dbType=ODatabaseDocument.TYPE;
  dbType=channel.readString();
  String storageType=channel.readString();
  checkServerAccess("database.create");
  checkStorageExistence(dbName);
  connection.database=getDatabaseInstance(dbName,dbType,storageType);
  createDatabase(connection.database,null,null);
  if (Boolean.TRUE.equals(tokenBased)) {
    this.tokenBytes=tokenHandler.getSignedBinaryToken(connection.database,connection.database.getUser(),connection.data);
    try {
      this.token=tokenHandler.parseBinaryToken(this.tokenBytes);
      getServer().getClientConnectionManager().connect(this,connection,tokenBytes,token);
    }
 catch (    Exception e) {
      throw OException.wrapException(new OSystemException("Cannot connect to the server using provided token"),e);
    }
  }
  beginResponse();
  try {
    sendOk(clientTxId);
  }
  finally {
    endResponse();
  }
}
