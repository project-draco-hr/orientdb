{
  final int dataPtr;
  if (data != null) {
    dataPtr=memory.allocate(serializer.getObjectSize(data));
    if (dataPtr == ODirectMemory.NULL_POINTER)     throw new IllegalStateException("There is no enough memory to allocate for item " + data);
    memory.set(dataPtr,0,data,serializer);
  }
 else   dataPtr=ODirectMemory.NULL_POINTER;
  final int offset=index * 4 + 4;
  final int oldPtr=memory.getInt(ptr,offset);
  if (oldPtr != ODirectMemory.NULL_POINTER)   memory.free(oldPtr);
  memory.setInt(ptr,offset,dataPtr);
}
