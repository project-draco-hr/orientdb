{
  expectedStorageConfiguration.clusters=new ArrayList<OStorageClusterConfiguration>();
  expectedStorageConfiguration.fileTemplate=new OStorageSegmentConfiguration();
  expectedStorageConfiguration.binaryFormatVersion=Integer.MAX_VALUE;
  expectedStorageDir=buildDirectory + "/sbtreeWithWALTestExpected";
  when(expectedStorage.getStoragePath()).thenReturn(expectedStorageDir);
  when(expectedStorage.getName()).thenReturn("sbtreeWithWALTesExpected");
  File buildDir=new File(buildDirectory);
  if (!buildDir.exists())   buildDir.mkdirs();
  File expectedStorageDirFile=new File(expectedStorageDir);
  if (!expectedStorageDirFile.exists())   expectedStorageDirFile.mkdirs();
  OStorageVariableParser variableParser=new OStorageVariableParser(expectedStorageDir);
  when(expectedStorage.getVariableParser()).thenReturn(variableParser);
  when(expectedStorage.getComponentsFactory()).thenReturn(new OCurrentStorageComponentsFactory(expectedStorageConfiguration));
  expectedWriteCache=new OWOWCache(false,OGlobalConfiguration.DISK_CACHE_PAGE_SIZE.getValueAsInteger() * 1024,1000000,writeAheadLog,100,1648L * 1024 * 1024,400L * 1024 * 1024* 1024 + 1648L * 1024 * 1024,expectedStorage,true,20);
  expectedReadCache=new O2QCache(400L * 1024 * 1024* 1024,OGlobalConfiguration.DISK_CACHE_PAGE_SIZE.getValueAsInteger() * 1024,false);
  OAtomicOperationsManager atomicOperationsManager=new OAtomicOperationsManager(expectedStorage);
  when(expectedStorage.getStorageTransaction()).thenReturn(null);
  when(expectedStorage.getReadCache()).thenReturn(expectedReadCache);
  when(expectedStorage.getWALInstance()).thenReturn(null);
  when(expectedStorage.getAtomicOperationsManager()).thenReturn(atomicOperationsManager);
  when(expectedStorage.getConfiguration()).thenReturn(expectedStorageConfiguration);
  when(expectedStorage.getMode()).thenReturn("rw");
  when(expectedStorageConfiguration.getDirectory()).thenReturn(expectedStorageDir);
  expectedSBTree=new OSBTree<Integer,OIdentifiable>(".sbt",true,".nbt",expectedStorage);
  expectedSBTree.create("expectedSBTree",OIntegerSerializer.INSTANCE,OLinkSerializer.INSTANCE,null,1,false);
}
