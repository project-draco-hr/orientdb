{
  OLuceneIndexEngine indexEngine=(OLuceneIndexEngine)storage.getIndexEngine(indexId);
  for (  Map.Entry<Object,Object> snapshotEntry : snapshot.entrySet()) {
    Object key=snapshotEntry.getKey();
    LuceneTxOperations operations=(LuceneTxOperations)snapshotEntry.getValue();
    checkForKeyType(key);
    for (    OIdentifiable oIdentifiable : operations.removed) {
      indexEngine.remove(key,oIdentifiable);
    }
  }
  for (  Map.Entry<Object,Object> snapshotEntry : snapshot.entrySet()) {
    Object key=snapshotEntry.getKey();
    LuceneTxOperations operations=(LuceneTxOperations)snapshotEntry.getValue();
    checkForKeyType(key);
    indexEngine.put(key,operations.added);
  }
}
