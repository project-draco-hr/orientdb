{
  iRequest.content=null;
  int in;
  char currChar;
  int contentLength=-1;
  boolean endOfHeaders=false;
  final StringBuilder request=new StringBuilder();
  while (!channel.socket.isInputShutdown()) {
    in=channel.inStream.read();
    if (in == -1)     break;
    currChar=(char)in;
    if (currChar == '\r') {
      if (request.length() > 0 && contentLength == -1) {
        String line=request.toString();
        String lineUpperCase=line.toUpperCase();
        if (lineUpperCase.startsWith("AUTHORIZATION")) {
          String auth=line.substring("AUTHORIZATION".length() + 2);
          if (!auth.toUpperCase().startsWith("BASIC"))           throw new IllegalArgumentException("Only HTTP Basic authorization is supported");
          iRequest.authorization=auth.substring("BASIC".length() + 1);
          iRequest.authorization=base64.decodeBase64("",iRequest.authorization);
        }
 else         if (lineUpperCase.startsWith("SESSIONID")) {
          iRequest.sessionId=line.substring("SESSIONID".length());
        }
 else         if (lineUpperCase.startsWith(OHttpUtils.CONTENT_LENGTH)) {
          contentLength=Integer.parseInt(lineUpperCase.substring(OHttpUtils.CONTENT_LENGTH.length()));
          if (contentLength > MAX_CONTENT_LENGTH)           OLogManager.instance().warn(this,"->" + channel.socket.getInetAddress().getHostAddress() + ": Error on content size "+ contentLength+ ": the maximum allowed is "+ MAX_CONTENT_LENGTH);
        }
      }
      in=channel.inStream.read();
      if (in == -1)       break;
      currChar=(char)in;
      if (!endOfHeaders && request.length() == 0) {
        if (contentLength <= 0)         return;
        endOfHeaders=true;
      }
      request.setLength(0);
    }
 else     if (endOfHeaders && request.length() == 0 && currChar != '\r' && currChar != '\n') {
      byte[] buffer=new byte[contentLength];
      buffer[0]=(byte)currChar;
      channel.inStream.read(buffer,1,contentLength - 1);
      iRequest.content=new String(buffer);
      return;
    }
 else     request.append(currChar);
  }
  if (OLogManager.instance().isDebugEnabled())   OLogManager.instance().debug(this,"Error on parsing HTTP content from client " + channel.socket.getInetAddress().getHostAddress() + ":\n"+ request);
  return;
}
