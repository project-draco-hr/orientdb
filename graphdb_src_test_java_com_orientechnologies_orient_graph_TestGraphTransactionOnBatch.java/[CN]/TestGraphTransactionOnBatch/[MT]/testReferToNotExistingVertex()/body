{
  ODatabaseDocument db=new ODatabaseDocumentTx("memory:" + TestGraphTransactionOnBatch.class.getSimpleName());
  try {
    db.create();
    db.getMetadata().getSchema().createClass("E");
    OClass V=db.getMetadata().getSchema().createClass("V");
    try {
      db.command(new OCommandScript("sql","begin \n \n LET t2 = create vertex V set Mid = \"2\" \n" + "LET t5 = select from V where Mid = '123456789' \n LET t3 = create edge E from $t5 to $t2 \n" + "\n commit \n return [$t3] ")).execute();
      Assert.fail("it should go in exception because referring to a not existing vertex");
    }
 catch (    Exception ex) {
    }
    List<ODocument> res=db.query(new OSQLSynchQuery("select from E"));
    Assert.assertEquals(res.size(),0);
  }
  finally {
    db.drop();
  }
}
