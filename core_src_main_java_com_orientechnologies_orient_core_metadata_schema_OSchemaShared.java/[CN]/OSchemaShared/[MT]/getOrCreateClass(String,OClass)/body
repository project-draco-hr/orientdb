{
  return getDatabase().getStorage().callInLock(new Callable<OClass>(){
    @Override public OClass call() throws Exception {
      OClass cls=classes.get(iClassName.toLowerCase());
      if (cls == null)       cls=createClass(iClassName,iSuperClass);
 else       if (iSuperClass != null && !cls.isSubClassOf(iSuperClass))       throw new IllegalArgumentException("Class '" + iClassName + "' is not an instance of "+ iSuperClass.getShortName());
      return cls;
    }
  }
,true);
}
