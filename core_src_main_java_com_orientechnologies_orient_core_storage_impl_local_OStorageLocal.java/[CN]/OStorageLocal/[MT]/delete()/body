{
  final long timer=OProfiler.getInstance().startChrono();
  if (!isClosed())   if (removeUser() > 0)   throw new OStorageException("Can't delete a storage open");
  File dbDir=new File(OSystemVariableResolver.resolveSystemVariables(url));
  if (!dbDir.exists() || !dbDir.isDirectory())   dbDir=dbDir.getParentFile();
  final boolean locked=lock.acquireExclusiveLock();
  try {
    for (int i=0; i < 20; ++i) {
      if (dbDir.exists() && dbDir.isDirectory()) {
        int notDeletedFiles=0;
        for (        File f : dbDir.listFiles()) {
          for (          String ext : ALL_FILE_EXTENSIONS)           if (f.getPath().endsWith(ext)) {
            if (!f.delete())             notDeletedFiles++;
            break;
          }
        }
        if (notDeletedFiles == 0) {
          dbDir.delete();
          return;
        }
      }
 else       return;
      try {
        System.gc();
        Thread.sleep(200);
      }
 catch (      InterruptedException e) {
      }
    }
    throw new OStorageException("Can't delete database '" + name + "' located in: "+ dbDir+ ". Database files seems locked");
  }
  finally {
    lock.releaseExclusiveLock(locked);
    OProfiler.getInstance().stopChrono("OStorageLocal.delete",timer);
  }
}
