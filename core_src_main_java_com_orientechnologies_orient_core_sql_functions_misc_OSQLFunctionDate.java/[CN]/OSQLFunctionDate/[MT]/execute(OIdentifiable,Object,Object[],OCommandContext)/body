{
  if (iParameters.length == 0)   return date;
  if (iParameters[0] instanceof Number)   return new Date(((Number)iParameters[0]).longValue());
  if (format == null) {
    if (iParameters.length > 1) {
      format=new SimpleDateFormat((String)iParameters[1]);
      format.setTimeZone(ODateHelper.getDatabaseTimeZone());
    }
 else     format=ODatabaseRecordThreadLocal.INSTANCE.get().getStorage().getConfiguration().getDateTimeFormatInstance();
    if (iParameters.length == 3)     format.setTimeZone(TimeZone.getTimeZone(iParameters[2].toString()));
  }
  try {
    return format.parse((String)iParameters[0]);
  }
 catch (  ParseException e) {
    throw new OQueryParsingException("Error on formatting date '" + iParameters[0] + "' using the format: "+ format,e);
  }
}
