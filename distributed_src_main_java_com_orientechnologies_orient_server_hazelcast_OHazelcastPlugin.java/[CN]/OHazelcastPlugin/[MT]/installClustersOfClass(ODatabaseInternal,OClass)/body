{
  final String databaseName=iDatabase.getName();
  if (!(iClass.getClusterSelection() instanceof OLocalClusterStrategy))   ((OClassImpl)iClass).setClusterSelectionInternal(new OLocalClusterStrategy(this,databaseName,iClass));
  if (iClass.isAbstract())   return false;
  final int[] clusterIds=iClass.getClusterIds();
  final List<String> clusterNames=new ArrayList<String>(clusterIds.length);
  for (  int clusterId : clusterIds)   clusterNames.add(iDatabase.getClusterNameById(clusterId));
  final Lock lock=getLock(databaseName + ".cfg");
  lock.lock();
  try {
    final ODistributedConfiguration cfg=getDatabaseConfiguration(iDatabase.getName());
    final Set<String> availableNodes=getAvailableNodeNames(iDatabase.getName());
    return clusterAssignmentStrategy.assignClusterOwnershipOfClass(iDatabase,cfg,iClass,availableNodes,new HashSet<String>(),true);
  }
  finally {
    lock.unlock();
  }
}
