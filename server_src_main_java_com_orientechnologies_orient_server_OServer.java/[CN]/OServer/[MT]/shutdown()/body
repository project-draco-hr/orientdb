{
  if (!running)   return;
  running=false;
  shutdownHook.cancel();
  OLogManager.instance().info(this,"OrientDB Server is shutdowning...");
  try {
    lock.writeLock().lock();
    for (    OServerNetworkListener l : listeners) {
      OLogManager.instance().info(this,"Shutdowning connection listener '" + l + "'...");
      try {
        l.shutdown();
      }
 catch (      Throwable e) {
      }
    }
    for (    OServerHandler h : handlers) {
      OLogManager.instance().info(this,"Shutdowning handler %s...",h.getName());
      try {
        h.shutdown();
      }
 catch (      Throwable t) {
      }
    }
    try {
      protocols.clear();
      try {
        MBeanServer mBeanServer=ManagementFactory.getPlatformMBeanServer();
        mBeanServer.unregisterMBean(onProfiler);
        mBeanServer.unregisterMBean(onServer);
      }
 catch (      Exception e) {
        OLogManager.instance().error(this,"OrientDB Server v" + OConstants.ORIENT_VERSION + " unregisterMBean error.",e);
      }
    }
 catch (    Throwable t) {
    }
  }
  finally {
    lock.writeLock().unlock();
  }
  try {
    Orient.instance().shutdown();
  }
 catch (  Exception e) {
  }
  OLogManager.instance().info(this,"OrientDB Server shutdown complete");
  System.out.println();
}
