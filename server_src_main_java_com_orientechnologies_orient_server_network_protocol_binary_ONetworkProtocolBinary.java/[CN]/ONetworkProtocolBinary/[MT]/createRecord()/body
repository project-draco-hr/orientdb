{
  setDataCommandInfo("Create record");
  if (!isConnectionAlive())   return;
  final int dataSegmentId=connection.data.protocolVersion >= 10 ? channel.readInt() : 0;
  final ORecordId rid=new ORecordId(channel.readShort(),ORID.CLUSTER_POS_INVALID);
  final byte[] buffer=channel.readBytes();
  final byte recordType=channel.readByte();
  final byte mode=channel.readByte();
  final ORecord<?> record=createRecord(connection.database,rid,buffer,recordType,dataSegmentId);
  if (mode < 2) {
    beginResponse();
    try {
      sendOk(clientTxId);
      channel.writeClusterPosition(record.getIdentity().getClusterPosition());
      if (connection.data.protocolVersion >= 11)       channel.writeVersion(record.getRecordVersion());
      if (connection.data.protocolVersion >= 20)       sendCollectionChanges();
    }
  finally {
      endResponse();
    }
  }
}
