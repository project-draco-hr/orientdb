{
  final OLocalPaginatedStorage expectedStorage=mock(OLocalPaginatedStorage.class);
  OStorageConfiguration storageConfiguration=mock(OStorageConfiguration.class);
  storageConfiguration.clusters=new ArrayList<OStorageClusterConfiguration>();
  storageConfiguration.fileTemplate=new OStorageSegmentConfiguration();
  expectedStorageDir=buildDirectory + "/sbtreeWithWALTestExpected";
  when(expectedStorage.getStoragePath()).thenReturn(expectedStorageDir);
  when(expectedStorage.getName()).thenReturn("sbtreeWithWALTesExpected");
  File buildDir=new File(buildDirectory);
  if (!buildDir.exists())   buildDir.mkdirs();
  File expectedStorageDirFile=new File(expectedStorageDir);
  if (!expectedStorageDirFile.exists())   expectedStorageDirFile.mkdirs();
  expectedDiskCache=new OReadWriteDiskCache(400L * 1024 * 1024* 1024,1648L * 1024 * 1024,OGlobalConfiguration.DISK_CACHE_PAGE_SIZE.getValueAsInteger() * 1024,1000000,100,expectedStorage,null,false,false);
  OStorageVariableParser variableParser=new OStorageVariableParser(expectedStorageDir);
  OAtomicOperationsManager atomicOperationsManager=new OAtomicOperationsManager(null);
  when(expectedStorage.getStorageTransaction()).thenReturn(null);
  when(expectedStorage.getAtomicOperationsManager()).thenReturn(atomicOperationsManager);
  when(expectedStorage.getDiskCache()).thenReturn(expectedDiskCache);
  when(expectedStorage.getWALInstance()).thenReturn(null);
  when(expectedStorage.getVariableParser()).thenReturn(variableParser);
  when(expectedStorage.getConfiguration()).thenReturn(storageConfiguration);
  when(expectedStorage.getMode()).thenReturn("rw");
  when(storageConfiguration.getDirectory()).thenReturn(expectedStorageDir);
  expectedSBTree=new OSBTreeBonsai<Integer,OIdentifiable>(".sbt",true);
  expectedSBTree.create("expectedSBTree",OIntegerSerializer.INSTANCE,OLinkSerializer.INSTANCE,expectedStorage);
}
