{
  if (url == null)   throw new IllegalStateException("Database is closed");
synchronized (this) {
    OrientGraphContext context=threadContext.get();
    if (context != null)     removeContext();
    context=new OrientGraphContext();
    threadContext.set(context);
synchronized (contexts) {
      contexts.add(context);
    }
    if (pool == null) {
      context.rawGraph=new ODatabaseDocumentTx(url);
      if (url.startsWith("remote:") || context.rawGraph.exists()) {
        if (context.rawGraph.isClosed())         context.rawGraph.open(username,password);
      }
 else       context.rawGraph.create();
    }
 else     context.rawGraph=pool.acquire();
    checkForGraphSchema(context.rawGraph);
    return context;
  }
}
