{
  if (destField == null)   throw new OCommandExecutionException("Can't execute the command because it hasn't been parsed yet");
  if (!(database instanceof ODatabaseDocumentTx))   throw new OCommandSQLParsingException("This command supports only the database type ODatabaseDocumentTx");
  final ODatabaseDocumentTx db=(ODatabaseDocumentTx)database;
  OClass sourceClass=database.getMetadata().getSchema().getClass(sourceClassName);
  if (sourceClass == null)   throw new OCommandExecutionException("Source class '" + sourceClassName + "' not found");
  OClass destClass=database.getMetadata().getSchema().getClass(destClassName);
  if (destClass == null)   throw new OCommandExecutionException("Destination class '" + destClassName + "' not found");
  Object value;
  String cmd="select from " + destClassName + " where "+ destField+ " = ";
  List<ODocument> result;
  long total=0;
  for (  ODocument doc : db.browseClass(sourceClass.getName())) {
    value=doc.field(sourceField);
    if (value != null) {
      if (value instanceof ODocument || value instanceof ORID) {
      }
 else       if (value instanceof Collection<?>) {
      }
 else {
        if (value instanceof String) {
          if (((String)value).length() == 0)           value=null;
 else {
            value="'" + value + "'";
            result=database.command(new OSQLSynchQuery<ODocument>(cmd + value)).execute();
            if (result == null || result.size() == 0)             value=null;
 else             if (result.size() > 1)             throw new OCommandExecutionException("Can't create link because multiple records was found in class '" + destClass.getName() + "' with value "+ value+ " in field '"+ destField+ "'");
 else             value=result.get(0);
          }
          doc.field(sourceField,value);
          doc.save();
          total++;
        }
      }
    }
  }
  if (total > 0) {
    OProperty prop=sourceClass.getProperty(sourceField);
    if (prop != null)     sourceClass.removeProperty(sourceField);
    sourceClass.createProperty(sourceField,OType.LINK,destClass);
    database.getMetadata().getSchema().save();
  }
  return total;
}
