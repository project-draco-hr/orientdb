{
  iContent=iContent.trim();
  if (iContent.length() == 0)   return iRecord;
  final ODocument record=(ODocument)iRecord;
  final int posFirstValue=iContent.indexOf(OStringSerializerHelper.ENTRY_SEPARATOR);
  int pos=iContent.indexOf(OStringSerializerHelper.CLASS_SEPARATOR);
  if (pos > -1 && (pos < posFirstValue || posFirstValue == -1)) {
    record.setClassNameIfExists(iContent.substring(0,pos));
    iContent=iContent.substring(pos + 1);
  }
 else   record.setClassNameIfExists(null);
  final List<String> fields=OStringSerializerHelper.smartSplit(iContent,OStringSerializerHelper.RECORD_SEPARATOR);
  String field;
  String fieldName=null;
  String fieldValue;
  OType type=null;
  OClass linkedClass;
  OType linkedType;
  OProperty prop;
  for (int i=0; i < fields.size(); ++i) {
    field=fields.get(i).trim();
    boolean uncertainType=false;
    try {
      pos=field.indexOf(FIELD_VALUE_SEPARATOR);
      if (pos > -1) {
        fieldName=field.substring(0,pos);
        fieldValue=field.length() > pos + 1 ? field.substring(pos + 1) : null;
        prop=record.getSchemaClass() != null ? record.getSchemaClass().getProperty(fieldName) : null;
        if (prop != null) {
          type=prop.getType();
          linkedClass=prop.getLinkedClass();
          linkedType=prop.getLinkedType();
        }
 else {
          type=record.fieldType(fieldName);
          linkedClass=null;
          linkedType=null;
          if (fieldValue != null && type == null) {
            final char firstChar=fieldValue.charAt(0);
            if (fieldValue.length() > 1 && firstChar == '"' && fieldValue.charAt(fieldValue.length() - 1) == '"') {
              type=OType.STRING;
            }
 else             if (firstChar == OStringSerializerHelper.COLLECTION_BEGIN && fieldValue.charAt(fieldValue.length() - 1) == OStringSerializerHelper.COLLECTION_END) {
              type=OType.EMBEDDEDLIST;
              final String value=fieldValue.substring(1,fieldValue.length() - 1);
              if (value.length() > 0) {
                if (firstChar == OStringSerializerHelper.LINK) {
                  type=OType.LINKLIST;
                  linkedType=OType.LINK;
                  int classSeparatorPos=value.indexOf(OStringSerializerHelper.CLASS_SEPARATOR);
                  if (classSeparatorPos > -1) {
                    String className=value.substring(1,classSeparatorPos);
                    if (className != null)                     linkedClass=iDatabase.getMetadata().getSchema().getClass(className);
                  }
                }
 else                 if (firstChar == OStringSerializerHelper.PARENTHESIS_BEGIN) {
                  linkedType=OType.EMBEDDED;
                }
 else                 if (Character.isDigit(firstChar) || firstChar == '+' || firstChar == '-') {
                  String[] items=value.split(",");
                  linkedType=getType(items[0]);
                }
 else                 if (firstChar == '\'' || firstChar == '"')                 linkedType=OType.STRING;
              }
 else               uncertainType=true;
            }
 else             if (firstChar == OStringSerializerHelper.MAP_BEGIN && fieldValue.charAt(fieldValue.length() - 1) == OStringSerializerHelper.MAP_END) {
              type=OType.EMBEDDEDMAP;
            }
 else             if (firstChar == OStringSerializerHelper.LINK)             type=OType.LINK;
 else             if (firstChar == OStringSerializerHelper.PARENTHESIS_BEGIN)             type=OType.EMBEDDED;
 else             if (fieldValue.equals("true") || fieldValue.equals("false"))             type=OType.BOOLEAN;
 else             type=getType(fieldValue);
          }
        }
        if (type == OType.EMBEDDEDLIST || type == OType.EMBEDDEDSET || type == OType.EMBEDDEDMAP || type == OType.EMBEDDED)         record.field(fieldName,fieldFromStream(iRecord,type,linkedClass,linkedType,fieldName,fieldValue),type);
 else         record.field(fieldName,fieldFromStream(iRecord,type,linkedClass,linkedType,fieldName,fieldValue));
        if (uncertainType)         record.setFieldType(fieldName,null);
      }
    }
 catch (    Exception e) {
      OLogManager.instance().exception("Error on unmarshalling field '%s' with value: ",e,OSerializationException.class,fieldName,field);
    }
  }
  return iRecord;
}
