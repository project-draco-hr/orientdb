{
  final ORecordMetadata recordMetadata=getRecordMetadata(rid);
  final boolean result;
  if (recordMetadata == null)   result=processReplicaAdd();
 else   if (recordMetadata.getRecordVersion().compareTo(record.getRecordVersion()) < 0)   result=processReplicaUpdate(recordMetadata);
 else   return false;
  if (!result)   throw new IllegalStateException("Passed in replica was not stored in DB");
  return true;
}
