{
  checkOpeness();
  iSegmentName=iSegmentName.toLowerCase();
  lock.acquireExclusiveLock();
  try {
    final OStorageDataConfiguration conf=new OStorageDataConfiguration(configuration,iSegmentName,-1,iDirectory);
    final int pos=registerDataSegment(conf);
    if (pos == -1)     throw new OConfigurationException("Cannot add segment " + conf.name + " because it is already part of storage '"+ name+ "'");
    dataSegments[pos].create(-1);
    conf.id=pos;
    if (pos == configuration.dataSegments.size())     configuration.dataSegments.add(conf);
 else     configuration.dataSegments.set(pos,conf);
    configuration.update();
    return pos;
  }
 catch (  Throwable e) {
    OLogManager.instance().error(this,"Error on creation of new data segment '" + iSegmentName + "' in: "+ iDirectory,e,OStorageException.class);
    return -1;
  }
 finally {
    lock.releaseExclusiveLock();
  }
}
