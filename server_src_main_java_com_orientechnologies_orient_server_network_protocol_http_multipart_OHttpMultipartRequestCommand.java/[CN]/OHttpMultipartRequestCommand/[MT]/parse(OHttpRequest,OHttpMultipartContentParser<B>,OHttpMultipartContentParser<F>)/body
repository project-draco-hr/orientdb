{
  int in;
  char currChar;
  boolean endRequest=false;
  OHttpMultipartContentInputStream contentIn=new OHttpMultipartContentInputStream(iRequest.multipartStream,iRequest.boundary);
  HashMap<String,String> headers=new LinkedHashMap<String,String>();
  try {
    while (iRequest.multipartStream.available() > 0 && !endRequest) {
      in=iRequest.multipartStream.read();
      currChar=(char)in;
switch (parseStatus) {
case STATUS_EXPECTED_BOUNDARY:
{
          readBoundary(iRequest,currChar);
          parseStatus=STATUS.STATUS_EXPECTED_BOUNDARY_CRLF;
          break;
        }
case STATUS_EXPECTED_BOUNDARY_CRLF:
{
        endRequest=readBoundaryCrLf(iRequest,currChar,endRequest);
        parseStatus=STATUS.STATUS_EXPECTED_PART_HEADERS;
        break;
      }
case STATUS_EXPECTED_PART_HEADERS:
{
      parsePartHeaders(iRequest,currChar,endRequest,headers);
      parseStatus=STATUS.STATUS_EXPECTED_PART_CONTENT;
      break;
    }
case STATUS_EXPECTED_PART_CONTENT:
{
    iRequest.multipartStream.setSkipInput(in);
    contentIn.reset();
    if (headers.get(OHttpUtils.MULTIPART_CONTENT_FILENAME) != null) {
      parseFileContent(iRequest,fileContentParser,headers,contentIn);
    }
 else {
      parseBaseContent(iRequest,standardContentParser,headers,contentIn);
    }
    break;
  }
case STATUS_EXPECTED_END_REQUEST:
{
  iRequest.multipartStream.setSkipInput(in);
  endRequest=OHttpMultipartHelper.isEndRequest(iRequest);
  if (!endRequest) {
    parseStatus=STATUS.STATUS_EXPECTED_BOUNDARY_CRLF;
  }
  break;
}
}
}
}
 catch (Exception e) {
sendTextContent(iRequest,OHttpUtils.STATUS_INTERNALERROR,e.getMessage(),null,OHttpUtils.CONTENT_TEXT_PLAIN,e.getMessage());
}
}
