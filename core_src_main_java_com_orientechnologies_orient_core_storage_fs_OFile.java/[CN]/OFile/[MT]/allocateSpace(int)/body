{
  final int offset=filledUpTo;
  if (getFreeSpace() < iSize) {
    if (maxSize > 0 && maxSize - size < iSize)     throw new IllegalArgumentException("Cannot enlarge file since the configured max size (" + OFileUtils.getSizeAsString(maxSize) + ") was reached! "+ toString());
    int newFileSize=size;
    int stepSizeInBytes=incrementSize > 0 ? incrementSize : -1 * size / 100 * incrementSize;
    while (newFileSize - filledUpTo <= iSize) {
      if (stepSizeInBytes > 0 && (maxSize == 0 || newFileSize + stepSizeInBytes < maxSize))       newFileSize+=stepSizeInBytes;
 else       newFileSize=maxSize;
    }
    changeSize(newFileSize);
  }
  setFilledUpTo(filledUpTo + iSize);
  return offset;
}
