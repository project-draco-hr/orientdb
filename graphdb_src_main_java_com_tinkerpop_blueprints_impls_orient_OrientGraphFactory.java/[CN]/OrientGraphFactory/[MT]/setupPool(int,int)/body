{
  closePool();
  pool=new OResourcePool<String,OrientBaseGraph>(iMax,new OResourcePoolListener<String,OrientBaseGraph>(){
    @Override public OrientBaseGraph createNewResource(    final String iKey,    final Object... iAdditionalArgs){
      final OrientBaseGraph g;
      if (transactional)       g=new OrientGraph(getDatabase(),user,password){
        @Override public void shutdown(){
          if (pool != null)           pool.returnResource(this);
 else           super.shutdown();
        }
      }
.configure(settings);
 else       g=new OrientGraphNoTx(getDatabase(),user,password){
        @Override public void shutdown(){
          if (pool != null) {
            pool.returnResource(this);
            ODatabaseRecordThreadLocal.INSTANCE.remove();
          }
 else           super.shutdown();
        }
      }
.configure(settings);
      initGraph(g);
      return g;
    }
    @Override public boolean reuseResource(    final String iKey,    final Object[] iAdditionalArgs,    final OrientBaseGraph iValue){
      ODatabaseRecordThreadLocal.INSTANCE.set(iValue.getRawGraph());
      return true;
    }
  }
);
  return this;
}
