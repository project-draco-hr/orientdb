{
  final long fileId;
  final OAtomicOperation atomicOperation=storage.getAtomicOperationsManager().getCurrentOperation();
  final OCacheEntry hashStateEntry=loadPage(atomicOperation,fileStateId,hashStateEntryIndex,true,diskCache);
  try {
    OHashIndexFileLevelMetadataPage metadataPage=new OHashIndexFileLevelMetadataPage(hashStateEntry,getChangesTree(atomicOperation,hashStateEntry),false);
    fileId=metadataPage.getFileId(fileLevel);
  }
  finally {
    releasePage(atomicOperation,hashStateEntry,diskCache);
  }
  OCacheEntry entry=loadPage(atomicOperation,fileId,pageIndex,false,diskCache);
  if (entry == null)   entry=addPage(atomicOperation,fileId,diskCache);
  return entry;
}
