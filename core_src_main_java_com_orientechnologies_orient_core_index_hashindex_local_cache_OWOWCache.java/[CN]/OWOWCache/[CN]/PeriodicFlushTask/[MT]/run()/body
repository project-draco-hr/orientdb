{
  try {
    if (writePages.isEmpty())     return;
    int writePagesToFlush=0;
    final long cs=cacheSize.get();
    final double threshold=((double)cs) / cacheMaxSize;
    if (threshold > 0.7)     writePagesToFlush=(int)Math.floor((threshold - 0.7) * cs);
    if (lastCacheSize > 0 && cs - lastCacheSize > writePagesToFlush)     writePagesToFlush=(int)Math.ceil((cs - lastCacheSize) * 1.2);
    lastCacheSize=cs;
    if (writePagesToFlush < 4)     writePagesToFlush=4;
    int flushedPages=0;
    flushedPages=flushRing(writePagesToFlush,flushedPages,false);
    if (flushedPages < writePagesToFlush)     flushRing(writePagesToFlush,flushedPages,true);
  }
 catch (  Exception e) {
    OLogManager.instance().error(this,"Exception during data flush.",e);
  }
}
