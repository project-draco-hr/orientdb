{
  final List<String[]> links=new ArrayList<String[]>();
  for (  OIdentifiable rec : iRecords) {
    if (rec.getRecord() instanceof ODocument) {
      final ODocument doc=rec.getRecord();
      json.resetAttributes();
      json.beginObject();
      json.beginObject(1,false,"an");
      json.beginObject(2,false,rec.getIdentity());
      for (      String field : doc.fieldNames()) {
        final Object v=doc.field(field);
        if (v != null) {
          if (v instanceof OIdentifiable)           links.add(new String[]{rec.getIdentity().toString(),field,((OIdentifiable)v).getIdentity().toString()});
 else           if (v instanceof Collection<?>) {
            for (            Object o : ((Collection<?>)v))             if (o instanceof OIdentifiable)             links.add(new String[]{rec.getIdentity().toString(),field,((OIdentifiable)o).getIdentity().toString()});
          }
 else           json.writeAttribute(3,false,field,v);
        }
      }
      json.endObject(2,false);
      json.endObject(1,false);
      json.endObject(0,false);
      json.newline();
    }
  }
  for (  String[] rec : links) {
    json.resetAttributes();
    json.beginObject();
    json.beginObject(1,false,"ae");
    json.beginObject(2,false,rec[0] + "." + rec[1]+ "."+ rec[2]);
    json.writeAttribute(3,false,"source",rec[0]);
    json.writeAttribute(3,false,"label",rec[1]);
    json.writeAttribute(3,false,"target",rec[2]);
    json.writeAttribute(3,false,"directed",true);
    json.endObject(2,false);
    json.endObject(1,false);
    json.endObject(0,false);
    json.newline();
  }
}
