{
  testStorage=mock(OLocalPaginatedStorage.class);
  OStorageConfiguration storageConfiguration=mock(OStorageConfiguration.class);
  storageConfiguration.clusters=new ArrayList<OStorageClusterConfiguration>();
  storageConfiguration.fileTemplate=new OStorageSegmentConfiguration();
  storageConfiguration.binaryFormatVersion=Integer.MAX_VALUE;
  when(storageConfiguration.getContextConfiguration()).thenReturn(new OContextConfiguration());
  testStorageDir=buildDirectory + "/localPaginatedClusterWithWALTestTwo";
  when(testStorage.getStoragePath()).thenReturn(testStorageDir);
  when(testStorage.getComponentsFactory()).thenReturn(new OCurrentStorageComponentsFactory(storageConfiguration));
  when(testStorage.getName()).thenReturn("localPaginatedClusterWithWALTestTwo");
  when(testStorage.getVariableParser()).thenReturn(new OStorageVariableParser(testStorageDir));
  File buildDir=new File(buildDirectory);
  if (!buildDir.exists())   buildDir.mkdirs();
  File storageDirTwoFile=new File(testStorageDir);
  if (!storageDirTwoFile.exists())   storageDirTwoFile.mkdirs();
  testWriteCache=new OWOWCache(false,OGlobalConfiguration.DISK_CACHE_PAGE_SIZE.getValueAsInteger() * 1024,1000000,writeAheadLog,100,1648L * 1024 * 1024,1648L * 1024 * 1024 + 400L * 1024 * 1024* 1024,testStorage,false,1);
  testReadCache=new O2QCache(400L * 1024 * 1024* 1024,OGlobalConfiguration.DISK_CACHE_PAGE_SIZE.getValueAsInteger() * 1024,false);
  OStorageVariableParser variableParser=new OStorageVariableParser(testStorageDir);
  final OAtomicOperationsManager testAtomicOperationsManager=new OAtomicOperationsManager(testStorage);
  when(testStorage.getReadCache()).thenReturn(testReadCache);
  when(testStorage.getWriteCache()).thenReturn(testWriteCache);
  when(testStorage.getWALInstance()).thenReturn(null);
  when(testStorage.getStorageTransaction()).thenReturn(null);
  when(testStorage.getAtomicOperationsManager()).thenReturn(testAtomicOperationsManager);
  when(testStorage.getVariableParser()).thenReturn(variableParser);
  when(testStorage.getConfiguration()).thenReturn(storageConfiguration);
  when(testStorage.getMode()).thenReturn("rw");
  when(storageConfiguration.getDirectory()).thenReturn(testStorageDir);
  testCluster=new OPaginatedCluster("testPaginatedClusterWithWALTest",testStorage);
  testCluster.configure(testStorage,6,"testPaginatedClusterWithWALTest",buildDirectory,-1);
  testCluster.create(-1);
}
