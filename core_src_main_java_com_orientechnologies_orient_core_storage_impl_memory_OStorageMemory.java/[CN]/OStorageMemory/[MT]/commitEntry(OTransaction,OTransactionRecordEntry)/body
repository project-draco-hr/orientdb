{
  final ORecordId rid=(ORecordId)txEntry.getRecord().getIdentity();
  final OCluster cluster=txEntry.clusterName != null ? getClusterByName(txEntry.clusterName) : getClusterById(rid.clusterId);
  rid.clusterId=cluster.getId();
  if (txEntry.getRecord() instanceof OTxListener)   ((OTxListener)txEntry.getRecord()).onEvent(txEntry,OTxListener.EVENT.BEFORE_COMMIT);
switch (txEntry.status) {
case OTransactionRecordEntry.LOADED:
    break;
case OTransactionRecordEntry.CREATED:
  if (rid.isNew()) {
    byte[] stream=txEntry.getRecord().toStream();
    if (rid.isNew()) {
      if (iTx.getDatabase().callbackHooks(ORecordHook.TYPE.BEFORE_CREATE,txEntry.getRecord()))       stream=txEntry.getRecord().toStream();
      createRecord(rid,stream,txEntry.getRecord().getRecordType(),null);
      iTx.getDatabase().callbackHooks(ORecordHook.TYPE.AFTER_CREATE,txEntry.getRecord());
    }
 else {
      txEntry.getRecord().setVersion(updateRecord(rid,stream,txEntry.getRecord().getVersion(),txEntry.getRecord().getRecordType(),null));
    }
  }
break;
case OTransactionRecordEntry.UPDATED:
byte[] stream=txEntry.getRecord().toStream();
if (iTx.getDatabase().callbackHooks(ORecordHook.TYPE.BEFORE_UPDATE,txEntry.getRecord())) stream=txEntry.getRecord().toStream();
txEntry.getRecord().setVersion(updateRecord(rid,stream,txEntry.getRecord().getVersion(),txEntry.getRecord().getRecordType(),null));
iTx.getDatabase().callbackHooks(ORecordHook.TYPE.AFTER_UPDATE,txEntry.getRecord());
break;
case OTransactionRecordEntry.DELETED:
iTx.getDatabase().callbackHooks(ORecordHook.TYPE.BEFORE_DELETE,txEntry.getRecord());
deleteRecord(rid,txEntry.getRecord().getVersion(),null);
iTx.getDatabase().callbackHooks(ORecordHook.TYPE.AFTER_DELETE,txEntry.getRecord());
break;
}
if (txEntry.getRecord() instanceof OTxListener) ((OTxListener)txEntry.getRecord()).onEvent(txEntry,OTxListener.EVENT.AFTER_COMMIT);
}
