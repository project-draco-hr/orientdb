{
  final long timer=OProfiler.getInstance().startChrono();
  try {
    if (embeddedStreaming && size > OGlobalConfiguration.MVRBTREE_SET_BINARY_THRESHOLD.getValueAsInteger())     embeddedStreaming=false;
    if (embeddedStreaming) {
      buffer.append('[');
      for (      ORecordId rid : tree.keySet()) {
        if (buffer.length() > 1)         buffer.append(',');
        rid.toString(buffer);
      }
      buffer.append(']');
    }
 else {
      final ODocument document=(ODocument)record;
      document.clear();
      document.field("protocolVersion",PROTOCOL_VERSION);
      document.field("size",size);
      document.field("defaultPageSize",defaultPageSize);
      if (root != null)       document.field("root",root.getIdentity());
      buffer.append(document.toString());
    }
  }
  finally {
    OProfiler.getInstance().stopChrono("OMVRBTreeRIDProvider.toStream",timer);
  }
}
