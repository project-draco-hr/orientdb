{
  final OClass cls=iDocument.getSchemaClass();
  if (cls != null && cls.isSubClassOf(OSecurityShared.RESTRICTED_CLASSNAME)) {
    final ODatabaseRecord db=ODatabaseRecordThreadLocal.INSTANCE.get();
    if (db.getUser().isRuleDefined(ODatabaseSecurityResources.BYPASS_RESTRICTED))     return true;
    final ODocument doc;
    if (iReadOriginal)     doc=(ODocument)db.load(iDocument.getIdentity());
 else     doc=iDocument;
    return db.getMetadata().getSecurity().isAllowed((Set<OIdentifiable>)doc.field(OSecurityShared.ALLOW_FIELD));
  }
  return true;
}
