{
  record.fromStream(toStream());
  if (record.getIdentity().isValid())   record.setVersion(storage.updateRecord((ORecordId)record.getIdentity(),record.toStream(),-1,record.getRecordType(),null));
 else {
    if (record.getIdentity().getClusterId() == ORID.CLUSTER_ID_INVALID)     ((ORecordId)record.getIdentity()).clusterId=clusterId;
    storage.createRecord((ORecordId)record.getIdentity(),record.toStream(),record.getRecordType(),null);
  }
  record.unsetDirty();
  return this;
}
