{
  waitNodeIsOnline();
  solveSession();
  if (connection != null) {
    if (connection.getDatabase() != null) {
      connection.getDatabase().activateOnCurrentThread();
      connection.getStats().lastDatabase=connection.getDatabase().getName();
      connection.getStats().lastUser=connection.getDatabase().getUser() != null ? connection.getDatabase().getUser().getName() : null;
    }
 else {
      connection.getStats().lastDatabase=null;
      connection.getStats().lastUser=null;
    }
    ++connection.getStats().totalRequests;
    setDataCommandInfo("Listening");
    connection.getData().commandDetail="-";
    connection.getStats().lastCommandReceived=System.currentTimeMillis();
  }
 else {
    ODatabaseRecordThreadLocal.INSTANCE.remove();
    if (requestType != OChannelBinaryProtocol.REQUEST_DB_CLOSE && requestType != OChannelBinaryProtocol.REQUEST_SHUTDOWN) {
      OLogManager.instance().debug(this,"Found unknown session %d, shutdown current connection",clientTxId);
      shutdown();
      throw new OIOException("Found unknown session " + clientTxId);
    }
  }
  OServerPluginHelper.invokeHandlerCallbackOnBeforeClientRequest(server,connection,(byte)requestType);
}
