{
  if (status == STATUS.DISCONNECTED) {
synchronized (bufferedChanges) {
      if (bufferedChanges.size() > manager.serverOutSynchMaxBuffers) {
        manager.removeNode(this);
        bufferedChanges.clear();
      }
 else {
        bufferedChanges.add(iRequest);
        OLogManager.instance().info(this,"Server node '%s' is temporary disconnected, buffering change %d/%d for the record %s",id,bufferedChanges.size(),manager.serverOutSynchMaxBuffers,iRequest.getRecord().getIdentity());
      }
    }
  }
 else {
    final ORecordInternal<?> record=iRequest.getRecord();
    try {
switch (iRequest.status) {
case OTransactionEntry.CREATED:
        channel.acquireExclusiveLock();
      try {
        channel.writeByte(OChannelDistributedProtocol.REQUEST_RECORD_CREATE);
        channel.writeInt(0);
        channel.writeShort((short)record.getIdentity().getClusterId());
        channel.writeBytes(record.toStream());
        channel.writeByte(record.getRecordType());
        channel.flush();
        readStatus();
      }
  finally {
        channel.releaseExclusiveLock();
      }
    break;
case OTransactionEntry.UPDATED:
  channel.acquireExclusiveLock();
try {
  channel.writeByte(OChannelDistributedProtocol.REQUEST_RECORD_UPDATE);
  channel.writeInt(0);
  channel.writeShort((short)record.getIdentity().getClusterId());
  channel.writeLong(record.getIdentity().getClusterPosition());
  channel.writeBytes(record.toStream());
  channel.writeInt(record.getVersion());
  channel.writeByte(record.getRecordType());
  channel.flush();
  readStatus();
  channel.readInt();
}
  finally {
  channel.releaseExclusiveLock();
}
break;
case OTransactionEntry.DELETED:
channel.acquireExclusiveLock();
try {
channel.writeByte(OChannelDistributedProtocol.REQUEST_RECORD_DELETE);
channel.writeInt(0);
channel.writeShort((short)record.getIdentity().getClusterId());
channel.writeLong(record.getIdentity().getClusterPosition());
channel.writeInt(record.getVersion());
channel.flush();
readStatus();
channel.readLong();
}
  finally {
channel.releaseExclusiveLock();
}
break;
}
}
 catch (RuntimeException e) {
throw e;
}
}
}
