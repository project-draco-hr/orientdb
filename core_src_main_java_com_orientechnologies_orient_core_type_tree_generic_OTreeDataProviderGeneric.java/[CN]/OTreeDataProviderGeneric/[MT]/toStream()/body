{
  final long timer=OProfiler.getInstance().startChrono();
  try {
    final OMemoryStream stream=entryRecordBuffer;
    stream.add(CURRENT_PROTOCOL_VERSION);
    stream.addAsFixed(root != null ? root.toStream() : ORecordId.EMPTY_RECORD_ID_STREAM);
    stream.add(size);
    stream.add(defaultPageSize);
    stream.add(keySerializer.getName());
    stream.add(valueSerializer.getName());
    final byte[] result=stream.getByteArray();
    record.fromStream(result);
    return result;
  }
  finally {
    OProfiler.getInstance().stopChrono("OMVRBTreePersistent.toStream",timer);
  }
}
