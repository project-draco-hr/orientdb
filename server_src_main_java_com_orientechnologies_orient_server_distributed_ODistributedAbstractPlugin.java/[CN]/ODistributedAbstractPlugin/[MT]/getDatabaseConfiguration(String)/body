{
synchronized (cachedDatabaseConfiguration) {
    ODocument cfg=cachedDatabaseConfiguration.get(iDatabaseName);
    if (cfg == null) {
      cfg=cachedDatabaseConfiguration.get("*");
      if (cfg == null) {
        cfg=loadDatabaseConfiguration(iDatabaseName,defaultDatabaseConfigFile);
        if (cfg == null)         throw new OConfigurationException("Cannot load default distributed database config file: " + defaultDatabaseConfigFile);
        cachedDatabaseConfiguration.put(iDatabaseName,cfg);
      }
    }
    final ODistributedConfiguration dCfg=new ODistributedConfiguration(cfg);
    if (dCfg.upgrade())     updateCachedDatabaseConfiguration(iDatabaseName,dCfg.serialize(),true);
    return dCfg;
  }
}
