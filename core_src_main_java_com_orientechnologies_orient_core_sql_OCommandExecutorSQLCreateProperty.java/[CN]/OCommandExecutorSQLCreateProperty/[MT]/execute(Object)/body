{
  if (type == null)   throw new OCommandExecutionException("Can't execute the command because it hasn't been parsed yet");
  OClass sourceClass=database.getMetadata().getSchema().getClass(className);
  if (sourceClass == null)   throw new OCommandExecutionException("Source class '" + className + "' not found");
  OProperty prop=sourceClass.getProperty(fieldName);
  if (prop != null)   throw new OCommandExecutionException("Property '" + className + "."+ fieldName+ "' already exists. Remove it before to retry.");
  OClass linkedClass=null;
  OType linkedType=null;
  if (linked != null) {
    linkedClass=database.getMetadata().getSchema().getClass(linked);
    if (linkedClass == null)     linkedType=OType.valueOf(linked.toUpperCase());
  }
  if (linkedClass != null)   prop=sourceClass.createProperty(fieldName,type,linkedClass);
 else   if (linkedType != null)   prop=sourceClass.createProperty(fieldName,type,linkedType);
 else   prop=sourceClass.createProperty(fieldName,type);
  database.getMetadata().getSchema().save();
  return prop.getId();
}
