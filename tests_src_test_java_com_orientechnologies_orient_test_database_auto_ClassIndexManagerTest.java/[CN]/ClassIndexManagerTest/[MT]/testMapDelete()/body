{
  final OSchema schema=database.getMetadata().getSchema();
  final OClass oClass=schema.getClass("classIndexManagerTestClass");
  final OIndex<?> propFiveIndexKey=oClass.getClassIndex("classIndexManagerTestIndexByKey");
  final OIndex<?> propFiveIndexValue=oClass.getClassIndex("classIndexManagerTestIndexByValue");
  Assert.assertEquals(propFiveIndexKey.getSize(),0);
  final ODocument doc=new ODocument("classIndexManagerTestClass");
  final Map<String,String> mapProperty=new HashMap<String,String>();
  mapProperty.put("key1","value1");
  mapProperty.put("key2","value2");
  doc.field("prop5",mapProperty);
  doc.save();
  Assert.assertEquals(propFiveIndexKey.getSize(),2);
  Assert.assertNotNull(propFiveIndexKey.get("key1"));
  Assert.assertNotNull(propFiveIndexKey.get("key2"));
  Map<String,String> trackedMap=doc.field("prop5");
  trackedMap.put("key3","value3");
  trackedMap.put("key4","value4");
  trackedMap.remove("key1");
  trackedMap.put("key1","value5");
  trackedMap.remove("key2");
  trackedMap.put("key6","value6");
  trackedMap.put("key7","value6");
  trackedMap.put("key8","value6");
  trackedMap.put("key4","value7");
  trackedMap.remove("key8");
  doc.save();
  Assert.assertEquals(propFiveIndexKey.getSize(),5);
  Assert.assertNotNull(propFiveIndexKey.get("key1"));
  Assert.assertNotNull(propFiveIndexKey.get("key3"));
  Assert.assertNotNull(propFiveIndexKey.get("key4"));
  Assert.assertNotNull(propFiveIndexKey.get("key6"));
  Assert.assertNotNull(propFiveIndexKey.get("key7"));
  Assert.assertEquals(propFiveIndexValue.getSize(),4);
  Assert.assertNotNull(propFiveIndexValue.get("value5"));
  Assert.assertNotNull(propFiveIndexValue.get("value3"));
  Assert.assertNotNull(propFiveIndexValue.get("value7"));
  Assert.assertNotNull(propFiveIndexValue.get("value6"));
  trackedMap=doc.field("prop5");
  trackedMap.remove("key1");
  trackedMap.remove("key3");
  trackedMap.remove("key4");
  trackedMap.put("key6","value10");
  trackedMap.put("key11","value11");
  doc.delete();
  Assert.assertEquals(propFiveIndexKey.getSize(),0);
  Assert.assertEquals(propFiveIndexValue.getSize(),0);
}
