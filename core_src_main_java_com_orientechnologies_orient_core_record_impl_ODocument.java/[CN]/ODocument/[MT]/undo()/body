{
  if (!_trackingChanges)   throw new OConfigurationException("Cannot undo the document because tracking of changes is disabled");
  Iterator<Entry<String,ODocumentEntry>> vals=_fields.entrySet().iterator();
  while (vals.hasNext()) {
    Entry<String,ODocumentEntry> next=vals.next();
    if (next.getValue().created) {
      vals.remove();
    }
 else     if (next.getValue().changed) {
      next.getValue().value=next.getValue().original;
      next.getValue().changed=false;
      next.getValue().original=null;
      next.getValue().exist=true;
    }
  }
  _size=_fields.size();
  return this;
}
