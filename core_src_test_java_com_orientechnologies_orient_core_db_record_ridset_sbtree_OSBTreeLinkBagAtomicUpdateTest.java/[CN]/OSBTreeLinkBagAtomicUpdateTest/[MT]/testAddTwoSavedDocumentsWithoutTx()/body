{
  ODocument docOne=new ODocument();
  ODocument docTwo=new ODocument();
  ODocument rootDoc=new ODocument();
  OSBTreeRidBag ridBag=new OSBTreeRidBag();
  rootDoc.field("ridBag",ridBag);
  rootDoc.save();
  ODocument staleRooDoc=db.load(rootDoc.getIdentity());
  OSBTreeRidBag staleRidBag=staleRooDoc.field("ridBag");
  staleRidBag.add(docOne);
  staleRidBag.add(docTwo);
  rootDoc.setDirty();
  rootDoc.save();
  try {
    staleRooDoc.save();
    Assert.fail();
  }
 catch (  OConcurrentModificationException e) {
  }
  rootDoc=db.load(rootDoc.getIdentity());
  ridBag=rootDoc.field("ridBag");
  Assert.assertEquals(ridBag.size(),0);
}
