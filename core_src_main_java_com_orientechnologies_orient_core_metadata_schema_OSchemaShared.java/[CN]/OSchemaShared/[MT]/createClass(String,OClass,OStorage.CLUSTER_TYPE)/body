{
  OClass result;
  int[] clusterIds=null;
  int retry=0;
  while (true)   try {
    acquireSchemaWriteLock();
    try {
      if (getDatabase().getTransaction().isActive())       throw new IllegalStateException("Cannot create class " + className + " inside a transaction");
      result=doCreateClass(className,superClass,(int[])null,retry);
    }
  finally {
      releaseSchemaWriteLock();
    }
    break;
  }
 catch (  ClusterIdsAreEmptyException e) {
    clusterIds=createClusters(className);
    retry++;
  }
  return result;
}
