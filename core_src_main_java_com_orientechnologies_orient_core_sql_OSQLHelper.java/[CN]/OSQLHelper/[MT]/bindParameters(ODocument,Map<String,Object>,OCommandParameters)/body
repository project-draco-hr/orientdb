{
  if (iFields == null)   return;
  for (  Entry<String,Object> field : iFields.entrySet()) {
    final String fieldName=field.getKey();
    Object fieldValue=field.getValue();
    if (fieldValue != null) {
      final String fieldValueString=fieldValue.toString();
      if (fieldValueString.startsWith("(") && fieldValueString.endsWith(")")) {
        final OCommandSQL cmd=new OCommandSQL(fieldValueString.substring(1,fieldValueString.length() - 1));
        fieldValue=ODatabaseRecordThreadLocal.INSTANCE.get().command(cmd).execute();
        if (iDocument.getSchemaClass() != null) {
          final OProperty prop=iDocument.getSchemaClass().getProperty(fieldName);
          if (prop != null) {
            if (prop.getType() == OType.LINK) {
              if (OMultiValue.isMultiValue(fieldValue) && OMultiValue.getSize(fieldValue) == 1)               fieldValue=OMultiValue.getFirstValue(fieldValue);
            }
          }
        }
      }
    }
    iDocument.field(fieldName,resolveFieldValue(iDocument,fieldName,fieldValue,iArguments));
  }
}
