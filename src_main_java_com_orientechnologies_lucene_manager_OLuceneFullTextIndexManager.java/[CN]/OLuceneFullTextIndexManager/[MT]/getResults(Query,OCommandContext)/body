{
  Set<OIdentifiable> results=new LinkedHashSet<OIdentifiable>();
  try {
    IndexSearcher searcher=getSearcher();
    Integer limit=null;
    if (context != null) {
      limit=(Integer)context.getVariable("$limit");
    }
    TopDocs docs=searcher.search(query,(limit != null && limit > 0) ? limit : Integer.MAX_VALUE);
    ScoreDoc[] hits=docs.scoreDocs;
    for (    final ScoreDoc score : hits) {
      Document ret=searcher.doc(score.doc);
      String rId=ret.get(RID);
      results.add(new OContextualRecordId(rId).setContext(new HashMap<String,Object>(){
{
          put("score",score.score);
        }
      }
));
    }
  }
 catch (  IOException e) {
    throw new OIndexException("Error reading from Lucene index",e);
  }
  return results;
}
