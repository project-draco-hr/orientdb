{
  ODatabaseDocument database=ODatabaseRecordThreadLocal.INSTANCE.get();
  OrientBaseGraph result=OrientBaseGraph.getActiveGraph();
  if (result != null && (result instanceof OrientGraph) && !result.getRawGraph().isClosed()) {
    OrientGraph g=(OrientGraph)result;
    g.setAutoStartTx(autoStartTx);
    ODatabaseRecordThreadLocal.INSTANCE.set(g.getRawGraph());
    return g;
  }
  ODatabaseRecordThreadLocal.INSTANCE.set((ODatabaseDocumentInternal)database);
  System.out.println("DAtabse closed? " + database.isClosed());
  return new OrientGraph((ODatabaseDocumentTx)database,autoStartTx);
}
