{
  final OStorage storage=database.getStorage();
  if (database.isClosed()) {
    if (database.getStorage() instanceof ODirectMemoryStorage && !storage.exists()) {
      try {
        database.create();
      }
 catch (      OStorageException e) {
      }
    }
 else {
      if (iBypassAccess) {
        openDatabaseBypassingSecurity(database,data);
      }
 else {
        try {
          database.open(user,password);
          if (data != null) {
            data.serverUser=false;
            data.serverUsername=null;
          }
        }
 catch (        OSecurityException e) {
          try {
            serverLogin(user,password,"database.passthrough");
          }
 catch (          OSecurityException ex) {
            throw e;
          }
          openDatabaseBypassingSecurity(database,data);
        }
      }
    }
  }
  return database;
}
