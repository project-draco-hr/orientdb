{
  if (newFileNamesId.containsKey(fileName))   throw new OStorageException("File with name " + fileName + " already exists.");
  final long fileId=diskCache.bookFileId();
  newFileNamesId.put(fileName,fileId);
  FileChanges fileChanges=new FileChanges();
  fileChanges.isNew=true;
  fileChanges.fileName=fileName;
  this.fileChanges.put(fileId,fileChanges);
  deletedFileNames.remove(fileName);
  return fileId;
}
