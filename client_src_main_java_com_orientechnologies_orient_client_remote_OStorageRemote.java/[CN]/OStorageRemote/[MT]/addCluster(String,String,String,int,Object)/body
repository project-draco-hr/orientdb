{
  checkConnection();
  do {
    try {
      OChannelBinaryClient network=null;
      try {
        network=beginRequest(OChannelBinaryProtocol.REQUEST_DATACLUSTER_ADD);
        network.writeString(iClusterType.toString());
        network.writeString(iClusterName);
        if (network.getSrvProtocolVersion() >= 10 || iClusterType.equalsIgnoreCase("PHYSICAL"))         network.writeString(iLocation);
        if (network.getSrvProtocolVersion() >= 10)         network.writeInt(iDataSegmentId);
 else         network.writeInt(-1);
      }
  finally {
        endRequest(network);
      }
      try {
        beginResponse(network);
        final int clusterId=network.readShort();
        clustersIds.put(iClusterName.toLowerCase(),clusterId);
        clustersTypes.put(iClusterName.toLowerCase(),iClusterType.toString());
        return clusterId;
      }
  finally {
        endResponse(network);
      }
    }
 catch (    Exception e) {
      handleException("Error on add new cluster",e);
    }
  }
 while (true);
}
