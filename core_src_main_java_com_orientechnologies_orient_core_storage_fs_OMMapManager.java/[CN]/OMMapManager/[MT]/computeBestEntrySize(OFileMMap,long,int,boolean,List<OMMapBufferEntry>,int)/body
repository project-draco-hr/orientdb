{
  int bufferSize;
  if (p > -1 && p < fileEntries.size()) {
    bufferSize=(int)(fileEntries.get(p).beginOffset - iBeginOffset);
    if (bufferSize > blockSize)     bufferSize=blockSize;
  }
 else {
    bufferSize=iForce ? iSize : iSize <= blockSize ? blockSize : iSize;
    if (iBeginOffset + bufferSize > iFile.getFileSize())     bufferSize=(int)(iFile.getFileSize() - iBeginOffset);
  }
  if (bufferSize <= 0)   throw new IllegalArgumentException("Invalid range requested for file " + iFile + ". Requested "+ iSize+ " bytes from the address "+ iBeginOffset+ " while the total file size is "+ iFile.getFileSize());
  return bufferSize;
}
