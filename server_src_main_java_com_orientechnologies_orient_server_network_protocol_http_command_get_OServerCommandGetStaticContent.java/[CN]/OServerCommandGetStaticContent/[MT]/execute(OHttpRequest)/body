{
  iRequest.data.commandInfo="Get static content";
  iRequest.data.commandDetail=iRequest.url;
  if (cache == null) {
    for (    OStorageEntryConfiguration entry : OServerMain.server().getConfiguration().properties) {
      if (CACHE_PAR.equals(entry.name)) {
        if (Boolean.parseBoolean(entry.value))         cache=new HashMap<String,OStaticContentCachedEntry>();
        break;
      }
    }
  }
  InputStream is=null;
  long contentSize=0;
  String type=null;
  try {
    String url=OHttpUtils.URL_SEPARATOR.equals(iRequest.url) ? url="/www/index.htm" : iRequest.url;
    url=WWW_PATH + url.substring("www".length() + 1,url.length());
    if (cache != null) {
synchronized (cache) {
        final OStaticContentCachedEntry cachedEntry=cache.get(url);
        if (cachedEntry != null) {
          is=new ByteArrayInputStream(cachedEntry.content);
          contentSize=cachedEntry.size;
          type=cachedEntry.type;
        }
      }
    }
    if (is == null) {
      final File inputFile=new File(url);
      if (!inputFile.exists()) {
        sendStatus(iRequest,404,"File not found");
        iRequest.channel.flush();
        return;
      }
      if (url.endsWith(".htm") || url.endsWith(".html"))       type="text/html";
 else       if (url.endsWith(".png"))       type="image/png";
 else       if (url.endsWith(".jpeg"))       type="image/jpeg";
 else       if (url.endsWith(".js"))       type="application/x-javascript";
 else       if (url.endsWith(".css"))       type="text/css";
      is=new BufferedInputStream(new FileInputStream(inputFile));
      contentSize=inputFile.length();
      if (cache != null) {
        byte[] buffer=new byte[(int)contentSize];
        for (int i=0; i < contentSize; ++i)         buffer[i]=(byte)is.read();
        OStaticContentCachedEntry cachedEntry=new OStaticContentCachedEntry();
        cachedEntry.content=buffer;
        cachedEntry.size=contentSize;
        cachedEntry.type=type;
        cache.put(url,cachedEntry);
        is=new ByteArrayInputStream(cachedEntry.content);
      }
    }
    sendBinaryContent(iRequest,OHttpUtils.STATUS_OK_CODE,OHttpUtils.STATUS_OK_DESCRIPTION,type,is,contentSize);
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
 finally {
    if (is != null)     try {
      is.close();
    }
 catch (    IOException e) {
    }
  }
}
