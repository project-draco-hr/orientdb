{
  StringBuilder buffer=new StringBuilder(COLLECTION_BEGIN);
switch (iType) {
case EMBEDDED:
    buffer.append(toString((ORecordVObject)iValue,iObjHandler,iMarshalledRecords));
  break;
case LINK:
{
  linkToStream(buffer,(ORecordSchemaAware<?>)iValue);
  break;
}
case EMBEDDEDLIST:
case EMBEDDEDSET:
{
buffer.append(COLLECTION_BEGIN);
int items=0;
if (iLinkedClass != null) {
  ORecordVObject record;
  for (  Object o : (Collection<?>)iValue) {
    if (items > 0)     buffer.append(RECORD_SEPARATOR);
    if (o != null) {
      if (o instanceof ORecordVObject)       record=(ORecordVObject)o;
 else       record=OObjectSerializerHelper.toStream(o,new ORecordVObject(o.getClass().getSimpleName()),iDatabase instanceof ODatabaseObjectTx ? ((ODatabaseObjectTx)iDatabase).getEntityManager() : OEntityManagerInternal.INSTANCE,iLinkedClass,iObjHandler != null ? iObjHandler : new OUserObject2RecordHandler(){
        public Object getUserObjectByRecord(        ORecord<?> iRecord){
          return iRecord;
        }
        public ORecord<?> getRecordByUserObject(        Object iPojo,        boolean iIsMandatory){
          return new ORecordVObject(iLinkedClass);
        }
      }
);
      buffer.append(toString(record,iObjHandler,iMarshalledRecords));
    }
    items++;
  }
}
 else for (Object o : (Collection<?>)iValue) {
  if (items > 0)   buffer.append(RECORD_SEPARATOR);
  buffer.append(fieldTypeToString(iLinkedType,o));
  items++;
}
buffer.append(COLLECTION_END);
break;
}
case LINKLIST:
case LINKSET:
{
buffer.append(COLLECTION_BEGIN);
int items=0;
if (iLinkedClass != null) {
for (ORecordSchemaAware<?> record : (Collection<ORecordSchemaAware<?>>)iValue) {
  if (items++ > 0)   buffer.append(RECORD_SEPARATOR);
  if (record.getDatabase() == null)   record.setDatabase(iDatabase);
  linkToStream(buffer,record);
}
}
buffer.append(COLLECTION_END);
break;
}
default :
return fieldTypeToString(iType,iValue);
}
return buffer.toString();
}
