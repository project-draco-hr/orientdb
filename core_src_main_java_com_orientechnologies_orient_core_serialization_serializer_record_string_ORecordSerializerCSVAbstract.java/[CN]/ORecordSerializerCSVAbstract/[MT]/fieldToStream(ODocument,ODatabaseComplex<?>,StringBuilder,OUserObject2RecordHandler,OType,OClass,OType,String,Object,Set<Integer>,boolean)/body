{
  if (iValue == null)   return;
  final long timer=OProfiler.getInstance().startChrono();
switch (iType) {
case LINK:
{
      final Object link=linkToStream(iOutput,iRecord,iValue);
      if (link != null)       iRecord.field(iName,link);
      OProfiler.getInstance().stopChrono("serializer.rec.str.link2string",timer);
      break;
    }
case LINKLIST:
{
    iOutput.append(OStringSerializerHelper.COLLECTION_BEGIN);
    if (iValue instanceof ORecordLazyList && ((ORecordLazyList)iValue).getStreamedContent() != null) {
      iOutput.append(((ORecordLazyList)iValue).getStreamedContent());
      OProfiler.getInstance().updateCounter("serializer.rec.str.linkList2string.cached",+1);
    }
 else {
      Object link;
      int items=0;
      List<Object> coll=(List<Object>)iValue;
      if (coll instanceof OLazyObjectList<?>) {
        ((OLazyObjectList<?>)coll).setConvertToRecord(false);
      }
      boolean autoConvert=false;
      if (coll instanceof ORecordLazyMultiValue) {
        autoConvert=((ORecordLazyMultiValue)coll).isAutoConvertToRecord();
        ((ORecordLazyMultiValue)coll).setAutoConvertToRecord(false);
      }
      try {
        for (int i=0; i < coll.size(); ++i) {
          if (items++ > 0)           iOutput.append(OStringSerializerHelper.RECORD_SEPARATOR);
          link=linkToStream(iOutput,iRecord,coll.get(i));
          if (link != null)           coll.set(i,link);
        }
      }
  finally {
        if (coll instanceof OLazyObjectList<?>) {
          ((OLazyObjectList<?>)coll).setConvertToRecord(true);
        }
      }
      if (coll instanceof ORecordLazyMultiValue)       ((ORecordLazyMultiValue)coll).setAutoConvertToRecord(autoConvert);
    }
    iOutput.append(OStringSerializerHelper.COLLECTION_END);
    OProfiler.getInstance().stopChrono("serializer.rec.str.linkList2string",timer);
    break;
  }
case LINKSET:
{
  iOutput.append(OStringSerializerHelper.COLLECTION_BEGIN);
  if (iValue instanceof ORecordLazySet && ((ORecordLazySet)iValue).getStreamedContent() != null) {
    iOutput.append(((ORecordLazySet)iValue).getStreamedContent());
    OProfiler.getInstance().updateCounter("serializer.rec.str.linkSet2string.cached",+1);
  }
 else {
    int items=0;
    ORecordLazySet coll;
    if (!(iValue instanceof ORecordLazySet)) {
      coll=new ORecordLazySet(iRecord);
      coll.addAll((Collection<? extends OIdentifiable>)iValue);
      ((Collection<? extends OIdentifiable>)iValue).clear();
      iRecord.field(iName,coll);
    }
 else     coll=(ORecordLazySet)iValue;
    for (Iterator<OIdentifiable> it=coll.rawIterator(); it.hasNext(); ) {
      if (items++ > 0)       iOutput.append(OStringSerializerHelper.RECORD_SEPARATOR);
      final OIdentifiable item=it.next();
      linkToStream(iOutput,iRecord,item);
    }
    coll.convertRecords2Links();
  }
  iOutput.append(OStringSerializerHelper.COLLECTION_END);
  OProfiler.getInstance().stopChrono("serializer.rec.str.linkSet2string",timer);
  break;
}
case LINKMAP:
{
iOutput.append(OStringSerializerHelper.MAP_BEGIN);
Object link;
int items=0;
Map<String,Object> map=(Map<String,Object>)iValue;
boolean invalidMap=false;
if (map instanceof OLazyObjectMap<?>) {
  ((OLazyObjectMap<?>)map).setConvertToRecord(false);
}
try {
  for (  Map.Entry<String,Object> entry : map.entrySet()) {
    if (items++ > 0)     iOutput.append(OStringSerializerHelper.RECORD_SEPARATOR);
    fieldTypeToString(iOutput,iDatabase,OType.STRING,entry.getKey());
    iOutput.append(OStringSerializerHelper.ENTRY_SEPARATOR);
    link=linkToStream(iOutput,iRecord,entry.getValue());
    if (link != null && !invalidMap)     invalidMap=true;
  }
}
  finally {
  if (map instanceof OLazyObjectMap<?>) {
    ((OLazyObjectMap<?>)map).setConvertToRecord(true);
  }
}
if (invalidMap) {
  final ORecordLazyMap newMap=new ORecordLazyMap(iRecord,ODocument.RECORD_TYPE);
  for (  Map.Entry<String,Object> entry : map.entrySet()) {
    newMap.put(entry.getKey(),(OIdentifiable)entry.getValue());
  }
  map.clear();
  iRecord.field(iName,newMap);
}
iOutput.append(OStringSerializerHelper.MAP_END);
OProfiler.getInstance().stopChrono("serializer.rec.str.linkMap2string",timer);
break;
}
case EMBEDDED:
if (iValue instanceof ODocument) {
iOutput.append(OStringSerializerHelper.PARENTHESIS_BEGIN);
toString((ODocument)iValue,iOutput,null,iObjHandler,iMarshalledRecords);
iOutput.append(OStringSerializerHelper.PARENTHESIS_END);
}
 else if (iValue != null) iOutput.append(iValue.toString());
OProfiler.getInstance().stopChrono("serializer.rec.str.embed2string",timer);
break;
case EMBEDDEDLIST:
embeddedCollectionToStream(iDatabase,iObjHandler,iOutput,iLinkedClass,iLinkedType,iValue,iMarshalledRecords,iSaveOnlyDirty);
OProfiler.getInstance().stopChrono("serializer.rec.str.embedList2string",timer);
break;
case EMBEDDEDSET:
embeddedCollectionToStream(iDatabase,iObjHandler,iOutput,iLinkedClass,iLinkedType,iValue,iMarshalledRecords,iSaveOnlyDirty);
OProfiler.getInstance().stopChrono("serializer.rec.str.embedSet2string",timer);
break;
case EMBEDDEDMAP:
{
embeddedMapToStream(iDatabase,iObjHandler,iOutput,iLinkedClass,iLinkedType,iValue,iMarshalledRecords,iSaveOnlyDirty);
OProfiler.getInstance().stopChrono("serializer.rec.str.embedMap2string",timer);
break;
}
default :
fieldTypeToString(iOutput,iDatabase,iType,iValue);
}
}
