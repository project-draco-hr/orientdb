{
  record.fromStream(toStream());
  if (record.getIdentity().isValid())   record.getRecordVersion().copyFrom(iSt.updateRecord((ORecordId)record.getIdentity(),record.toStream(),OVersionFactory.instance().createUntrackedVersion(),record.getRecordType(),(byte)0,null).getResult());
 else {
    if (record.getIdentity().getClusterId() == ORID.CLUSTER_ID_INVALID)     ((ORecordId)record.getIdentity()).clusterId=clusterId;
    final OPhysicalPosition ppos=iSt.createRecord(0,(ORecordId)record.getIdentity(),record.toStream(),OVersionFactory.instance().createVersion(),record.getRecordType(),(byte)0,null).getResult();
    record.getRecordVersion().copyFrom(ppos.recordVersion);
  }
  record.unsetDirty();
}
