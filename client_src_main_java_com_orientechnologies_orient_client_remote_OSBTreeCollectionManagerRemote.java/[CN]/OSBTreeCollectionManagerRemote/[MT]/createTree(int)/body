{
  if (remoteCreationAllowed) {
    OStorageRemote storage=(OStorageRemote)ODatabaseRecordThreadLocal.INSTANCE.get().getStorage().getUnderlying();
    OChannelBinaryAsynchClient client=null;
    while (true) {
      try {
        client=storage.beginRequest(OChannelBinaryProtocol.REQUEST_CREATE_SBTREE_BONSAI);
        client.writeInt(clusterId);
        storage.endRequest(client);
        OBonsaiCollectionPointer pointer;
        try {
          storage.beginResponse(client);
          pointer=networkSerializer.readCollectionPointer(client);
        }
  finally {
          storage.endResponse(client);
        }
        OBinarySerializer<OIdentifiable> keySerializer=OLinkSerializer.INSTANCE;
        OBinarySerializer<Integer> valueSerializer=OIntegerSerializer.INSTANCE;
        return new OSBTreeBonsaiRemote<OIdentifiable,Integer>(pointer,keySerializer,valueSerializer);
      }
 catch (      Exception e2) {
        storage.handleException(client,"Can't create sb-tree bonsai.",e2);
      }
    }
  }
 else {
    throw new UnsupportedOperationException("Creation of SB-Tree from remote storage is not allowed");
  }
}
