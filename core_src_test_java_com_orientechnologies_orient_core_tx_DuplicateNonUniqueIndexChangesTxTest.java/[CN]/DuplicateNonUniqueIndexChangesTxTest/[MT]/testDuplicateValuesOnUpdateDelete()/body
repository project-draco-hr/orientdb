{
  db.begin();
  final ODocument person1=db.newInstance("Person").field("name","Name1").save();
  final ODocument person2=db.newInstance("Person").field("name","Name2").save();
  final ODocument person3=db.newInstance("Person").field("name","Name3").save();
  final ODocument person4=db.newInstance("Person").field("name","Name4").save();
  db.commit();
  assertRids("Name1",person1);
  assertRids("Name2",person2);
  assertRids("Name3",person3);
  assertRids("Name4",person4);
  db.begin();
  person1.delete();
  person2.field("name","same").save();
  person3.delete();
  person4.field("name","same").save();
  person2.field("name","Name2").save();
  person4.field("name","Name2").save();
  db.commit();
  assertRids("same");
  assertRids("Name1");
  assertRids("Name2",person2,person4);
  assertRids("Name3");
  assertRids("Name4");
  db.begin();
  person2.delete();
  person4.delete();
  db.commit();
  assertRids("Name2");
}
