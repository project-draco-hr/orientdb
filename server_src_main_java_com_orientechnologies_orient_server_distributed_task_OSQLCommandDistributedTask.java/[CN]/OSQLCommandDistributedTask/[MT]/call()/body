{
  ODistributedServerLog.debug(this,getDistributedServerManager().getLocalNodeId(),getNodeSource(),DIRECTION.IN,"DISTRIBUTED db '%s' command: %s",databaseName,text.toString());
  final ODistributedServerManager dManager=getDistributedServerManager();
  if (status != STATUS.ALIGN && !dManager.checkStatus("online") && !getNodeSource().equals(dManager.getLocalNodeId()))   throw new OServerOfflineException(dManager.getLocalNodeId(),dManager.getStatus(),"Cannot execute the operation because the server is offline: current status: " + dManager.getStatus());
  final ODatabaseDocumentTx db=openDatabase();
  ODistributedThreadLocal.INSTANCE.set(getNodeSource());
  try {
    Object result=openDatabase().command(new OCommandSQL(text)).execute();
    if (mode != EXECUTION_MODE.FIRE_AND_FORGET)     return result;
    return null;
  }
  finally {
    ODistributedThreadLocal.INSTANCE.set(null);
    closeDatabase(db);
  }
}
