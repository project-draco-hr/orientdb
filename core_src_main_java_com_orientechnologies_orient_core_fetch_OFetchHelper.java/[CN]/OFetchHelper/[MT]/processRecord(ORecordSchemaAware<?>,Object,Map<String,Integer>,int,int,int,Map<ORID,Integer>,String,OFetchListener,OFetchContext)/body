{
  Object fieldValue;
  iContext.onBeforeFetch(record);
  if (debug) {
    System.out.println("processRecord start");
    System.out.println("iFieldDepthLevel: " + iFieldDepthLevel);
    System.out.println("record: " + record.toString());
    System.out.println("iFetchPlan: " + iFetchPlan);
    System.out.println("iCurrentLevel: " + iCurrentLevel);
    System.out.println("iLevelFromRoot: " + iLevelFromRoot);
    System.out.println("iCurrentLevel: " + iCurrentLevel);
    System.out.println("parsedRecords: " + parsedRecords);
    System.out.println("iFieldPathFromRoot: " + iFieldPathFromRoot);
  }
  for (  String fieldName : record.fieldNames()) {
    String fieldPath=!iFieldPathFromRoot.isEmpty() ? iFieldPathFromRoot + "." + fieldName : fieldName;
    if (debug) {
      System.out.println("     fieldName: " + fieldName);
      System.out.println("     fieldPath: " + fieldPath);
    }
    int depthLevel;
    depthLevel=getDepthLevel(iFetchPlan,fieldPath);
    if (depthLevel == -2)     continue;
    if (iFieldDepthLevel > -1)     depthLevel=iFieldDepthLevel;
    if (debug)     System.out.println("     depthLevel: " + depthLevel);
    fieldValue=record.field(fieldName);
    if (fieldValue == null || !(fieldValue instanceof OIdentifiable) && (!(fieldValue instanceof ORecordLazyMultiValue) || !((ORecordLazyMultiValue)fieldValue).rawIterator().hasNext() || !(((ORecordLazyMultiValue)fieldValue).rawIterator().next() instanceof OIdentifiable)) && (!(OMultiValue.getFirstValue(fieldValue) instanceof OIdentifiable || OMultiValue.getFirstValue(OMultiValue.getFirstValue(fieldValue)) instanceof OIdentifiable || OMultiValue.getFirstValue(OMultiValue.getFirstValue(OMultiValue.getFirstValue(fieldValue))) instanceof OIdentifiable))) {
      iContext.onBeforeStandardField(fieldValue,fieldName,iUserObject);
      iListener.processStandardField(record,fieldValue,fieldName,iContext,iUserObject);
      iContext.onAfterStandardField(fieldValue,fieldName,iUserObject);
    }
 else {
      try {
        boolean fetch=!(fieldValue instanceof ODocument) || depthLevel == -1 || iCurrentLevel <= depthLevel || iFetchPlan.containsKey(fieldPath);
        if (!fetch && (((ODocument)fieldValue).isEmbedded() || !((ODocument)fieldValue).getIdentity().isValid()) && iContext.fetchEmbeddedDocuments())         fetch=true;
        if (fetch)         fetch(record,iUserObject,iFetchPlan,fieldValue,fieldName,iCurrentLevel,iLevelFromRoot + 1,iFieldDepthLevel,parsedRecords,depthLevel,fieldPath,iListener,iContext);
      }
 catch (      Exception e) {
        e.printStackTrace();
        OLogManager.instance().error(null,"Fetching error on record %s",e,record.getIdentity());
      }
    }
  }
  iContext.onAfterFetch(record);
}
