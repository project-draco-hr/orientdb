{
  if (isClosed())   return;
  objects2Records.clear();
  records2Objects.clear();
  rid2Records.clear();
  checkOpeness();
  try {
    rollback();
  }
 catch (  Exception e) {
    OLogManager.instance().error(this,"Error on releasing database '%s' in pool",e,getName());
  }
  try {
    ODatabase current=underlying;
    while (!(current instanceof ODatabaseRaw) && ((ODatabaseComplex<?>)current).getUnderlying() != null)     current=((ODatabaseComplex<?>)current).getUnderlying();
    ((ODatabaseRaw)current).callOnCloseListeners();
  }
 catch (  Exception e) {
    OLogManager.instance().error(this,"Error on releasing database '%s' in pool",e,getName());
  }
  getLevel1Cache().clear();
  if (ownerPool != null) {
    final OObjectDatabasePool localCopy=ownerPool;
    ownerPool=null;
    localCopy.release(this);
  }
}
