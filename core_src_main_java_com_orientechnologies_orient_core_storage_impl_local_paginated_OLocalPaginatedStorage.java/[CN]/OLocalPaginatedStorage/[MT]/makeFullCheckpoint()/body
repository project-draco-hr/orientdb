{
  if (writeAheadLog == null)   return;
  try {
    modificationLock.prohibitModifications();
    lock.acquireSharedLock();
    try {
      writeAheadLog.flush();
      if (configuration != null)       configuration.synch();
      writeAheadLog.logFullCheckpointStart();
      diskCache.flushBuffer();
      writeAheadLog.logFullCheckpointEnd();
      writeAheadLog.flush();
      dirtyFlag.clearDirty();
    }
 catch (    IOException ioe) {
      throw new OStorageException("Error during checkpoint creation for storage " + name,ioe);
    }
 finally {
      lock.releaseSharedLock();
    }
  }
  finally {
    modificationLock.allowModifications();
  }
}
