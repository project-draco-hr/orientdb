{
  final Map<String,ODocument> indexChanges=remoteIndexEntries.field("indexChanges");
  if (indexChanges == null)   return;
  for (  Entry<String,ODocument> indexEntry : indexChanges.entrySet()) {
    OTransactionIndexChanges transactionIndexChanges=indexEntries.get(indexEntry.getKey());
    if (transactionIndexChanges == null) {
      transactionIndexChanges=new OTransactionIndexChanges();
      indexEntries.put(indexEntry.getKey(),transactionIndexChanges);
    }
    final String indexName=indexEntry.getKey();
    final ODocument indexDoc=indexEntry.getValue();
    if (indexDoc == null)     continue;
    final Boolean clearAll=(Boolean)indexDoc.field("clear");
    if (clearAll != null && clearAll)     transactionIndexChanges.setCleared();
    final Collection<ODocument> entries=indexDoc.field("entries");
    if (entries == null)     continue;
    for (    final ODocument entry : entries) {
      final List<ODocument> operations=(List<ODocument>)entry.field("ops");
      if (operations == null)       continue;
      final String serializedKey=OStringSerializerHelper.decode((String)entry.field("k"));
      final Object key;
      if (serializedKey.startsWith("["))       key=new OCompositeKey((List<? extends Comparable<?>>)ORecordSerializerStringAbstract.fieldTypeFromStream(indexDoc,OType.EMBEDDEDLIST,OStringSerializerHelper.decode(serializedKey)));
 else       key=ORecordSerializerStringAbstract.getTypeValue(serializedKey);
      for (      final ODocument op : operations) {
        final int operation=(Integer)op.rawField("o");
        final OTransactionIndexChanges.OPERATION indexOperation=OTransactionIndexChanges.OPERATION.values()[operation];
        final OIdentifiable value=op.field("v",OType.LINK);
        transactionIndexChanges.getChangesPerKey(key).add(value,indexOperation);
        if (value == null)         continue;
        final ORID rid=value.getIdentity();
        List<OTransactionRecordIndexOperation> txIndexOperations=recordIndexOperations.get(rid);
        if (txIndexOperations == null) {
          txIndexOperations=new ArrayList<OTransactionRecordIndexOperation>();
          recordIndexOperations.put(rid,txIndexOperations);
        }
        txIndexOperations.add(new OTransactionRecordIndexOperation(indexName,key,indexOperation));
      }
    }
  }
}
