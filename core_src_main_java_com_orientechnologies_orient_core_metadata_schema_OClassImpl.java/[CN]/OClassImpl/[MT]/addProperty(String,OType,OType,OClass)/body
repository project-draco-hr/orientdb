{
  document.getDatabase().checkSecurity(ODatabaseSecurityResources.SCHEMA,ORole.PERMISSION_UPDATE);
  final String lowerName=iPropertyName.toLowerCase();
  if (properties.containsKey(lowerName))   throw new OSchemaException("Class " + name + " already has the property '"+ iPropertyName+ "'");
  final StringBuilder cmd=new StringBuilder("create property ");
  cmd.append(name);
  cmd.append('.');
  cmd.append(iPropertyName);
  cmd.append(' ');
  cmd.append(iType.name);
  if (iLinkedType != null) {
    cmd.append(' ');
    cmd.append(iLinkedType.name);
  }
 else   if (iLinkedClass != null) {
    cmd.append(' ');
    cmd.append(iLinkedClass.getName());
  }
  document.getDatabase().command(new OCommandSQL(cmd.toString())).execute();
  if (existsProperty(iPropertyName))   return properties.get(lowerName);
 else {
    return addNewProperty(iPropertyName,iType,iLinkedType,iLinkedClass);
  }
}
