{
  ODocument doc=null;
  if (returnsMatches()) {
    doc=getDatabase().newInstance();
    for (    Map.Entry<String,OIdentifiable> entry : matchContext.matched.entrySet()) {
      if (isExplicitAlias(entry.getKey())) {
        doc.field(entry.getKey(),entry.getValue());
      }
    }
  }
 else   if (returnsPaths()) {
    doc=getDatabase().newInstance();
    for (    Map.Entry<String,OIdentifiable> entry : matchContext.matched.entrySet()) {
      doc.field(entry.getKey(),entry.getValue());
    }
  }
 else   if (returnsJson()) {
    doc=jsonToDoc(matchContext,ctx);
  }
 else {
    doc=getDatabase().newInstance();
    int i=0;
    for (    OExpression item : returnItems) {
      OIdentifier returnAliasIdentifier=returnAliases.get(i);
      String returnAlias;
      if (returnAliasIdentifier == null) {
        returnAlias=item.getDefaultAlias();
      }
 else {
        returnAlias=returnAliasIdentifier.getValue();
      }
      ODocument mapDoc=new ODocument();
      mapDoc.fromMap((Map)matchContext.matched);
      doc.field(returnAlias,item.execute(mapDoc,ctx));
      i++;
    }
  }
  if (request.getResultListener() != null && doc != null) {
    if (((OBasicCommandContext)context).addToUniqueResult(doc)) {
      request.getResultListener().result(doc);
      long currentCount=((OBasicCommandContext)ctx).getResultsProcessed().incrementAndGet();
      if (limit != null) {
        long limitValue=limit.num.getValue().longValue();
        if (limitValue > -1 && limitValue <= currentCount) {
          return false;
        }
      }
    }
  }
  return true;
}
