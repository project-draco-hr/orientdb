{
  if (requestType < 80) {
    super.parseCommand();
    return;
  }
switch (requestType) {
case OChannelDistributedProtocol.SERVERNODE_HEARTBEAT:
    data.commandInfo="Keep-alive";
  lastHeartBeat=System.currentTimeMillis();
sendOk(0);
break;
case OChannelDistributedProtocol.SERVERNODE_CONNECT:
{
data.commandInfo="Cluster connection";
manager.receivedLeaderConnection(this);
sendOk(0);
Map<String,Long> storages=new HashMap<String,Long>();
for (OStorage stg : Orient.instance().getStorages()) {
storages.put(stg.getName(),stg.getVersion());
}
channel.writeInt(storages.size());
for (Entry<String,Long> s : storages.entrySet()) {
channel.writeString(s.getKey());
channel.writeLong(s.getValue());
}
break;
}
case OChannelDistributedProtocol.SERVERNODE_DB_CONFIG:
{
data.commandInfo="Update db configuration from server node leader";
ODocument config=(ODocument)new ODocument().fromStream(channel.readBytes());
OLogManager.instance().warn(this,"Changed distributed server configuration:\n%s",config.toJSON("indent:2"));
sendOk(0);
break;
}
default :
data.commandInfo="Command not supported";
OLogManager.instance().error(this,"Request not supported. Code: " + requestType);
channel.clearInput();
sendError(clientTxId,null);
}
}
