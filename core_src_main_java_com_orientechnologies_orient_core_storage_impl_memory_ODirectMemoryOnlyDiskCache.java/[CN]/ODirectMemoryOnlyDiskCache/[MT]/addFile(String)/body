{
  metadataLock.lock();
  try {
    Long fileId=fileNameIdMap.get(fileName);
    if (fileId == null) {
      final long id=counter++;
      files.put(id,new MemoryFile(id,pageSize));
      fileNameIdMap.put(fileName,id);
      fileId=id;
      fileIdNameMap.put(fileId,fileName);
    }
 else {
      throw new OStorageException(fileName + " already exists.");
    }
    return fileId;
  }
  finally {
    metadataLock.unlock();
  }
}
