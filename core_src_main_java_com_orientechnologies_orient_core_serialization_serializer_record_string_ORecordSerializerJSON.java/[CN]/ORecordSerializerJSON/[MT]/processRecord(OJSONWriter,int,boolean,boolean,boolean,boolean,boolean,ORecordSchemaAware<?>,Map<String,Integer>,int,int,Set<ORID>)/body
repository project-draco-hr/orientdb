{
  Object fieldValue;
  for (  String fieldName : record.fieldNames()) {
    if (iFetchPlan == null) {
      json.writeAttribute(indentLevel + 1,true,fieldName,encode(record.field(fieldName)));
    }
 else {
      Integer depthLevel=getDepthLevel(record,iFetchPlan,fieldName);
      if (depthLevel != null) {
        if (depthLevel == 0) {
          continue;
        }
        if (depthLevel >= iCurrentLevel) {
          continue;
        }
      }
      fieldValue=record.field(fieldName);
      if (fieldValue == null || !(fieldValue instanceof ODocument) && (!(fieldValue instanceof Collection<?>) || ((Collection<?>)fieldValue).size() == 0 || !(((Collection<?>)fieldValue).iterator().next() instanceof ODocument)) && (!(fieldValue instanceof Map<?,?>) || ((Map<?,?>)fieldValue).size() == 0 || !(((Map<?,?>)fieldValue).values().iterator().next() instanceof ODocument))) {
        json.writeAttribute(indentLevel + 1,true,fieldName,encode(record.field(fieldName)));
      }
 else {
        try {
          fetch(record,iFetchPlan,fieldValue,fieldName,iCurrentLevel,iMaxFetch,json,indentLevel,includeType,includeId,includeVer,includeClazz,attribSameRow,false,parsedRecords);
        }
 catch (        Exception e) {
          e.printStackTrace();
          OLogManager.instance().error(null,"Fetching error on record %s",e,record.getIdentity());
        }
      }
    }
  }
}
