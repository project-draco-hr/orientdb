{
  requestType=-1;
  clientTxId=0;
  okSent=false;
  long timer=0;
  try {
    requestType=channel.readByte();
    clientTxId=channel.readInt();
    byte[] token=channel.readBytes();
    if (token != null && token.length > 0) {
      OToken otoken=tokenHandler.parseBinaryToken(token);
    }
    timer=Orient.instance().getProfiler().startChrono();
    onBeforeRequest();
    try {
      if (!executeRequest()) {
        OLogManager.instance().error(this,"Request not supported. Code: " + requestType);
        channel.clearInput();
        sendErrorOrDropConnection(clientTxId,new ONetworkProtocolException("Request not supported. Code: " + requestType));
      }
    }
  finally {
      onAfterRequest();
    }
  }
 catch (  IOException e) {
    handleConnectionError(channel,e);
    sendShutdown();
  }
catch (  OException e) {
    sendErrorOrDropConnection(clientTxId,e);
  }
catch (  RuntimeException e) {
    sendErrorOrDropConnection(clientTxId,e);
  }
catch (  Throwable t) {
    sendErrorOrDropConnection(clientTxId,t);
  }
 finally {
    Orient.instance().getProfiler().stopChrono("server.network.requests","Total received requests",timer,"server.network.requests");
    OSerializationThreadLocal.INSTANCE.get().clear();
  }
}
