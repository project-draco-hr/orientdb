{
  final String fieldName=extractFieldName(field);
  final OIndexDefinition indexDefinition;
  final OProperty propertyToIndex=properties.get(fieldName.toLowerCase());
  final OType propertyToIndexType=propertyToIndex.getType();
  final OType indexType;
  if (propertyToIndexType == OType.EMBEDDEDMAP || propertyToIndexType == OType.LINKMAP) {
    final OPropertyMapIndexDefinition.INDEX_BY indexBy=extractMapIndexSpecifier(field);
    if (indexBy.equals(OPropertyMapIndexDefinition.INDEX_BY.KEY))     indexType=OType.STRING;
 else {
      if (propertyToIndexType == OType.LINKMAP)       indexType=OType.LINK;
 else       indexType=propertyToIndex.getLinkedType();
    }
    indexDefinition=new OPropertyMapIndexDefinition(name,propertyToIndex.getName(),indexType,indexBy);
  }
 else   if (propertyToIndexType.equals(OType.EMBEDDEDLIST) || propertyToIndexType.equals(OType.EMBEDDEDSET) || propertyToIndexType.equals(OType.LINKLIST)|| propertyToIndexType.equals(OType.LINKSET)) {
    if (propertyToIndexType.equals(OType.LINKLIST) || propertyToIndexType.equals(OType.LINKSET))     indexType=OType.LINK;
 else     indexType=propertyToIndex.getLinkedType();
    indexDefinition=new OPropertyListIndexDefinition(name,propertyToIndex.getName(),indexType);
  }
 else   indexDefinition=new OPropertyIndexDefinition(name,propertyToIndex.getName(),propertyToIndexType);
  return indexDefinition;
}
