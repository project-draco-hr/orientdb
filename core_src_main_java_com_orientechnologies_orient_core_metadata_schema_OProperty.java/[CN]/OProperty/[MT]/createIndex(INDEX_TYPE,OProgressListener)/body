{
  if (index != null)   throw new IllegalStateException("Index already created");
  try {
switch (iType) {
case UNIQUE:
      index=new OPropertyIndexUnique(document.getDatabase(),this,OStorage.CLUSTER_INDEX_NAME);
    break;
case NOTUNIQUE:
  index=new OPropertyIndexNotUnique(document.getDatabase(),this,OStorage.CLUSTER_INDEX_NAME);
break;
case FULLTEXT:
index=new OFullTextIndex(document.getDatabase(),this,OStorage.CLUSTER_INDEX_NAME);
break;
}
index.rebuild(iProgressListener);
setDirty();
if (document.getDatabase() != null) {
index.lazySave();
document.getDatabase().getMetadata().getSchema().save();
}
}
 catch (OIndexException e) {
if (index != null) {
index.clear();
document.getDatabase().getMetadata().getSchema().save();
}
throw e;
}
catch (Exception e) {
if (index != null) {
index.clear();
document.getDatabase().getMetadata().getSchema().save();
}
OLogManager.instance().exception("Unable to create '%s' index for property: %s",e,ODatabaseException.class,iType,toString());
}
return index;
}
