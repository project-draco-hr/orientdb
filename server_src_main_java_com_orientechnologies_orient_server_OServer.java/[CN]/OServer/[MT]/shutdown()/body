{
  if (!running)   return;
  OLogManager.instance().info(this,"OrientDB Server is shutting down...");
  running=false;
  shutdownHook.cancel();
  Orient.instance().getProfiler().unregisterHookValue("system.databases");
  for (  OServerLifecycleListener l : lifecycleListeners)   l.onBeforeDeactivate();
  lock.lock();
  try {
    if (pluginManager != null)     pluginManager.shutdown();
    if (networkProtocols.size() > 0) {
      OLogManager.instance().info(this,"Shutting down protocols");
      networkProtocols.clear();
    }
    if (networkListeners.size() > 0) {
      OLogManager.instance().info(this,"Shutting down listeners:");
      for (      OServerNetworkListener l : networkListeners) {
        OLogManager.instance().info(this,"- %s",l);
        try {
          l.shutdown();
        }
 catch (        Throwable e) {
          OLogManager.instance().error(this,"Error during shutdown of listener %s.",e,l);
        }
      }
    }
  }
  finally {
    lock.unlock();
  }
  if (!Orient.isRegisterDatabaseByPath())   try {
    OLogManager.instance().info(this,"Shutting down databases...");
    Orient.instance().shutdown();
  }
 catch (  Throwable e) {
    OLogManager.instance().error(this,"Error during OrientDB shutdown",e);
  }
  for (  OServerLifecycleListener l : lifecycleListeners)   try {
    l.onAfterDeactivate();
  }
 catch (  Exception e) {
    OLogManager.instance().error(this,"Error during deactivation of server lifecycle listener %s",e,l);
  }
  OLogManager.instance().info(this,"OrientDB Server shutdown complete");
  System.out.println();
}
