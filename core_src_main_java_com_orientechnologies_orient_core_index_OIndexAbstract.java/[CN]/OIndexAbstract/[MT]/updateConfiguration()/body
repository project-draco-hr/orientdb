{
  ODocument oldConfig;
  ODocument newConfig;
  do {
    oldConfig=configuration.get();
    newConfig=new ODocument().setTrackingChanges(false);
    if (oldConfig.hasOwners()) {
      ODocumentInternal.addOwner(newConfig,oldConfig.getOwner());
    }
 else {
      ORecordInternal.getDirtyManager(oldConfig).removeNew(oldConfig);
    }
    oldConfig.copyTo(newConfig);
    newConfig.setInternalStatus(ORecordElement.STATUS.UNMARSHALLING);
    try {
      doConfigurationUpdate(newConfig);
    }
  finally {
      newConfig.setInternalStatus(ORecordElement.STATUS.LOADED);
    }
  }
 while (!configuration.compareAndSet(oldConfig,newConfig));
  return newConfig;
}
