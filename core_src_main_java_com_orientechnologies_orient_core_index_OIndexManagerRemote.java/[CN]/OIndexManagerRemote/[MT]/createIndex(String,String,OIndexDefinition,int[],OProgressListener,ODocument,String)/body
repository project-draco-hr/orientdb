{
  String createIndexDDL;
  if (iIndexDefinition != null)   createIndexDDL=iIndexDefinition.toCreateIndexDDL(iName,iType);
 else   createIndexDDL=new OSimpleKeyIndexDefinition().toCreateIndexDDL(iName,iType);
  if (engine != null)   createIndexDDL+=" " + OCommandExecutorSQLCreateIndex.KEYWORD_ENGINE + " "+ engine;
  if (metadata != null)   createIndexDDL+=" " + OCommandExecutorSQLCreateIndex.KEYWORD_METADATA + " "+ metadata.toJSON();
  acquireExclusiveLock();
  try {
    if (iProgressListener != null)     iProgressListener.onBegin(this,0);
    getDatabase().command(new OCommandSQL(createIndexDDL)).execute();
    document.setIdentity(new ORecordId(document.getDatabase().getStorage().getConfiguration().indexMgrRecordId));
    if (iProgressListener != null)     iProgressListener.onCompletition(this,true);
    reload();
    return preProcessBeforeReturn(indexes.get(iName.toLowerCase()));
  }
  finally {
    releaseExclusiveLock();
  }
}
