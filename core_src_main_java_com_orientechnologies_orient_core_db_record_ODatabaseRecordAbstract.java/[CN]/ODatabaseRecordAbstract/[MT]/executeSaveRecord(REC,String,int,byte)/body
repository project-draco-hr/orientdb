{
  checkOpeness();
  if (!iContent.isDirty())   return;
  final ORecordId rid=(ORecordId)iContent.getIdentity();
  if (rid == null)   throw new ODatabaseException("Can't create record because it has no identity. Probably is not a regular record or contains projections of fields rather than a full record");
  try {
    final int clusterId;
    boolean isNew=!rid.isValid();
    if (isNew) {
      clusterId=iClusterName != null ? getClusterIdByName(iClusterName) : getDefaultClusterId();
      checkSecurity(OUser.CLUSTER + "." + clusterId,OUser.CREATE);
    }
 else {
      clusterId=rid.clusterId;
      checkSecurity(OUser.CLUSTER + "." + clusterId,OUser.UPDATE);
    }
    final byte[] stream=iContent.toStream();
    long result=underlying.save(clusterId,rid.getClusterPosition(),stream,iVersion,iContent.getRecordType());
    if (isNew)     iContent.fill(iContent.getDatabase(),clusterId,result,0);
 else     iContent.fill(iContent.getDatabase(),clusterId,rid.getClusterPosition(),(int)result);
    iContent.unsetDirty();
  }
 catch (  ODatabaseException e) {
    throw e;
  }
catch (  Throwable t) {
    throw new ODatabaseException("Error on saving record in cluster #" + iContent.getIdentity().getClusterId(),t);
  }
}
