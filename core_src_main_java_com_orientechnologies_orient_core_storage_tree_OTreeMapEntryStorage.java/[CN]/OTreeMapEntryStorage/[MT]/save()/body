{
  record.fromStream(toStream());
  if (record.getIdentity().isValid())   record.setVersion(((OTreeMapStorage<K,V>)tree).storage.updateRecord(0,record.getIdentity().getClusterId(),record.getIdentity().getClusterPosition(),record.toStream(),record.getVersion(),record.getRecordType()));
 else {
    record.setIdentity(((OTreeMapStorage<K,V>)tree).clusterId,((OTreeMapStorage<K,V>)tree).storage.createRecord(record.getIdentity().getClusterId(),record.toStream(),record.getRecordType()));
  }
  record.unsetDirty();
  return this;
}
