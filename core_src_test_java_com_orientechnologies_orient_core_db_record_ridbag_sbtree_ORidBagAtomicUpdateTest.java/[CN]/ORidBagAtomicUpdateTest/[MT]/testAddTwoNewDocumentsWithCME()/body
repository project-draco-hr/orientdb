{
  final ODocument cmeDoc=new ODocument();
  cmeDoc.save();
  db.begin();
  ODocument rootDoc=new ODocument();
  ORidBag ridBag=new ORidBag();
  rootDoc.field("ridBag",ridBag);
  rootDoc.save();
  db.commit();
  ODocument staleCMEDoc=db.load(cmeDoc.getIdentity());
  Assert.assertNotSame(staleCMEDoc,cmeDoc);
  cmeDoc.field("v","v");
  cmeDoc.save();
  db.begin();
  ODocument docOne=new ODocument();
  ODocument docTwo=new ODocument();
  ridBag.add(docOne);
  ridBag.add(docTwo);
  staleCMEDoc.field("v","v1");
  staleCMEDoc.save();
  try {
    db.commit();
    Assert.fail();
  }
 catch (  OConcurrentModificationException e) {
  }
  rootDoc=db.load(rootDoc.getIdentity());
  ridBag=rootDoc.field("ridBag");
  Assert.assertEquals(ridBag.size(),0);
}
