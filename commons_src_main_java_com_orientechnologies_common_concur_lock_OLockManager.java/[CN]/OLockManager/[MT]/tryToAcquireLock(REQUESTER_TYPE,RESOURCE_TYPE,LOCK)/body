{
  OProfiler.getInstance().updateCounter("LockMgr.tryToAcquire",+1);
  LockEntry<RESOURCE_TYPE,REQUESTER_TYPE> currentLock=lookForEntry(iResourceId);
  if (currentLock == null)   return addEntry(new LockEntry<RESOURCE_TYPE,REQUESTER_TYPE>(iLockType,iRequester,iResourceId,LOCK_STATUS.LIVE));
  OSharedLockEntry<REQUESTER_TYPE> curentSharedLock=currentLock;
  do {
    if (curentSharedLock.requester.equals(iRequester)) {
      if (iLockType == LOCK.EXCLUSIVE) {
        if (currentLock.nextSharedLock == null) {
          currentLock.countExclLocks++;
          return currentLock;
        }
 else {
          return addWaitingEntry(currentLock,curentSharedLock,iLockType,iRequester,iResourceId);
        }
      }
 else {
        curentSharedLock.countSharedLocks++;
        return currentLock;
      }
    }
    curentSharedLock=curentSharedLock.nextSharedLock;
  }
 while (curentSharedLock != null);
  if (currentLock.countExclLocks > 0) {
    return addWaitingEntry(currentLock,null,iLockType,iRequester,iResourceId);
  }
 else {
    if (iLockType == LOCK.SHARED) {
      addSharedLockEntry(currentLock,iRequester);
      return currentLock;
    }
 else {
      return addWaitingEntry(currentLock,null,iLockType,iRequester,iResourceId);
    }
  }
}
