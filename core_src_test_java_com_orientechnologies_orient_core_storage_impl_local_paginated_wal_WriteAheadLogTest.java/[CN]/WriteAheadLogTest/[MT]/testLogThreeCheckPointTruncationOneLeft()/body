{
  writeAheadLog.close();
  writeAheadLog=new OWriteAheadLog(1024,1000,2048,10105,"WriteAheadLogTest",testDir.getAbsolutePath());
  List<OWALRecord> writtenRecords=new ArrayList<OWALRecord>();
  Random rnd=new Random();
  final int recordsToWrite=217;
  OWALRecord walRecord=new OCheckpointStartRecord();
  writeAheadLog.logRecord(walRecord);
  writtenRecords.add(walRecord);
  walRecord=new OCheckpointStartRecord();
  writeAheadLog.logRecord(walRecord);
  writtenRecords.add(walRecord);
  for (int i=0; i < recordsToWrite; i++) {
    if (i == 50) {
      walRecord=new OCheckpointStartRecord();
      writeAheadLog.logRecord(walRecord);
      writtenRecords.add(walRecord);
    }
 else {
      byte[] data=new byte[10];
      rnd.nextBytes(data);
      int pageOffset=rnd.nextInt(65536);
      long pageIndex=rnd.nextLong();
      OSetPageDataRecord setPageDataRecord=new OSetPageDataRecord(data,pageOffset,pageIndex,"test");
      writtenRecords.add(setPageDataRecord);
      writeAheadLog.logRecord(setPageDataRecord);
    }
  }
  assertLogContent(writeAheadLog,writtenRecords.subList(45,writtenRecords.size()));
  Assert.assertEquals(walRecord.getLsn(),writeAheadLog.getLastCheckpoint());
  Assert.assertNull(writeAheadLog.read(writtenRecords.get(44).getLsn()));
}
