{
  watchDogListener=Orient.instance().getMemoryWatchDog().addListener(new Listener(){
    /** 
 * Auto reduce cache size of 10%
 */
    public void memoryUsageLow(    TYPE iType,    final long usedMemory,    final long maxMemory){
      if (iType == TYPE.JVM) {
        acquireExclusiveLock();
        final int oldSize=entries.size();
        if (oldSize == 0)         return;
        final int threshold=(int)(maxSize > -1 ? maxSize * 0.7f : oldSize * 0.7f);
        try {
          if (entries.size() < threshold)           return;
          final ORID[] ridToRemove=new ORID[entries.size() - threshold];
          int i=0;
          for (          ORID rid : entries.keySet()) {
            ridToRemove[i++]=rid;
            if (i >= ridToRemove.length)             break;
          }
          for (          ORID rid : ridToRemove)           entries.remove(rid);
        }
  finally {
          System.err.println("Size after free: " + entries.size());
          releaseExclusiveLock();
        }
        OLogManager.instance().debug(this,"Low memory: auto reduce the record cache size from %d to %d",oldSize,threshold);
        maxSize=threshold;
      }
    }
  }
);
  OProfiler.getInstance().registerHookValue(profilerPrefix + ".cache.current",new OProfilerHookValue(){
    public Object getValue(){
      return entries.size();
    }
  }
);
  OProfiler.getInstance().registerHookValue(profilerPrefix + ".cache.max",new OProfilerHookValue(){
    public Object getValue(){
      return maxSize;
    }
  }
);
}
