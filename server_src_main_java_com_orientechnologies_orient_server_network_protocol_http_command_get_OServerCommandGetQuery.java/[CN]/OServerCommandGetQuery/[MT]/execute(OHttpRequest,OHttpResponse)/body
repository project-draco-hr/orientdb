{
  String[] urlParts=checkSyntax(iRequest.url,4,"Syntax error: query/<database>/sql/<query-text>[/<limit>][/<fetchPlan>].<br/>Limit is optional and is setted to 20 by default. Set expressely to 0 to have no limits.");
  final int limit=urlParts.length > 4 ? Integer.parseInt(urlParts[4]) : 20;
  String fetchPlan=urlParts.length > 5 ? urlParts[5] : null;
  final String text=urlParts[3];
  iRequest.data.commandInfo="Query";
  iRequest.data.commandDetail=text;
  ODatabaseDocumentTx db=null;
  final List<OIdentifiable> response;
  try {
    db=getProfiledDatabaseInstance(iRequest);
    final OQueryAbstract command=new OSQLSynchQuery<ORecordSchemaAware>(text,limit).setFetchPlan(fetchPlan);
    response=(List<OIdentifiable>)db.query(command);
    fetchPlan=command.getFetchPlan();
    iResponse.writeRecords(response,fetchPlan);
  }
  finally {
    if (db != null)     db.close();
  }
  return false;
}
