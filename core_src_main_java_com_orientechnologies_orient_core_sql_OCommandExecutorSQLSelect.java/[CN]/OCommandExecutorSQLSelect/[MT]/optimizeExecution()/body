{
  if ((compiledFilter == null || (compiledFilter != null && compiledFilter.getRootCondition() == null)) && groupByFields == null && projections != null && projections.size() == 1) {
    final Map.Entry<String,Object> entry=projections.entrySet().iterator().next();
    if (entry.getValue() instanceof OSQLFunctionRuntime) {
      final OSQLFunctionRuntime rf=(OSQLFunctionRuntime)entry.getValue();
      if (rf.function instanceof OSQLFunctionCount && rf.configuredParameters.length == 1 && "*".equals(rf.configuredParameters[0])) {
        long count=0;
        if (parsedTarget.getTargetClasses() != null) {
          final OClass cls=parsedTarget.getTargetClasses().keySet().iterator().next();
          count=cls.count();
        }
 else         if (parsedTarget.getTargetClusters() != null) {
          for (          String cluster : parsedTarget.getTargetClusters().keySet()) {
            count+=getDatabase().countClusterElements(cluster);
          }
        }
 else         if (parsedTarget.getTargetIndex() != null) {
          count+=getDatabase().getMetadata().getIndexManager().getIndex(parsedTarget.getTargetIndex()).getSize();
        }
        if (tempResult == null)         tempResult=new ArrayList<OIdentifiable>();
        ((Collection<OIdentifiable>)tempResult).add(new ODocument().field(entry.getKey(),count));
        return true;
      }
    }
  }
  if (orderedFields != null && !orderedFields.isEmpty()) {
    if (parsedTarget.getTargetClasses() != null) {
      final OClass cls=parsedTarget.getTargetClasses().keySet().iterator().next();
      final OPair<String,String> orderByFirstField=orderedFields.iterator().next();
      final OProperty p=cls.getProperty(orderByFirstField.getKey());
      if (p != null) {
        final Set<OIndex<?>> involvedIndexes=cls.getInvolvedIndexes(orderByFirstField.getKey());
        if (involvedIndexes != null && !involvedIndexes.isEmpty()) {
          for (          OIndex<?> idx : involvedIndexes) {
            if (idx.getKeyTypes().length == 1 && idx.supportsOrderedIterations()) {
              if (idx.getSize() < MIN_THRESHOLD_USE_INDEX_AS_TARGET || compiledFilter == null) {
                if (orderByFirstField.getValue().equalsIgnoreCase("asc"))                 target=(Iterator<? extends OIdentifiable>)idx.valuesIterator();
 else                 target=(Iterator<? extends OIdentifiable>)idx.valuesInverseIterator();
                if (context.isRecordingMetrics()) {
                  Set<String> idxNames=(Set<String>)context.getVariable("involvedIndexes");
                  if (idxNames == null) {
                    idxNames=new HashSet<String>();
                    context.setVariable("involvedIndexes",idxNames);
                  }
                  idxNames.add(idx.getName());
                }
                orderedFields=null;
                fetchLimit=getQueryFetchLimit();
                break;
              }
            }
          }
        }
      }
    }
  }
  return false;
}
