{
  final Class<?> selfClass=self.getClass();
  for (  String fieldName : doc.fieldNames()) {
    final Field field=OObjectEntitySerializer.getField(fieldName,selfClass);
    if (field != null) {
      Object value=getValue(self,fieldName,false,null);
      if (value instanceof OLazyObjectMultivalueElement) {
        ((OLazyObjectMultivalueElement<?>)value).detachAll(nonProxiedInstance);
        if (nonProxiedInstance)         value=((OLazyObjectMultivalueElement<?>)value).getNonOrientInstance();
      }
 else       if (value instanceof Proxy) {
        OObjectProxyMethodHandler handler=(OObjectProxyMethodHandler)((ProxyObject)value).getHandler();
        if (nonProxiedInstance) {
          value=OObjectEntitySerializer.getNonProxiedInstance(value);
        }
        handler.detachAll(value,nonProxiedInstance);
      }
      OObjectEntitySerializer.setFieldValue(field,self,value);
    }
  }
  OObjectEntitySerializer.setIdField(selfClass,self,doc.getIdentity());
  OObjectEntitySerializer.setVersionField(selfClass,self,doc.getVersion());
}
