{
  String rootPassword=OSystemVariableResolver.resolveVariable(ROOT_PASSWORD_VAR);
  if (rootPassword != null) {
    rootPassword=rootPassword.trim();
    if (rootPassword.isEmpty())     rootPassword=null;
  }
  if (rootPassword == null && !serverCfg.existsUser(OServerConfiguration.DEFAULT_ROOT_USER)) {
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException e) {
    }
    System.out.println();
    System.out.println();
    System.out.println("+---------------------------------------------------------------+");
    System.out.println("|                WARNING: FIRST RUN CONFIGURATION               |");
    System.out.println("+---------------------------------------------------------------+");
    System.out.println("| This is the first time the server is running. Please type a   |");
    System.out.println("| password of your choice for the 'root' user or leave it blank |");
    System.out.println("| to auto-generate it.                                          |");
    System.out.println("|                                                               |");
    System.out.println("| To avoid this message set the environment variable or JVM     |");
    System.out.println("| setting ORIENTDB_ROOT_PASSWORD to the root password to use.   |");
    System.out.println("+---------------------------------------------------------------+");
    final OConsoleReader console=new ODefaultConsoleReader();
    do {
      System.out.print("\nRoot password [BLANK=auto generate it]: ");
      rootPassword=console.readPassword();
      if (rootPassword != null) {
        rootPassword=rootPassword.trim();
        if (rootPassword.isEmpty())         rootPassword=null;
      }
      if (rootPassword != null) {
        System.out.print("Please confirm the root password: ");
        String rootConfirmPassword=console.readPassword();
        if (rootConfirmPassword != null) {
          rootConfirmPassword=rootConfirmPassword.trim();
          if (rootConfirmPassword.isEmpty())           rootConfirmPassword=null;
        }
        if (!rootPassword.equals(rootConfirmPassword)) {
          System.out.println("ERROR: Passwords don't match, please reinsert both of them, or press ENTER to auto generate it");
        }
 else         break;
      }
    }
 while (rootPassword != null);
  }
 else   OLogManager.instance().warn(this,"Found ORIENTDB_ROOT_PASSWORD variable, using this value as root's password",rootPassword);
  if (!serverCfg.existsUser(OServerConfiguration.DEFAULT_ROOT_USER)) {
    addUser(OServerConfiguration.DEFAULT_ROOT_USER,rootPassword,"*");
  }
  if (!serverCfg.existsUser(OServerConfiguration.GUEST_USER)) {
    addUser(OServerConfiguration.GUEST_USER,OServerConfiguration.GUEST_PASS,"connect,server.listDatabases,server.dblist");
  }
}
