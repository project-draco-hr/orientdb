{
  final int v=version.getCounter();
switch (v) {
case -1:
    iDatabaseVersion.increment();
  break;
case -2:
iDatabaseVersion.setCounter(-2);
break;
default :
if (v < -2) {
version.clearRollbackMode();
iDatabaseVersion.setCounter(version.getCounter());
}
 else if (!version.equals(iDatabaseVersion)) {
final ORecordConflictStrategy strategy=iCluster.getRecordConflictStrategy() != null ? iCluster.getRecordConflictStrategy() : recordConflictStrategy;
return strategy.onUpdate(iRecordType,rid,version,iRecordContent,iDatabaseVersion);
}
 else iDatabaseVersion.increment();
}
return null;
}
