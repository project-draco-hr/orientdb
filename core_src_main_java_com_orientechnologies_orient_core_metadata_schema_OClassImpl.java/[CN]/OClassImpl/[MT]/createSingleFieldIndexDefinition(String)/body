{
  final String fieldName=extractFieldName(field);
  final OIndexDefinition indexDefinition;
  final OProperty propertyToIndex=properties.get(fieldName.toLowerCase());
  final OType propertyToIndexType=propertyToIndex.getType();
  final OType indexType;
  if (propertyToIndexType == OType.EMBEDDEDMAP || propertyToIndexType == OType.LINKMAP) {
    final OPropertyMapIndexDefinition.INDEX_BY indexBy=extractMapIndexSpecifier(field);
    if (indexBy.equals(OPropertyMapIndexDefinition.INDEX_BY.KEY))     indexType=OType.STRING;
 else {
      if (propertyToIndexType == OType.LINKMAP)       throw new OIndexException("LINK types indexing are not supported.");
 else {
        indexType=propertyToIndex.getLinkedType();
        if (indexType == null)         throw new OIndexException("Linked type was not provided." + " You should provide linked type for embedded collections that are going to be indexed.");
      }
    }
    indexDefinition=new OPropertyMapIndexDefinition(name,propertyToIndex.getName(),indexType,indexBy);
  }
 else   if (propertyToIndexType.equals(OType.EMBEDDEDLIST) || propertyToIndexType.equals(OType.EMBEDDEDSET) || propertyToIndexType.equals(OType.LINKLIST)|| propertyToIndexType.equals(OType.LINKSET)) {
    if (propertyToIndexType.equals(OType.LINKLIST) || propertyToIndexType.equals(OType.LINKSET))     throw new OIndexException("LINK types indexing are not supported.");
 else {
      indexType=propertyToIndex.getLinkedType();
      if (indexType == null)       throw new OIndexException("Linked type was not provided." + " You should provide linked type for embedded collections that are going to be indexed.");
    }
    indexDefinition=new OPropertyListIndexDefinition(name,propertyToIndex.getName(),indexType);
  }
 else   indexDefinition=new OPropertyIndexDefinition(name,propertyToIndex.getName(),propertyToIndexType);
  return indexDefinition;
}
