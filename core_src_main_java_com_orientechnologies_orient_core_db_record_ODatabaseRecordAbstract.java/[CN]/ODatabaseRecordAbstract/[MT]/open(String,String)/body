{
  try {
    super.open(iUserName,iUserPassword);
    level1Cache.startup();
    metadata=new OMetadata(this);
    metadata.load();
    recordFormat=DEF_RECORD_FORMAT;
    user=getMetadata().getSecurity().getUser(iUserName);
    if (user == null)     throw new OSecurityAccessException(this.getName(),"User or password not valid for database: '" + getName() + "'");
    if (user.getAccountStatus() != STATUSES.ACTIVE)     throw new OSecurityAccessException(this.getName(),"User '" + iUserName + "' is not active");
    if (getStorage() instanceof OStorageEmbedded) {
      registerHook(new OUserTrigger());
      registerHook(new OPropertyIndexManager());
    }
    if (getStorage() instanceof OStorageEmbedded) {
      if (!user.checkPassword(iUserPassword)) {
        Thread.sleep(200);
        throw new OSecurityAccessException(this.getName(),"User or password not valid for database: '" + getName() + "'");
      }
    }
    checkSecurity(ODatabaseSecurityResources.DATABASE,ORole.PERMISSION_READ);
  }
 catch (  Exception e) {
    close();
    throw new ODatabaseException("Can't open database",e);
  }
  return (DB)this;
}
