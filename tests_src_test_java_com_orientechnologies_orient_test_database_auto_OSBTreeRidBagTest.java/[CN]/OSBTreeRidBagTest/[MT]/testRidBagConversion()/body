{
  final int oldThreshold=OGlobalConfiguration.RID_BAG_EMBEDDED_TO_SBTREEBONSAI_THRESHOLD.getValueAsInteger();
  OGlobalConfiguration.RID_BAG_EMBEDDED_TO_SBTREEBONSAI_THRESHOLD.setValue(5);
  ODocument doc_1=new ODocument();
  doc_1.save();
  ODocument doc_2=new ODocument();
  doc_2.save();
  ODocument doc_3=new ODocument();
  doc_3.save();
  ODocument doc_4=new ODocument();
  doc_4.save();
  ODocument doc=new ODocument();
  ORidBag bag=new ORidBag();
  bag.add(doc_1);
  bag.add(doc_2);
  bag.add(doc_3);
  bag.add(doc_4);
  doc.field("ridBag",bag);
  doc.save();
  doc.reload();
  ODocument doc_5=new ODocument();
  doc_5.save();
  ODocument doc_6=new ODocument();
  doc_6.save();
  bag=doc.field("ridBag");
  bag.add(doc_5);
  bag.add(doc_6);
  doc.save();
  doc.reload();
  bag=doc.field("ridBag");
  Assert.assertEquals(bag.size(),6);
  List<OIdentifiable> docs=new ArrayList<OIdentifiable>();
  docs.add(doc_1.getIdentity());
  docs.add(doc_2.getIdentity());
  docs.add(doc_3.getIdentity());
  docs.add(doc_4.getIdentity());
  docs.add(doc_5.getIdentity());
  docs.add(doc_6.getIdentity());
  for (  OIdentifiable rid : bag)   Assert.assertTrue(docs.remove(rid));
  Assert.assertTrue(docs.isEmpty());
  OGlobalConfiguration.RID_BAG_EMBEDDED_TO_SBTREEBONSAI_THRESHOLD.setValue(oldThreshold);
}
