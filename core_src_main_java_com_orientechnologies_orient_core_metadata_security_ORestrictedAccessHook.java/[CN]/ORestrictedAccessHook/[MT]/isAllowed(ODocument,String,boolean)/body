{
  final OClass cls=iDocument.getImmutableSchemaClass();
  if (cls != null && cls.isSubClassOf(OSecurityShared.RESTRICTED_CLASSNAME)) {
    final ODatabaseDocument db=ODatabaseRecordThreadLocal.INSTANCE.get();
    if (db.getUser() == null)     return true;
    if (db.getUser().isRuleDefined(ODatabaseSecurityResources.BYPASS_RESTRICTED))     if (db.getUser().checkIfAllowed(ODatabaseSecurityResources.BYPASS_RESTRICTED,ORole.PERMISSION_READ) != null)     return true;
    final ODocument doc;
    if (iReadOriginal)     doc=(ODocument)db.load(iDocument.getIdentity());
 else     doc=iDocument;
    return db.getMetadata().getSecurity().isAllowed((Set<OIdentifiable>)doc.field(OSecurityShared.ALLOW_ALL_FIELD),(Set<OIdentifiable>)doc.field(iAllowOperation));
  }
  return true;
}
