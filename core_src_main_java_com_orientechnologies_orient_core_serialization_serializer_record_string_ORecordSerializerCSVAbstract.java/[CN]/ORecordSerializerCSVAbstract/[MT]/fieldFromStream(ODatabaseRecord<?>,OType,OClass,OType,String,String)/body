{
  if (iValue == null)   return null;
switch (iType) {
case EMBEDDEDLIST:
case EMBEDDEDSET:
{
      if (iValue.length() == 0)       return null;
      String value=iValue.substring(1,iValue.length() - 1);
      Collection<Object> coll=iType == OType.EMBEDDEDLIST ? new ArrayList<Object>() : new HashSet<Object>();
      if (value.length() == 0)       return coll;
      String[] items=OStringSerializerHelper.split(value,OStringSerializerHelper.RECORD_SEPARATOR_AS_CHAR);
      if (iLinkedClass != null)       for (      String item : items) {
        coll.add(fromString(iDatabase,item,new ODocument((ODatabaseDocument)iDatabase,iLinkedClass.getName())));
      }
 else {
        if (iLinkedType == null)         throw new IllegalArgumentException("Linked type can't be null. Probably the serialized type has not stored the type along with data");
        for (        String item : items) {
          coll.add(OStringSerializerHelper.fieldTypeFromStream(iLinkedType,item));
        }
      }
      return coll;
    }
case LINKLIST:
case LINKSET:
{
    if (iValue.length() == 0)     return null;
    String value=iValue.substring(1,iValue.length() - 1);
    Collection<Object> coll=iType == OType.LINKLIST ? new ArrayList<Object>() : new HashSet<Object>();
    if (value.length() == 0)     return coll;
    String[] items=OStringSerializerHelper.split(value,OStringSerializerHelper.RECORD_SEPARATOR_AS_CHAR);
    for (    String item : items) {
      int classSeparatorPos=value.indexOf(OStringSerializerHelper.CLASS_SEPARATOR);
      if (classSeparatorPos > -1) {
        String className=value.substring(1,classSeparatorPos);
        if (className != null) {
          iLinkedClass=iDatabase.getMetadata().getSchema().getClass(className);
          item=item.substring(classSeparatorPos + 1);
        }
      }
 else       item=item.substring(1);
      coll.add(new ODocument(iDatabase,iLinkedClass != null ? iLinkedClass.getName() : null,new ORecordId(item)));
    }
    return coll;
  }
case EMBEDDEDMAP:
{
  if (iValue.length() == 0)   return null;
  String value=iValue.substring(1,iValue.length() - 1);
  Map<String,Object> map=new HashMap<String,Object>();
  if (value.length() == 0)   return map;
  String[] items=OStringSerializerHelper.split(value,OStringSerializerHelper.RECORD_SEPARATOR_AS_CHAR);
  if (iLinkedClass != null)   for (  String item : items) {
    map.put("",fromString(iDatabase,item,new ODocument((ODatabaseDocument)iDatabase,iLinkedClass.getName())));
  }
 else {
    if (iLinkedType == null)     throw new IllegalArgumentException("Linked type can't be null. Probably the serialized type has not stored the type along with data");
    for (    String item : items) {
      map.put("",OStringSerializerHelper.fieldTypeFromStream(iLinkedType,item));
    }
  }
  return map;
}
case LINK:
int pos=iValue.indexOf(OStringSerializerHelper.CLASS_SEPARATOR);
if (pos > -1) iLinkedClass=iDatabase.getMetadata().getSchema().getClass(iValue.substring(OStringSerializerHelper.LINK.length(),pos));
 else pos=0;
if (iLinkedClass == null) throw new IllegalArgumentException("Linked class not specified in ORID field: " + iValue);
ORecordId recId=new ORecordId(iValue.substring(pos + 1));
return new ODocument(iDatabase,iLinkedClass.getName(),recId);
default :
return OStringSerializerHelper.fieldTypeFromStream(iType,iValue);
}
}
