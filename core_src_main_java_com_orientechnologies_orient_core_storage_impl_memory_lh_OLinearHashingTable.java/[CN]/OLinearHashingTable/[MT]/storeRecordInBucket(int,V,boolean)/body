{
  final OLinearHashingBucket bucket=file.get(bucketNumber);
  for (int i=0; i < bucket.size; i++) {
    if (value.clusterPosition.equals(bucket.keys[i])) {
      return false;
    }
  }
  bucket.keys[bucket.size]=value.clusterPosition;
  bucket.values[bucket.size]=value;
  bucket.size++;
  final int positionInIndex;
  final OLinearHashingIndex indexToUse;
  if (mainBucket) {
    positionInIndex=bucketNumber;
    indexToUse=primaryIndex;
  }
 else {
    positionInIndex=pageIndicator.getRealPosInSecondaryIndex(bucketNumber);
    indexToUse=secondaryIndex;
  }
  int displacement=indexToUse.incrementChainDisplacement(positionInIndex,bucket.size);
  if (bucket.size == OLinearHashingBucket.BUCKET_MAX_SIZE && displacement > 253) {
    throw new RuntimeException("this can't be true");
  }
  byte[] signatures=new byte[bucket.size];
  for (int i=0, keysLength=bucket.size; i < keysLength; i++) {
    signatures[i]=OLinearHashingHashCalculatorFactory.INSTANCE.calculateSignature(bucket.keys[i]);
  }
  if (displacement <= 253) {
    indexToUse.updateSignature(positionInIndex,bucket.keys,bucket.size);
  }
  return true;
}
