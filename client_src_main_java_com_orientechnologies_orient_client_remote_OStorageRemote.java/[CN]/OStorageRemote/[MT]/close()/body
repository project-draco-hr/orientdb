{
  boolean locked=lock.acquireExclusiveLock();
  try {
    if (!open)     return;
    beginRequest(OChannelBinaryProtocol.REQUEST_DB_CLOSE);
    endRequest();
    network.flush();
    serviceThread.sendShutdown();
    serviceThread.interrupt();
    network.close();
    cache.removeUser();
    cache.clear();
    open=false;
    Orient.instance().unregisterStorage(this);
  }
 catch (  Exception e) {
  }
 finally {
    lock.releaseExclusiveLock(locked);
  }
}
