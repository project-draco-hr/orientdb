{
  if (pattern.getNumOfEdges() == matchContext.matchedEdges.size()) {
    addResult(matchContext,request);
    return true;
  }
  PatternNode rootNode=pattern.get(matchContext.root);
  Iterator<PatternEdge> edgeIterator=rootNode.out.iterator();
  while (edgeIterator.hasNext()) {
    PatternEdge outEdge=edgeIterator.next();
    if (!matchContext.matchedEdges.containsKey(outEdge)) {
      Object rightValues=executeTraversal(matchContext,iCommandContext,outEdge);
      if (!(rightValues instanceof Iterable)) {
        rightValues=Collections.singleton(rightValues);
      }
      for (      OIdentifiable rightValue : (Iterable<OIdentifiable>)rightValues) {
        Iterable<OIdentifiable> prevMatchedRightValues=matchContext.candidates.get(outEdge.in.alias);
        if (matchContext.matched.containsKey(outEdge.in.alias)) {
          if (matchContext.matched.get(outEdge.in.alias).getIdentity().equals(rightValue.getIdentity())) {
            MatchContext childContext=matchContext.copy(outEdge.in.alias,rightValue.getIdentity());
            if (edgeIterator.hasNext()) {
              childContext.root=rootNode.alias;
            }
 else {
              childContext.root=calculateNextRoot(pattern,childContext);
            }
            childContext.matchedEdges.put(outEdge,true);
            if (!processContext(pattern,estimatedRootEntries,childContext,aliasClasses,aliasFilters,iCommandContext,request)) {
              return false;
            }
            break;
          }
        }
 else         if (prevMatchedRightValues != null && prevMatchedRightValues.iterator().hasNext()) {
          for (          OIdentifiable id : prevMatchedRightValues) {
            if (id.getIdentity().equals(rightValue.getIdentity())) {
              MatchContext childContext=matchContext.copy(outEdge.in.alias,id);
              if (edgeIterator.hasNext()) {
                childContext.root=rootNode.alias;
              }
 else {
                childContext.root=calculateNextRoot(pattern,childContext);
              }
              childContext.matchedEdges.put(outEdge,true);
              if (!processContext(pattern,estimatedRootEntries,childContext,aliasClasses,aliasFilters,iCommandContext,request)) {
                return false;
              }
            }
          }
        }
 else {
          MatchContext childContext=matchContext.copy(outEdge.in.alias,rightValue.getIdentity());
          if (edgeIterator.hasNext()) {
            childContext.root=rootNode.alias;
          }
 else {
            childContext.root=calculateNextRoot(pattern,childContext);
          }
          childContext.matchedEdges.put(outEdge,true);
          if (!processContext(pattern,estimatedRootEntries,childContext,aliasClasses,aliasFilters,iCommandContext,request)) {
            return false;
          }
        }
      }
      break;
    }
  }
  edgeIterator=rootNode.in.iterator();
  while (edgeIterator.hasNext()) {
    PatternEdge inEdge=edgeIterator.next();
    if (!matchContext.matchedEdges.containsKey(inEdge)) {
      if (!inEdge.item.isBidirectional()) {
        continue;
      }
      if (!matchContext.matchedEdges.containsKey(inEdge)) {
        Object leftValues=inEdge.item.method.executeReverse(matchContext.matched.get(matchContext.root),iCommandContext);
        if (!(leftValues instanceof Iterable)) {
          leftValues=Collections.singleton(leftValues);
        }
        for (        OIdentifiable leftValue : (Iterable<OIdentifiable>)leftValues) {
          Iterable<OIdentifiable> prevMatchedRightValues=matchContext.candidates.get(inEdge.out.alias);
          if (matchContext.matched.containsKey(inEdge.out.alias)) {
            if (matchContext.matched.get(inEdge.out.alias).getIdentity().equals(leftValue.getIdentity())) {
              MatchContext childContext=matchContext.copy(inEdge.out.alias,leftValue.getIdentity());
              if (edgeIterator.hasNext()) {
                childContext.root=rootNode.alias;
              }
 else {
                childContext.root=calculateNextRoot(pattern,childContext);
              }
              childContext.matchedEdges.put(inEdge,true);
              if (!processContext(pattern,estimatedRootEntries,childContext,aliasClasses,aliasFilters,iCommandContext,request)) {
                return false;
              }
              break;
            }
          }
 else           if (prevMatchedRightValues != null && prevMatchedRightValues.iterator().hasNext()) {
            for (            OIdentifiable id : prevMatchedRightValues) {
              if (id.getIdentity().equals(leftValue.getIdentity())) {
                MatchContext childContext=matchContext.copy(inEdge.out.alias,id);
                if (edgeIterator.hasNext()) {
                  childContext.root=rootNode.alias;
                }
 else {
                  childContext.root=calculateNextRoot(pattern,childContext);
                }
                childContext.matchedEdges.put(inEdge,true);
                if (!processContext(pattern,estimatedRootEntries,childContext,aliasClasses,aliasFilters,iCommandContext,request)) {
                  return false;
                }
              }
            }
          }
 else {
            OWhereClause where=aliasFilters.get(inEdge.out.alias);
            if (where == null || where.matchesFilters(leftValue,iCommandContext)) {
              MatchContext childContext=matchContext.copy(inEdge.out.alias,leftValue.getIdentity());
              if (edgeIterator.hasNext()) {
                childContext.root=rootNode.alias;
              }
 else {
                childContext.root=calculateNextRoot(pattern,childContext);
              }
              childContext.matchedEdges.put(inEdge,true);
              if (!processContext(pattern,estimatedRootEntries,childContext,aliasClasses,aliasFilters,iCommandContext,request)) {
                return false;
              }
            }
          }
        }
        break;
      }
    }
  }
  return true;
}
