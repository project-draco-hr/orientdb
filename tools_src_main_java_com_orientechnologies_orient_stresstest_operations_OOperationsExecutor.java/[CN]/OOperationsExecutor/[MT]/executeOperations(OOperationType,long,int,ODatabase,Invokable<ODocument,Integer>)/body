{
  int percentileFrequency=operationsInTx > 0 ? operationsInTx : ((int)(numberOfOperations / 100));
  List<ODocument> insertedDocs=new ArrayList<ODocument>();
  if (operationsInTx > 0) {
    database.begin();
  }
  long percentileStartTiming=System.currentTimeMillis();
  for (int j=1; j <= numberOfOperations; j++) {
    if (operationsInTx > 0 && j % operationsInTx == 0) {
      database.commit();
      database.begin();
    }
    ODocument doc=operationToExecute.invoke(j - 1);
    if (j % percentileFrequency == 0) {
      stressTestResults.addPartialResult(operationType,System.currentTimeMillis() - percentileStartTiming);
      stressTestResults.setTestProgress(operationType,percentileFrequency);
      percentileStartTiming=System.currentTimeMillis();
    }
    if (doc != null) {
      insertedDocs.add(doc);
    }
  }
  if (operationsInTx > 0) {
    database.commit();
    stressTestResults.setTestProgress(operationType,(int)(numberOfOperations % percentileFrequency));
  }
  return insertedDocs;
}
