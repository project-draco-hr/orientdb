{
  if (!getNodeSource().equals(iManager.getLocalNodeName())) {
    final String databaseName=database.getName();
    final Lock lock=iManager.getLock(databaseName);
    if (lock.tryLock()) {
      try {
        ODistributedServerLog.warn(this,iManager.getLocalNodeName(),getNodeSource(),DIRECTION.OUT,"deploying database %s...",databaseName);
        final ByteArrayOutputStream out=new ByteArrayOutputStream();
        database.backup(out,null);
        final byte[] buffer=out.toByteArray();
        ODistributedServerLog.warn(this,iManager.getLocalNodeName(),getNodeSource(),DIRECTION.OUT,"sending the compressed database %s over the network, total %s",databaseName,OFileUtils.getSizeAsString(buffer.length));
        return new OBuffer(buffer);
      }
  finally {
        lock.unlock();
      }
    }
 else     ODistributedServerLog.warn(this,iManager.getLocalNodeName(),getNodeSource(),DIRECTION.NONE,"skip deploying database %s because another node is doing it",databaseName);
  }
 else   ODistributedServerLog.warn(this,iManager.getLocalNodeName(),getNodeSource(),DIRECTION.NONE,"skip deploying database from the same node");
  return new OBuffer(new byte[0]);
}
