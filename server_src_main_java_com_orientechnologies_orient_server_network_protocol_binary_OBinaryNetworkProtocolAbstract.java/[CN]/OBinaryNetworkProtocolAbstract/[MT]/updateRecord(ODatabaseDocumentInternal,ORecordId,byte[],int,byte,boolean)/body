{
  final ORecord newRecord=Orient.instance().getRecordFactoryManager().newInstance(recordType);
  fillRecord(rid,buffer,version,newRecord,null);
  ORecordInternal.setContentChanged(newRecord,updateContent);
  ORecordInternal.getDirtyManager(newRecord).clearForSave();
  ORecord currentRecord=null;
  if (newRecord instanceof ODocument) {
    try {
      currentRecord=iDatabase.load(rid);
    }
 catch (    ORecordNotFoundException e) {
      if (e.getCause() instanceof OOfflineClusterException)       throw (OOfflineClusterException)e.getCause();
    }
    if (currentRecord == null)     throw new ORecordNotFoundException(rid.toString());
    ((ODocument)currentRecord).merge((ODocument)newRecord,false,false);
  }
 else   currentRecord=newRecord;
  ORecordInternal.setVersion(currentRecord,version);
  iDatabase.save(currentRecord);
  if (currentRecord.getIdentity().toString().equals(iDatabase.getStorage().getConfiguration().indexMgrRecordId) && !iDatabase.getStatus().equals(STATUS.IMPORTING)) {
    iDatabase.getMetadata().getIndexManager().reload();
  }
  return currentRecord.getVersion();
}
