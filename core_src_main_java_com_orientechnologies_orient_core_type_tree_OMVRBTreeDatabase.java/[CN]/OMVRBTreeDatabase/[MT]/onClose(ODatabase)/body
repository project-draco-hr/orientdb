{
  final boolean locked=lock.acquireExclusiveLock();
  try {
    lock.removeUser();
    if (lock.getUsers() == 0) {
      super.commitChanges(database);
      cache.clear();
      entryPoints.clear();
      root=null;
    }
  }
  finally {
    lock.releaseExclusiveLock(locked);
  }
}
