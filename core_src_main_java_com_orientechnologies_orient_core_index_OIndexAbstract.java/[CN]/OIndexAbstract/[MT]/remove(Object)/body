{
  checkForRebuild();
  key=getCollatingValue(key);
  final ODatabase database=getDatabase();
  final boolean txIsActive=database.getTransaction().isActive();
  if (txIsActive)   keyLockManager.acquireSharedLock(key);
  try {
    modificationLock.requestModificationLock();
    try {
      acquireSharedLock();
      try {
        markStorageDirty();
        return indexEngine.remove(key);
      }
  finally {
        releaseSharedLock();
      }
    }
  finally {
      modificationLock.releaseModificationLock();
    }
  }
  finally {
    if (txIsActive)     keyLockManager.releaseSharedLock(key);
  }
}
