{
  OFile file;
  for (int i=0; i < files.length; ++i) {
    file=files[i];
    if (file.getFreeSpace() >= iRecordSize)     return new long[]{i,file.allocateSpace(iRecordSize)};
  }
  for (int i=0; i < files.length; ++i) {
    file=files[i];
    if (file.canOversize(iRecordSize)) {
      return new long[]{i,file.allocateSpace(iRecordSize)};
    }
  }
  if (maxSize > 0 && getSize() >= maxSize)   throw new OStorageException("Unable to allocate the requested space of " + iRecordSize + " bytes because the segment is full: max-Size="+ maxSize+ ", currentSize="+ getFilledUpTo());
  OFile[] newFiles=new OFile[files.length + 1];
  for (int i=0; i < files.length; ++i)   newFiles[i]=files[i];
  files=newFiles;
  file=createNewFile();
  file.allocateSpace(iRecordSize);
  config.root.update(-1);
  return new long[]{files.length - 1,0};
}
