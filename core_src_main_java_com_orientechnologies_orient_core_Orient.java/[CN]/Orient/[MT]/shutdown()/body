{
  acquireExclusiveLock();
  try {
    if (!active)     return;
    shutdownHook.cancel();
    OLogManager.instance().debug(this,"Orient Engine is shutting down...");
    ODatabaseDocumentPool.global().close();
    ODatabaseObjectPool.global().close();
    OGraphDatabasePool.global().close();
    databaseFactory.shutdown();
    final List<OStorage> storagesCopy=new ArrayList<OStorage>(storages.values());
    for (    OStorage stg : storagesCopy) {
      OLogManager.instance().debug(this,"Shutting down storage: " + stg.getName() + "...");
      stg.close(true);
    }
    OMMapManager.shutdown();
    active=false;
    threadGroup.interrupt();
    listeners.clear();
    OLogManager.instance().debug(this,"Orient Engine shutdown complete");
  }
  finally {
    releaseExclusiveLock();
  }
}
