{
  Object snapshotValue=snapshot.get(key);
  if (snapshotValue == null) {
    final OIdentifiable storedValue=indexEngine.get(key);
    final Set<OIdentifiable> values=new LinkedHashSet<OIdentifiable>();
    if (storedValue != null)     values.add(storedValue.getIdentity());
    values.add(value.getIdentity());
    snapshot.put(key,values);
  }
 else   if (snapshotValue instanceof Set) {
    final Set<OIdentifiable> values=(Set<OIdentifiable>)snapshotValue;
    values.add(value.getIdentity());
  }
 else {
    final Set<OIdentifiable> values=new LinkedHashSet<OIdentifiable>();
    values.add(value);
    snapshot.put(key,values);
  }
}
