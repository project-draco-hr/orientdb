{
  String[] urlParts=checkSyntax(iRequest.url,2,"Syntax error: database/<database>");
  iRequest.data.commandInfo="Database info";
  iRequest.data.commandDetail=urlParts[1];
  ODatabaseDocumentTx db=null;
  try {
    db=OSharedDocumentDatabase.acquireDatabase(urlParts[1]);
    final StringWriter buffer=new StringWriter();
    final OJSONWriter json=new OJSONWriter(buffer);
    json.beginObject();
    if (db.getMetadata().getSchema().getClasses() != null) {
      json.beginCollection(1,false,"classes");
      for (      OClass cls : db.getMetadata().getSchema().getClasses()) {
        json.beginObject(2,true,null);
        json.writeAttribute(3,true,"id",cls.getId());
        json.writeAttribute(3,true,"name",cls.getName());
        json.writeAttribute(3,true,"clusters",cls.getClusterIds());
        json.writeAttribute(3,true,"defaultCluster",cls.getDefaultClusterId());
        json.writeAttribute(3,false,"records",db.countClass(cls.getName()));
        if (cls.properties() != null && cls.properties().size() > 0) {
          json.beginCollection(3,true,"properties");
          for (          OProperty prop : cls.properties()) {
            json.beginObject(4,true,null);
            json.writeAttribute(4,true,"id",prop.getId());
            json.writeAttribute(4,true,"name",prop.getName());
            if (prop.getLinkedClass() != null)             json.writeAttribute(4,true,"linkedClass",prop.getLinkedClass().getName());
            if (prop.getLinkedType() != null)             json.writeAttribute(4,true,"linkedType",prop.getLinkedType());
            json.writeAttribute(4,true,"type",prop.getType().toString());
            json.writeAttribute(4,true,"min",prop.getMin());
            json.writeAttribute(4,true,"max",prop.getMax());
            json.endObject(3,true);
          }
          json.endCollection(1,true);
        }
        json.endObject(1,false);
      }
      json.endCollection(1,true);
    }
    if (db.getClusterNames() != null) {
      json.beginCollection(1,false,"clusters");
      for (      String clusterName : db.getClusterNames()) {
        json.beginObject(2,true,null);
        json.writeAttribute(3,false,"id",db.getClusterIdByName(clusterName));
        json.writeAttribute(3,false,"name",clusterName);
        json.writeAttribute(3,false,"type",db.getClusterIdByName(clusterName) > -1 ? "Physical" : "Logical");
        json.writeAttribute(3,false,"records",db.countClusterElements(clusterName));
        json.endObject(2,false);
      }
      json.endCollection(1,true);
    }
    json.beginCollection(1,false,"users");
    for (    OUser user : db.getMetadata().getSecurity().getUsers()) {
      json.beginObject(2,true,null);
      json.writeAttribute(3,false,"name",user.getName());
      json.writeAttribute(3,false,"roles",user.getRoles() != null ? Arrays.toString(user.getRoles().toArray()) : "null");
      json.endObject(2,false);
    }
    json.endCollection(1,true);
    json.beginCollection(1,false,"roles");
    for (    ORole role : db.getMetadata().getSecurity().getRoles()) {
      json.beginObject(2,true,null);
      json.writeAttribute(3,false,"name",role.getName());
      json.writeAttribute(3,false,"ACL","not supported yet");
      json.endObject(2,false);
    }
    json.endCollection(1,true);
    json.endObject();
    sendTextContent(iRequest,OHttpUtils.STATUS_OK_CODE,"OK",null,OHttpUtils.CONTENT_TEXT_PLAIN,buffer.toString());
  }
  finally {
    if (db != null)     OSharedDocumentDatabase.releaseDatabase(db);
  }
}
