{
  if (sendStarted)   return;
  sendStarted=true;
  final String content;
  final String contentType;
  if (callbackFunction != null) {
    content=callbackFunction + "(" + iContent+ ")";
    contentType="text/javascript";
  }
 else {
    content=iContent != null ? iContent.toString() : null;
    contentType=iContentType;
  }
  final boolean empty=content == null || content.length() == 0;
  writeStatus(empty && iCode == 200 ? 204 : iCode,iReason);
  writeHeaders(contentType,iKeepAlive);
  if (additionalHeaders != null)   for (  String h : additionalHeaders)   writeLine(h);
  if (iHeaders != null)   writeLine(iHeaders);
  final String sessId=sessionId != null ? sessionId : "-";
  writeLine("Set-Cookie: " + OHttpUtils.OSESSIONID + "="+ sessId+ "; Path=/; HttpOnly");
  byte[] binaryContent=null;
  if (!empty) {
    if (contentEncoding != null && contentEncoding.equals(OHttpUtils.CONTENT_ACCEPT_GZIP_ENCODED))     binaryContent=compress(content);
 else     binaryContent=OBinaryProtocol.string2bytes(content);
  }
  writeLine(OHttpUtils.HEADER_CONTENT_LENGTH + (empty ? 0 : binaryContent.length));
  writeLine(null);
  if (binaryContent != null)   out.write(binaryContent);
  out.flush();
}
