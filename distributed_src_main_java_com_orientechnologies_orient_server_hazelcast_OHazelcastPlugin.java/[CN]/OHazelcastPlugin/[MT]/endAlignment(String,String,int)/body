{
synchronized (pendingAlignments) {
    if (pendingAlignments.remove(iNode + "/" + iDatabaseName) == null) {
      ODistributedServerLog.error(this,getLocalNodeId(),iNode,DIRECTION.OUT,"received response for an alignment against an unknown node %s database %s",iDatabaseName);
    }
    if (pendingAlignments.isEmpty()) {
      setStatus("online");
      if (alignedOperations > 0) {
        ODistributedServerLog.error(this,getLocalNodeId(),iNode,DIRECTION.OUT,"aligned %d operations, schedule another realignment in %dms to get the new operations if any, database %s",alignedOperations,REALIGN_DELAY_TIME,iDatabaseName);
        Orient.instance().getTimer().schedule(new TimerTask(){
          @Override public void run(){
            broadcastAlignmentRequest();
          }
        }
,REALIGN_DELAY_TIME);
      }
    }
 else {
      for (      Entry<String,Boolean> entry : pendingAlignments.entrySet()) {
        final String[] parts=entry.getKey().split("/");
        final String node=parts[0];
        final String databaseName=parts[1];
        if (entry.getValue()) {
          final OStorageSynchronizer synch=synchronizers.get(databaseName);
          long[] lastOperationId;
          try {
            lastOperationId=synch.getLog().getLastJournaledOperationId(null);
            ODistributedServerLog.info(this,getLocalNodeId(),node,DIRECTION.OUT,"resend alignment request db=%s from %d:%d",databaseName,lastOperationId[0],lastOperationId[1]);
            sendTask2Node(node,new OAlignRequestTask(serverInstance,this,databaseName,lastOperationId[0],lastOperationId[1]),EXECUTION_MODE.ASYNCHRONOUS,new HashMap<String,Object>());
          }
 catch (          IOException e) {
            ODistributedServerLog.warn(this,getLocalNodeId(),null,DIRECTION.OUT,"error on retrieve last operation id from the log for db=%s",databaseName);
          }
        }
 else         ODistributedServerLog.info(this,getLocalNodeId(),node,DIRECTION.NONE,"db=%s is in alignment status yet, the node is not online yet",databaseName);
      }
    }
  }
}
