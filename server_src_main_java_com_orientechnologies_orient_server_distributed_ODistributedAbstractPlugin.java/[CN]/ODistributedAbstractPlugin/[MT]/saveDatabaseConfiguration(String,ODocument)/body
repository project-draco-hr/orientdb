{
synchronized (cachedDatabaseConfiguration) {
    final ODocument oldCfg=loadedDatabaseConfiguration.get(iDatabaseName);
    if (oldCfg != null && Arrays.equals(oldCfg.toStream(),cfg.toStream()))     return;
  }
  Integer oldVersion=cfg.field("version");
  if (oldVersion == null)   oldVersion=0;
  cfg.field("version",oldVersion.intValue() + 1);
  updateDatabaseConfiguration(iDatabaseName,cfg);
  loadedDatabaseConfiguration.put(iDatabaseName,cfg);
  FileOutputStream f=null;
  try {
    File file=getDistributedConfigFile(iDatabaseName);
    OLogManager.instance().config(this,"Saving distributed configuration file for database '%s' in: %s",iDatabaseName,file);
    f=new FileOutputStream(file);
    f.write(cfg.toJSON().getBytes());
  }
 catch (  Exception e) {
    OLogManager.instance().error(this,"Error on saving distributed configuration file",e);
  }
 finally {
    if (f != null)     try {
      f.close();
    }
 catch (    IOException e) {
    }
  }
}
