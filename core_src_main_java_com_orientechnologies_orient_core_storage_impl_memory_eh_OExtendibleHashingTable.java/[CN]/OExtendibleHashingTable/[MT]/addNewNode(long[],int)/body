{
  if (hashTreeTombstone >= 0) {
    long[] tombstone=hashTree[hashTreeTombstone];
    hashTree[hashTreeTombstone]=newNode;
    final int nodeIndex=hashTreeTombstone;
    if (tombstone != null)     hashTreeTombstone=(int)tombstone[0];
 else     hashTreeTombstone=-1;
    return nodeIndex;
  }
  if (hashTreeSize >= hashTree.length) {
    long[][] newHashTree=new long[hashTree.length << 1][];
    System.arraycopy(hashTree,0,newHashTree,0,hashTree.length);
    hashTree=newHashTree;
    newHashTree=null;
    byte[] newNodeLocalDepths=new byte[nodeLocalDepths.length << 1];
    System.arraycopy(nodeLocalDepths,0,newNodeLocalDepths,0,nodeLocalDepths.length);
    nodeLocalDepths=newNodeLocalDepths;
    newNodeLocalDepths=null;
  }
  hashTree[hashTreeSize]=newNode;
  nodeLocalDepths[hashTreeSize]=(byte)nodeLocalDepth;
  hashTreeSize++;
  return hashTreeSize - 1;
}
