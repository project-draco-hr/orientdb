{
  if (!(iConfig instanceof ODocument))   throw new OProcessException("Content in not a JSON");
  final ODocument foreach=getRequiredFieldOfClass(iConfig,"foreach",ODocument.class);
  final ODocument execute=getRequiredFieldOfClass(iConfig,"execute",ODocument.class);
  final Object result=iManager.process((ODocument)foreach,iContext,iReadOnly);
  if (!OMultiValue.isIterable(result))   throw new OProcessException("Result of 'foreach' block (" + foreach + ") must be iterable but found "+ result.getClass());
  final String executeBlockType=((ODocument)execute).field("type");
  int iterated=0;
  final List<Object> list=new ArrayList<Object>();
  for (  Object current : OMultiValue.getMultiValueIterable(result)) {
    if (current instanceof Map.Entry)     current=((Entry<?,?>)current).getValue();
    assignVariable(iContext,"current",current);
    final Object v=iManager.process(executeBlockType,execute,iContext,iReadOnly);
    if (v != null)     list.add(v);
    iterated++;
  }
  debug(iContext,"Iterated " + iterated + " items, returned "+ list.size());
  return list;
}
