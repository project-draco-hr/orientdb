{
  stateLock.acquireWriteLock();
  addUser();
  try {
    if (status == STATUS.CLOSED || !iUserName.equals(connectionUserName) || !iUserPassword.equals(connectionUserPassword) || this.tokens.isEmpty()) {
      connectionUserName=iUserName;
      connectionUserPassword=iUserPassword;
      connectionOptions=iOptions != null ? new HashMap<String,Object>(iOptions) : null;
      openRemoteDatabase();
      final OStorageConfiguration storageConfiguration=new OStorageRemoteConfiguration(this,recordFormat);
      storageConfiguration.load(iOptions);
      configuration=storageConfiguration;
      componentsFactory=new OCurrentStorageComponentsFactory(configuration);
    }
 else {
      reopenRemoteDatabase();
    }
  }
 catch (  Exception e) {
    if (e instanceof RuntimeException)     throw (RuntimeException)e;
 else     throw new OStorageException("Cannot open the remote storage: " + name,e);
  }
 finally {
    stateLock.releaseWriteLock();
  }
}
