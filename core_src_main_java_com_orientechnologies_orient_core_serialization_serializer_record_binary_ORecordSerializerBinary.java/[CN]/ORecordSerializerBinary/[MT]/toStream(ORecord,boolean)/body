{
  checkTypeODocument(iSource);
  final BytesContainer container=new BytesContainer();
  int pos=container.alloc(1);
  container.bytes[pos]=CURRENT_RECORD_VERSION;
  if (!OSerializationSetThreadLocal.checkAndAdd((ODocument)iSource)) {
    serializerByVersion[CURRENT_RECORD_VERSION].serialize((ODocument)iSource,container,true);
    OSerializationSetThreadLocal.setPartial((ODocument)iSource);
    return container.fitBytes();
  }
  try {
    serializerByVersion[CURRENT_RECORD_VERSION].serialize((ODocument)iSource,container,false);
  }
  finally {
    OSerializationSetThreadLocal.removeCheck((ODocument)iSource);
  }
  return container.fitBytes();
}
