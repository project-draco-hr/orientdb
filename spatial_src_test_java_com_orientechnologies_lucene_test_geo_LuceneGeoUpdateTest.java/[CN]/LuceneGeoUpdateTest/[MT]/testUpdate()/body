{
  OrientGraphNoTx graph=new OrientGraphNoTx("memory:doubleLucene");
  try {
    ODatabaseDocumentTx db=graph.getRawGraph();
    db.command(new OCommandSQL("create class City extends V")).execute();
    db.command(new OCommandSQL("create property City.location embedded OPoint")).execute();
    db.command(new OCommandSQL("CREATE INDEX City.location ON City(location) SPATIAL ENGINE LUCENE")).execute();
    db.command(new OCommandSQL("insert into City set name = 'Test' , location = ST_GeomFromText('POINT(-160.2075374 21.9029803)')")).execute();
    OIndex<?> index=db.getMetadata().getIndexManager().getIndex("City.location");
    db.command(new OCommandSQL("update City set name = 'Test' , location = ST_GeomFromText('POINT(12.5 41.9)')")).execute();
    Assert.assertEquals(index.getSize(),1);
  }
  finally {
    graph.drop();
  }
}
