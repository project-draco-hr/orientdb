{
  resetLastValidBackup();
  if (OScenarioThreadLocal.INSTANCE.get() == RUN_MODE.RUNNING_DISTRIBUTED) {
    return wrapped.commit(iTx,callback);
  }
  final ODistributedConfiguration dbCfg=dManager.getDatabaseConfiguration(getName());
  final String localNodeName=dManager.getLocalNodeName();
  checkNodeIsMaster(localNodeName,dbCfg);
  try {
    if (!dbCfg.isReplicationActive(null,localNodeName)) {
      ODistributedAbstractPlugin.runInDistributedMode(new Callable(){
        @Override public Object call() throws Exception {
          return wrapped.commit(iTx,callback);
        }
      }
);
    }
 else     return txManager.commit((ODatabaseDocumentTx)ODatabaseRecordThreadLocal.INSTANCE.get(),iTx,callback);
  }
 catch (  OValidationException e) {
    throw e;
  }
catch (  Exception e) {
    handleDistributedException("Cannot route TX operation against distributed node",e);
  }
  return null;
}
