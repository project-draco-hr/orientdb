{
  lock.acquireExclusiveLock();
  OChannelBinaryClient network=null;
  try {
    if (networkPool.size() > 0) {
      try {
        network=beginRequest(OChannelBinaryProtocol.REQUEST_DB_CLOSE);
      }
  finally {
        endRequest(network);
      }
    }
    setSessionId(-1);
    if (!checkForClose(iForce))     return;
    if (serviceThread != null) {
      serviceThread.sendShutdown();
      serviceThread.interrupt();
    }
synchronized (networkPool) {
      for (      OChannelBinaryClient n : networkPool)       n.close();
      networkPool.clear();
    }
    level2Cache.shutdown();
    super.close(iForce);
    status=STATUS.CLOSED;
    Orient.instance().unregisterStorage(this);
  }
 catch (  OException e) {
    throw e;
  }
catch (  Exception e) {
    OLogManager.instance().debug(this,"Error on closing remote connection: %s",network);
    closeChannel(network);
  }
 finally {
    lock.releaseExclusiveLock();
  }
}
