{
  OModifiableBoolean shutdownFlag=new OModifiableBoolean();
  ODatabaseDocumentInternal curDb=ODatabaseRecordThreadLocal.INSTANCE.get();
  OrientGraph graph=OGraphCommandExecutorSQLFactory.getGraph(false,shutdownFlag);
  try {
    return runInTx(graph,callBack);
  }
  finally {
    if (shutdownFlag.getValue())     graph.shutdown(false,false);
    ODatabaseRecordThreadLocal.INSTANCE.set(curDb);
  }
}
