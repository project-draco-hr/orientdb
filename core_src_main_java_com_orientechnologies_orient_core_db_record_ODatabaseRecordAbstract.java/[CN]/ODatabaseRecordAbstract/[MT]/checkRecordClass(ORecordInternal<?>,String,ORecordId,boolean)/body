{
  if (rid.clusterId > -1 && getStorageVersions().classesAreDetectedByClusterId() && isNew && record instanceof ORecordSchemaAwareAbstract) {
    final ORecordSchemaAwareAbstract recordSchemaAware=(ORecordSchemaAwareAbstract)record;
    final OClass recordClass=recordSchemaAware.getSchemaClass();
    final OClass clusterIdClass=metadata.getSchema().getClassByClusterId(rid.clusterId);
    if (recordClass == null && clusterIdClass != null || clusterIdClass == null && recordClass != null || (recordClass != null && !recordClass.equals(clusterIdClass)))     throw new OSchemaException("Record saved into cluster " + iClusterName + " should be saved with class "+ clusterIdClass+ " but saved with class "+ recordClass);
  }
}
