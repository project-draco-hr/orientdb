{
  ODatabaseDocumentTx db=new ODatabaseDocumentTx(url);
  db.open("admin","admin");
  db.begin();
  ODocument kim=new ODocument(db,"Profile").field("name","Kim").field("surname","Bauer");
  ODocument teri=new ODocument(db,"Profile").field("name","Teri").field("surname","Bauer");
  ODocument jack=new ODocument(db,"Profile").field("name","Jack").field("surname","Bauer");
  ((HashSet<ODocument>)jack.field("following",new HashSet<ODocument>()).field("following")).add(kim);
  ((HashSet<ODocument>)kim.field("following",new HashSet<ODocument>()).field("following")).add(teri);
  ((HashSet<ODocument>)teri.field("following",new HashSet<ODocument>()).field("following")).add(jack);
  jack.save();
  db.commit();
  db.close();
  db.open("admin","admin");
  ODocument loadedJack=db.load(jack.getIdentity());
  int jackLastVersion=loadedJack.getVersion();
  db.begin();
  loadedJack.field("occupation","agent");
  loadedJack.save();
  db.commit();
  Assert.assertTrue(jackLastVersion != loadedJack.getVersion());
  loadedJack=db.load(jack.getIdentity());
  Assert.assertTrue(jackLastVersion != loadedJack.getVersion());
  db.close();
  db.open("admin","admin");
  loadedJack=db.load(jack.getIdentity());
  Assert.assertTrue(jackLastVersion != loadedJack.getVersion());
  db.close();
}
