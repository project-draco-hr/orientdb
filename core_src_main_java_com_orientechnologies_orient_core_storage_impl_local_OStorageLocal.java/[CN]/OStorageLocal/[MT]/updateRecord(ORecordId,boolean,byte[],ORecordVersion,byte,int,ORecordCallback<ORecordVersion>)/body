{
  checkOpeness();
  modificationLock.requestModificationLock();
  try {
    lock.acquireExclusiveLock();
    try {
      final OCluster cluster=getClusterById(iRid.clusterId);
      if (txManager.isCommitting()) {
        return new OStorageOperationResult<ORecordVersion>(txManager.updateRecord(txManager.getCurrentTransaction().getId(),cluster,iRid,iContent,iVersion,iRecordType));
      }
 else {
        final OPhysicalPosition ppos=updateRecord(cluster,iRid,iContent,iVersion,iRecordType);
        if (ppos != null && (OGlobalConfiguration.NON_TX_RECORD_UPDATE_SYNCH.getValueAsBoolean() || clustersToSyncImmediately.contains(cluster.getName())))         synchRecordUpdate(cluster,ppos);
        final ORecordVersion returnValue=(ppos != null ? ppos.recordVersion : OVersionFactory.instance().createUntrackedVersion());
        if (iCallback != null)         iCallback.call(iRid,returnValue);
        return new OStorageOperationResult<ORecordVersion>(returnValue);
      }
    }
  finally {
      lock.releaseExclusiveLock();
    }
  }
  finally {
    modificationLock.releaseModificationLock();
  }
}
