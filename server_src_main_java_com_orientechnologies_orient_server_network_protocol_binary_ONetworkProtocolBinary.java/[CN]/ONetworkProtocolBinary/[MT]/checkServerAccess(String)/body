{
  if (connection.data.protocolVersion <= OChannelBinaryProtocol.PROTOCOL_VERSION_26) {
    if (connection.serverUser == null)     throw new OSecurityAccessException("Server user not authenticated.");
    if (!server.authenticate(connection.serverUser.name,null,iResource))     throw new OSecurityAccessException("User '" + connection.serverUser.name + "' cannot access to the resource ["+ iResource+ "]. Use another server user or change permission in the file config/orientdb-server-config.xml");
  }
 else {
    if (!connection.data.serverUser)     throw new OSecurityAccessException("Server user not authenticated.");
    if (!server.authenticate(connection.data.serverUsername,null,iResource))     throw new OSecurityAccessException("User '" + connection.data.serverUsername + "' cannot access to the resource ["+ iResource+ "]. Use another server user or change permission in the file config/orientdb-server-config.xml");
  }
}
