{
  if (writeAheadLog == null)   return null;
  OAtomicOperation operation=currentOperation.get();
  if (operation != null) {
    operation.incrementCounter();
    if (durableComponent != null)     acquireExclusiveLockTillOperationComplete(durableComponent);
    return operation;
  }
  final OOperationUnitId unitId=OOperationUnitId.generateId();
  final OLogSequenceNumber lsn=writeAheadLog.logAtomicOperationStartRecord(true,unitId);
  if (storage instanceof OIdentifiableStorage) {
    operation=new OAtomicOperation(lsn,unitId,readCache,writeCache,((OIdentifiableStorage)storage).getId());
  }
 else {
    operation=new OAtomicOperation(lsn,unitId,readCache,writeCache,-1);
  }
  currentOperation.set(operation);
  if (storage.getStorageTransaction() == null)   writeAheadLog.log(new ONonTxOperationPerformedWALRecord());
  if (durableComponent != null)   acquireExclusiveLockTillOperationComplete(durableComponent);
  return operation;
}
