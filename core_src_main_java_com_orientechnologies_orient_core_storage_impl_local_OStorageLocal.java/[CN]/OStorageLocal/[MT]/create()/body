{
  final long timer=OProfiler.getInstance().startChrono();
  addUser();
  cache.addUser();
  final boolean locked=acquireExclusiveLock();
  try {
    if (!configuration.isEmpty())     throw new OStorageException("Can't create new storage " + name + " because it already exists");
    open=true;
    File storageFolder=new File(storagePath);
    if (!storageFolder.exists())     storageFolder.mkdir();
    if (new File(storagePath + "/" + OStorage.DATA_DEFAULT_NAME+ ".0"+ ODataLocal.DEF_EXTENSION).exists())     throw new OStorageException("Can't create new storage " + name + " because it already exists");
    addDataSegment(OStorage.DATA_DEFAULT_NAME);
    addCluster(OStorage.CLUSTER_INTERNAL_NAME,OClusterLocal.TYPE);
    addCluster(OStorage.CLUSTER_INDEX_NAME,OClusterLocal.TYPE);
    defaultClusterId=addCluster(OStorage.CLUSTER_DEFAULT_NAME,OClusterLocal.TYPE);
    configuration.create();
    txManager.create();
  }
 catch (  OStorageException e) {
    close();
    throw e;
  }
catch (  IOException e) {
    close();
    throw new OStorageException("Error on creation of storage: " + name,e);
  }
 finally {
    releaseExclusiveLock(locked);
    OProfiler.getInstance().stopChrono("OStorageLocal.create",timer);
  }
}
