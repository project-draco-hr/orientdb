{
  List<OIdentifiable> rids=new ArrayList<OIdentifiable>();
  ORidBag bag=new ORidBag();
  assertEmbedded(bag.isEmbedded());
  bag.setAutoConvertToRecord(false);
  bag.add(new ORecordId("#77:2"));
  rids.add(new ORecordId("#77:2"));
  bag.add(new ORecordId("#77:2"));
  rids.add(new ORecordId("#77:2"));
  bag.add(new ORecordId("#77:3"));
  rids.add(new ORecordId("#77:3"));
  bag.add(new ORecordId("#77:4"));
  rids.add(new ORecordId("#77:4"));
  bag.add(new ORecordId("#77:4"));
  rids.add(new ORecordId("#77:4"));
  bag.add(new ORecordId("#77:4"));
  rids.add(new ORecordId("#77:4"));
  bag.add(new ORecordId("#77:5"));
  rids.add(new ORecordId("#77:5"));
  bag.add(new ORecordId("#77:6"));
  rids.add(new ORecordId("#77:6"));
  assertEmbedded(bag.isEmbedded());
  ODocument doc=new ODocument();
  doc.field("ridbag",bag);
  doc.save();
  ORID rid=doc.getIdentity();
  OStorage storage=database.getStorage();
  database.close();
  storage.close(true);
  database.open("admin","admin");
  doc=database.load(rid);
  doc.setLazyLoad(false);
  bag=doc.field("ridbag");
  assertEmbedded(bag.isEmbedded());
  bag.add(new ORecordId("#77:2"));
  rids.add(new ORecordId("#77:2"));
  bag.remove(new ORecordId("#77:4"));
  rids.remove(new ORecordId("#77:4"));
  bag.remove(new ORecordId("#77:4"));
  rids.remove(new ORecordId("#77:4"));
  bag.remove(new ORecordId("#77:2"));
  rids.remove(new ORecordId("#77:2"));
  bag.remove(new ORecordId("#77:2"));
  rids.remove(new ORecordId("#77:2"));
  bag.remove(new ORecordId("#77:7"));
  rids.remove(new ORecordId("#77:7"));
  bag.remove(new ORecordId("#77:8"));
  rids.remove(new ORecordId("#77:8"));
  bag.remove(new ORecordId("#77:8"));
  rids.remove(new ORecordId("#77:8"));
  bag.remove(new ORecordId("#77:8"));
  rids.remove(new ORecordId("#77:8"));
  assertEmbedded(bag.isEmbedded());
  for (  OIdentifiable identifiable : bag)   assertTrue(rids.remove(identifiable));
  assertTrue(rids.isEmpty());
  for (  OIdentifiable identifiable : bag)   rids.add(identifiable);
  doc.save();
  doc=database.load(rid);
  doc.setLazyLoad(false);
  bag=doc.field("ridbag");
  assertEmbedded(bag.isEmbedded());
  for (  OIdentifiable identifiable : bag)   assertTrue(rids.remove(identifiable));
  assertTrue(rids.isEmpty());
}
