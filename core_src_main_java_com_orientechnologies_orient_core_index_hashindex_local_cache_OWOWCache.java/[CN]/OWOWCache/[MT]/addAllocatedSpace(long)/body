{
  if (diff == 0)   return;
  allocatedSpace.addAndGet(diff);
  final long ts=System.currentTimeMillis();
  final long lastSpaceCheck=lastDiskSpaceCheck.get();
  if (ts - lastSpaceCheck > diskSizeCheckInterval) {
    final File storageDir=new File(storagePath);
    final long freeSpace=storageDir.getFreeSpace();
    final long effectiveFreeSpace=freeSpace - allocatedSpace.get();
    if (effectiveFreeSpace < freeSpaceLimit) {
      callLowSpaceListeners(new LowDiskSpaceInformation(effectiveFreeSpace,freeSpaceLimit));
    }
    lastDiskSpaceCheck.lazySet(ts);
  }
}
