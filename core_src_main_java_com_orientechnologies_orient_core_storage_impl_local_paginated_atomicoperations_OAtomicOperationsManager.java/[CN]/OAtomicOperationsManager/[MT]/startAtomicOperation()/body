{
  if (writeAheadLog == null)   return null;
  OAtomicOperation operation=currentOperation.get();
  if (operation != null) {
    operation.incrementCounter();
    return operation;
  }
  final OOperationUnitId unitId=OOperationUnitId.generateId();
  final OLogSequenceNumber lsn=writeAheadLog.log(new OAtomicUnitStartRecord(true,unitId));
  operation=new OAtomicOperation(lsn,unitId);
  currentOperation.set(operation);
  if (storage.getStorageTransaction() == null)   writeAheadLog.log(new ONonTxOperationPerformedWALRecord());
  return operation;
}
