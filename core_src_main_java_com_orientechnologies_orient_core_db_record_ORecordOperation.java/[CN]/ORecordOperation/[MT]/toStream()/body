{
  try {
    final OMemoryStream stream=new OMemoryStream();
    stream.set(serial);
    stream.set(type);
    ((ORecordId)record.getIdentity()).toStream(stream);
switch (type) {
case CREATED:
      stream.set(((ORecordInternal<?>)record.getRecord()).getRecordType());
    stream.set(((ORecordInternal<?>)record.getRecord()).toStream());
  stream.set(clusterName);
break;
case UPDATED:
stream.set(((ORecordInternal<?>)record.getRecord()).getRecordType());
stream.set(((ORecordInternal<?>)record.getRecord()).toStream());
break;
}
return stream.toByteArray();
}
 catch (Exception e) {
throw new OSerializationException("Cannot serialize record operation",e);
}
}
