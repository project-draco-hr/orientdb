{
  ORecord<?> record;
  if (key instanceof ORecord<?>) {
    record=(ORecord<?>)key;
    if (!record.getIdentity().isValid())     record.save();
  }
  if (value instanceof ORecord<?>) {
    record=(ORecord<?>)value;
    if (!record.getIdentity().isValid())     record.save();
  }
  insertCounter++;
  if (insertCounter > optimizeThreshold) {
    optimize();
    insertCounter=0;
  }
  return super.put(key,value);
}
