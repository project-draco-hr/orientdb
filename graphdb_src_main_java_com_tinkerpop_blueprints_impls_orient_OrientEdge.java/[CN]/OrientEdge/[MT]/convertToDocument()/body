{
  if (rawElement != null)   return;
  graph.setCurrentGraphInThreadLocal();
  graph.autoStartTransaction();
  final ODocument vOutRecord=vOut.getRecord();
  final ODocument vInRecord=vIn.getRecord();
  final ODocument doc=createDocument(label);
  doc.field(OrientBaseGraph.CONNECTION_OUT,settings.keepInMemoryReferences ? vOutRecord.getIdentity() : vOutRecord);
  doc.field(OrientBaseGraph.CONNECTION_IN,settings.keepInMemoryReferences ? vInRecord.getIdentity() : vInRecord);
  rawElement=doc;
  final boolean useVertexFieldsForEdgeLabels=settings.useVertexFieldsForEdgeLabels;
  final String outFieldName=OrientVertex.getConnectionFieldName(Direction.OUT,label,useVertexFieldsForEdgeLabels);
  OrientVertex.removeEdges(vOutRecord,outFieldName,vInRecord,false,useVertexFieldsForEdgeLabels);
  final String inFieldName=OrientVertex.getConnectionFieldName(Direction.IN,label,useVertexFieldsForEdgeLabels);
  OrientVertex.removeEdges(vInRecord,inFieldName,vOutRecord,false,useVertexFieldsForEdgeLabels);
  OrientVertex.createLink(vOutRecord,doc,outFieldName);
  OrientVertex.createLink(vInRecord,doc,inFieldName);
  doc.save();
  vOutRecord.save();
  vInRecord.save();
  vOut=null;
  vIn=null;
  label=null;
}
