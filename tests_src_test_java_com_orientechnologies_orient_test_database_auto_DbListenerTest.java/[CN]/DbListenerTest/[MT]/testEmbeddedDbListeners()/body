{
  if (database.getURL().startsWith("remote:"))   return;
  if (database.exists())   ODatabaseHelper.deleteDatabase(database,getStorageType());
  database.registerListener(new DbListener());
  int curOnclose=onClose;
  int curCreate=onCreate;
  int curDelete=onDelete;
  ODatabaseHelper.createDatabase(database,url,getStorageType());
  Assert.assertEquals(onCreate,curCreate + 1);
  database.open("admin","admin");
  Assert.assertEquals(onOpen,1);
  database.begin(TXTYPE.OPTIMISTIC);
  Assert.assertEquals(onBeforeTxBegin,1);
  database.newInstance().save();
  database.commit();
  Assert.assertEquals(onBeforeTxCommit,1);
  Assert.assertEquals(onAfterTxCommit,1);
  database.begin(TXTYPE.OPTIMISTIC);
  Assert.assertEquals(onBeforeTxBegin,2);
  database.newInstance().save();
  database.rollback();
  Assert.assertEquals(onBeforeTxRollback,1);
  Assert.assertEquals(onAfterTxRollback,1);
  ODatabaseHelper.deleteDatabase(database,getStorageType());
  Assert.assertEquals(onClose,curOnclose + 2);
  Assert.assertEquals(onDelete,curDelete + 1);
  ODatabaseHelper.createDatabase(database,url,getStorageType());
}
