{
  if (rebuildCompleted)   return false;
  final ODatabaseRecord database=ODatabaseRecordThreadLocal.INSTANCE.get();
  if (!OGlobalConfiguration.INDEX_AUTO_REBUILD_AFTER_NOTSOFTCLOSE.getValueAsBoolean())   return false;
  OStorage storage=database.getStorage();
  if (storage instanceof OStorageLocal)   return !((OStorageLocal)storage).wasClusterSoftlyClosed(OMetadataDefault.CLUSTER_INDEX_NAME);
 else   if (storage instanceof OLocalPaginatedStorage) {
    return ((OLocalPaginatedStorage)storage).wereDataRestoredAfterOpen();
  }
  return false;
}
