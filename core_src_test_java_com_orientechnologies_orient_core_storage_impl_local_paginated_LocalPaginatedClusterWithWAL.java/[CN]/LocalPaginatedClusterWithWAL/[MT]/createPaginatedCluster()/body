{
  storage=mock(OLocalPaginatedStorage.class);
  OStorageConfiguration storageConfiguration=mock(OStorageConfiguration.class);
  when(storageConfiguration.getContextConfiguration()).thenReturn(new OContextConfiguration());
  storageConfiguration.clusters=new ArrayList<OStorageClusterConfiguration>();
  storageConfiguration.fileTemplate=new OStorageSegmentConfiguration();
  storageConfiguration.binaryFormatVersion=Integer.MAX_VALUE;
  when(storageConfiguration.getLocaleInstance()).thenReturn(Locale.US);
  storageDir=buildDirectory + "/localPaginatedClusterWithWALTestOne";
  when(storage.getStoragePath()).thenReturn(storageDir);
  when(storage.getName()).thenReturn("localPaginatedClusterWithWALTestOne");
  when(storage.getComponentsFactory()).thenReturn(new OCurrentStorageComponentsFactory(storageConfiguration));
  when(storage.getVariableParser()).thenReturn(new OStorageVariableParser(storageDir));
  File buildDir=new File(buildDirectory);
  if (!buildDir.exists())   buildDir.mkdirs();
  File storageDirOneFile=new File(storageDir);
  if (!storageDirOneFile.exists())   storageDirOneFile.mkdirs();
  when(storage.getPerformanceStatisticManager()).thenReturn(new OPerformanceStatisticManager(storage,10000000,10000000));
  writeAheadLog=new ODiskWriteAheadLog(6000,-1,10 * 1024L * OWALPage.PAGE_SIZE,null,storage);
  writeCache=new OWOWCache(false,OGlobalConfiguration.DISK_CACHE_PAGE_SIZE.getValueAsInteger() * 1024,new OByteBufferPool(OGlobalConfiguration.DISK_CACHE_PAGE_SIZE.getValueAsInteger() * 1024),1000000,writeAheadLog,100,1648L * 1024 * 1024,2 * 1648L * 1024* 1024,storage,false,1);
  readCache=new O2QCache(1648L * 1024 * 1024,OGlobalConfiguration.DISK_CACHE_PAGE_SIZE.getValueAsInteger() * 1024,false,20);
  when(storage.getReadCache()).thenReturn(readCache);
  when(storage.getWriteCache()).thenReturn(writeCache);
  when(storage.getStorageTransaction()).thenReturn(null);
  when(storage.getWALInstance()).thenReturn(writeAheadLog);
  atomicOperationsManager=new OAtomicOperationsManager(storage);
  when(storage.getAtomicOperationsManager()).thenReturn(atomicOperationsManager);
  when(storage.getConfiguration()).thenReturn(storageConfiguration);
  when(storage.getMode()).thenReturn("rw");
  when(storageConfiguration.getDirectory()).thenReturn(storageDir);
  paginatedCluster=new OPaginatedCluster("testPaginatedClusterWithWALTest",storage);
  paginatedCluster.configure(storage,6,"testPaginatedClusterWithWALTest",buildDirectory,-1);
  paginatedCluster.create(-1);
}
