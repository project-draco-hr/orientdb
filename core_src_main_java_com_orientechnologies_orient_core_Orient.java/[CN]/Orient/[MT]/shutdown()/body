{
  getLock().lock();
  try {
    if (!active)     return this;
    active=false;
    workers.shutdown();
    OLogManager.instance().debug(this,"Orient Engine is shutting down...");
    for (    OOrientListener l : browseListeners()) {
      if (l != null)       l.onShutdown();
    }
    closeAllStorages();
    for (    OEngine engine : engines.values())     engine.shutdown();
    engines.clear();
    if (databaseFactory != null)     databaseFactory.shutdown();
    if (shutdownHook != null) {
      shutdownHook.cancel();
      shutdownHook=null;
    }
    if (OMMapManagerLocator.getInstance() != null)     OMMapManagerLocator.getInstance().shutdown();
    if (threadGroup != null)     threadGroup.interrupt();
    resetListeners();
    timer.purge();
    profiler.shutdown();
    if (memoryWatchDog != null) {
      memoryWatchDog.sendShutdown();
      try {
        memoryWatchDog.join();
      }
 catch (      InterruptedException e) {
      }
 finally {
        memoryWatchDog=null;
      }
    }
    OLogManager.instance().info(this,"OrientDB Engine shutdown complete");
    OLogManager.instance().flush();
  }
  finally {
    getLock().unlock();
  }
  return this;
}
