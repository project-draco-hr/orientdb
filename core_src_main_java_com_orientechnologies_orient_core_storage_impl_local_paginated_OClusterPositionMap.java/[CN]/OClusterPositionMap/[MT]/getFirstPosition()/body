{
  acquireSharedLock();
  try {
    OAtomicOperationsManager operationsManager=storage.getAtomicOperationsManager();
    operationsManager.acquireReadLock(this);
    try {
      OAtomicOperation atomicOperation=operationsManager.getCurrentOperation();
      final long filledUpTo=getFilledUpTo(atomicOperation,diskCache,fileId);
      for (long pageIndex=0; pageIndex < filledUpTo; pageIndex++) {
        OCacheEntry cacheEntry=loadPage(atomicOperation,fileId,pageIndex,false,diskCache);
        try {
          OClusterPositionMapBucket bucket=new OClusterPositionMapBucket(cacheEntry,getChangesTree(atomicOperation,cacheEntry));
          int bucketSize=bucket.getSize();
          for (int index=0; index < bucketSize; index++) {
            if (bucket.exists(index))             return pageIndex * OClusterPositionMapBucket.MAX_ENTRIES + index;
          }
        }
  finally {
          releasePage(atomicOperation,cacheEntry,diskCache);
        }
      }
      return ORID.CLUSTER_POS_INVALID;
    }
  finally {
      operationsManager.releaseReadLock(this);
    }
  }
  finally {
    releaseSharedLock();
  }
}
