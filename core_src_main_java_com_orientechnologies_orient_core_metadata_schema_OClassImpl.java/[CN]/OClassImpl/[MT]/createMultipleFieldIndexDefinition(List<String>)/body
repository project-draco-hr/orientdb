{
  final OIndexDefinition indexDefinition;
  final OCompositeIndexDefinition compositeIndex=new OCompositeIndexDefinition(name);
  for (  final String fieldName : fieldsToIndex) {
    final OProperty propertyToIndex=properties.get(fieldName.toLowerCase());
    final OType propertyType=propertyToIndex.getType();
    if (propertyType.equals(OType.EMBEDDEDLIST) || propertyType.equals(OType.EMBEDDEDSET) || propertyType.equals(OType.LINKSET)|| propertyType.equals(OType.LINKSET)|| propertyType.equals(OType.EMBEDDEDMAP)|| propertyType.equals(OType.LINKMAP))     throw new OIndexException("Collections are not supported in composite indexes");
    final OPropertyIndexDefinition propertyIndex=new OPropertyIndexDefinition(name,propertyToIndex.getName(),propertyType);
    compositeIndex.addIndex(propertyIndex);
  }
  indexDefinition=compositeIndex;
  return indexDefinition;
}
