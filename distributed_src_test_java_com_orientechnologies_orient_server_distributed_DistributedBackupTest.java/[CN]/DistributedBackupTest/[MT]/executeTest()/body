{
  OrientGraphFactory localFactory=new OrientGraphFactory("plocal:target/server0/databases/" + getDatabaseName());
  OrientGraphNoTx graphNoTx=localFactory.getNoTx();
  try {
    final long initialVertices=graphNoTx.countVertices();
    banner("START BACKUP ON SERVER 0...");
    final AtomicBoolean finished=new AtomicBoolean(false);
    final OutputStream out=new FileOutputStream("backup.zip");
    localFactory.getDatabase().backup(out,null,new Callable<Object>(){
      @Override public Object call() throws Exception {
        new Thread(new Runnable(){
          @Override public void run(){
            banner("DURING BACKUP CREATE VERTICES...");
            insertVertices();
            finished.set(true);
          }
        }
).start();
        while (!finished.get())         Thread.sleep(1000);
        return null;
      }
    }
,null,9,128000);
    banner("BACKUP FINISHED, WAIT 5 SECS FOR THE REALIGNMENT...");
    Thread.sleep(5000);
    banner("CHECKING IF ALL VERTICES ARE PROPAGATED TO THE NODE 0 THAT RUN THE BACKUP");
    graphNoTx.makeActive();
    Assert.assertEquals(graphNoTx.countVertices() - initialVertices,VERTICES);
  }
  finally {
    graphNoTx.shutdown();
  }
}
