{
  stateLock.acquireWriteLock();
  try {
    if (isFull)     incrementalRestoreFromIBUFile(inputStream);
 else {
      fullRestoreFromIBUFile(inputStream);
    }
    makeFullCheckpoint();
  }
  finally {
    stateLock.releaseWriteLock();
  }
}
