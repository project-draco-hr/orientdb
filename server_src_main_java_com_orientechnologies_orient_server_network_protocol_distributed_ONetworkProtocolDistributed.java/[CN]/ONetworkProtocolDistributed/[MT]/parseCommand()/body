{
  if (requestType < 80) {
    super.parseCommand();
    return;
  }
switch (requestType) {
case OChannelDistributedProtocol.REQUEST_DISTRIBUTED_HEARTBEAT:
    data.commandInfo="Keep-alive";
  lastHeartBeat=System.currentTimeMillis();
sendOk(0);
break;
case OChannelDistributedProtocol.REQUEST_DISTRIBUTED_CONNECT:
{
data.commandInfo="Cluster connection";
manager.receivedLeaderConnection(this);
sendOk(0);
Map<String,Long> storages=new HashMap<String,Long>();
for (OStorage stg : Orient.instance().getStorages()) {
storages.put(stg.getName(),stg.getVersion());
}
channel.writeInt(storages.size());
for (Entry<String,Long> s : storages.entrySet()) {
channel.writeString(s.getKey());
channel.writeLong(s.getValue());
}
break;
}
case OChannelDistributedProtocol.REQUEST_DISTRIBUTED_DB_SHARE_SENDER:
data.commandInfo="Share the database to a remote server";
try {
final String dbName=channel.readString();
final String dbUser=channel.readString();
final String dbPassword=channel.readString();
final String remoteServerURL=channel.readString();
final String remoteServerUser=channel.readString();
final String remoteServerPassword=channel.readString();
checkServerAccess("database.share");
final ODatabaseDocumentTx db=openDatabase(dbName,dbUser,dbPassword);
new ODatabaseExport(db,new OChannelBinaryOutputStream(channel),null);
sendOk(0);
}
 catch (Exception e) {
channel.clearInput();
}
 finally {
}
break;
case OChannelDistributedProtocol.REQUEST_DISTRIBUTED_DB_SHARE_RECEIVER:
data.commandInfo="Received a shared database from a remote server to install";
try {
final String dbName=channel.readString();
final String storageMode=channel.readString();
checkServerAccess("database.share");
final ODatabaseDocument db=createDatabase(dbName,storageMode);
new ODatabaseImport(db,new OChannelBinaryInputStream(channel),null);
sendOk(0);
}
 catch (Exception e) {
channel.clearInput();
}
 finally {
}
break;
case OChannelDistributedProtocol.REQUEST_DISTRIBUTED_DB_CONFIG:
{
data.commandInfo="Update db configuration from server node leader";
ODocument config=(ODocument)new ODocument().fromStream(channel.readBytes());
OLogManager.instance().warn(this,"Changed distributed server configuration:\n%s",config.toJSON("indent:2"));
sendOk(0);
break;
}
default :
data.commandInfo="Command not supported";
OLogManager.instance().error(this,"Request not supported. Code: " + requestType);
channel.clearInput();
sendError(clientTxId,null);
}
}
