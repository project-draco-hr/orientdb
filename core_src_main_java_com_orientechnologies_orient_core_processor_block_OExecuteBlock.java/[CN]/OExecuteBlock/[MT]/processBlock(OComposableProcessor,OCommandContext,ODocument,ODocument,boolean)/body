{
  final Object foreach=getField(iContext,iConfig,"foreach");
  String returnType=(String)getFieldOfClass(iContext,iConfig,"returnType",String.class);
  returnValue=null;
  if (returnType == null)   returnType="last";
 else   if ("list".equalsIgnoreCase(returnType))   returnValue=new ArrayList<Object>();
 else   if ("set".equalsIgnoreCase(returnType))   returnValue=new HashSet<Object>();
  int iterated=0;
  final Object beginClause=getField(iContext,iConfig,"begin");
  if (beginClause != null)   executeBlock(iManager,iContext,"begin",beginClause,iOutput,iReadOnly,returnType,returnValue);
  if (foreach != null) {
    Object result;
    if (foreach instanceof ODocument)     result=delegate("foreach",iManager,(ODocument)foreach,iContext,iOutput,iReadOnly);
 else     if (foreach instanceof Map)     result=((Map<?,?>)foreach).values();
 else     result=foreach;
    if (!OMultiValue.isIterable(result))     throw new OProcessException("Result of 'foreach' block (" + foreach + ") must be iterable but found "+ result.getClass());
    for (    Object current : OMultiValue.getMultiValueIterable(result)) {
      if (current instanceof Map.Entry)       current=((Entry<?,?>)current).getValue();
      assignVariable(iContext,"current",current);
      assignVariable(iContext,"currentIndex",iterated);
      debug(iContext,"Executing...");
      final Object doClause=getRequiredField(iContext,iConfig,"do");
      returnValue=executeDo(iManager,iContext,doClause,returnType,returnValue,iOutput,iReadOnly);
      debug(iContext,"Done");
      iterated++;
    }
  }
 else {
    debug(iContext,"Executing...");
    final Object doClause=getRequiredField(iContext,iConfig,"do");
    returnValue=executeDo(iManager,iContext,doClause,returnType,returnValue,iOutput,iReadOnly);
    debug(iContext,"Done");
  }
  final Object endClause=getField(iContext,iConfig,"end");
  if (endClause != null)   executeBlock(iManager,iContext,"end",endClause,iOutput,iReadOnly,returnType,returnValue);
  debug(iContext,"Executed %d iteration and returned type %s",iterated,returnType);
  return returnValue;
}
