{
  List<OBonsaiBucketPointer> buckets=listBuckets();
  OCacheEntry sysCacheEntry=loadPage(null,fileId,SYS_BUCKET.getPageIndex(),false);
  if (sysCacheEntry == null) {
    return;
  }
  sysCacheEntry.acquireExclusiveLock();
  try {
    final OSysBucket sysBucket=new OSysBucket(sysCacheEntry,null);
    OBonsaiBucketPointer oldFreeListHead=sysBucket.getFreeListHead();
    boolean check=true;
    while (check && oldFreeListHead.isValid()) {
      OCacheEntry cacheEntry=loadPage(null,fileId,oldFreeListHead.getPageIndex(),false);
      cacheEntry.acquireExclusiveLock();
      try {
        final OSBTreeBonsaiBucket<K,V> bucket=new OSBTreeBonsaiBucket<K,V>(cacheEntry,oldFreeListHead.getPageOffset(),keySerializer,valueSerializer,null);
        if (buckets.contains(oldFreeListHead)) {
          sysBucket.setFreeListHead(bucket.getFreeListPointer());
          sysBucket.setFreeListLength(sysBucket.freeListLength() - 1);
          oldFreeListHead=bucket.getFreeListPointer();
        }
 else         check=false;
      }
  finally {
        cacheEntry.releaseExclusiveLock();
        releasePage(null,cacheEntry);
      }
    }
    OBonsaiBucketPointer next=oldFreeListHead;
    OBonsaiBucketPointer prev=null;
    long len=sysBucket.freeListLength();
    for (long i=0; i < len && next.isValid(); i++) {
      OCacheEntry cacheEntry=loadPage(null,fileId,next.getPageIndex(),false);
      if (cacheEntry != null) {
        cacheEntry.acquireExclusiveLock();
        try {
          final OSBTreeBonsaiBucket<K,V> bucket=new OSBTreeBonsaiBucket<K,V>(cacheEntry,next.getPageOffset(),keySerializer,valueSerializer,null);
          if (buckets.contains(next)) {
            OCacheEntry cacheEntryNext=loadPage(null,fileId,prev.getPageIndex(),false);
            cacheEntry.acquireExclusiveLock();
            try {
              final OSBTreeBonsaiBucket<K,V> bucketPrev=new OSBTreeBonsaiBucket<K,V>(cacheEntryNext,prev.getPageOffset(),keySerializer,valueSerializer,null);
              bucketPrev.setFreeListPointer(bucket.getFreeListPointer());
              sysBucket.setFreeListLength(sysBucket.freeListLength() - 1);
            }
  finally {
              cacheEntryNext.releaseExclusiveLock();
              releasePage(null,cacheEntryNext);
            }
          }
 else {
            prev=next;
          }
          next=bucket.getFreeListPointer();
        }
  finally {
          cacheEntry.releaseExclusiveLock();
          releasePage(null,cacheEntry);
        }
      }
    }
  }
  finally {
    sysCacheEntry.releaseExclusiveLock();
    releasePage(null,sysCacheEntry);
  }
}
