{
  final ODatabaseDocumentInternal currentDB=ODatabaseRecordThreadLocal.INSTANCE.getIfDefined();
  try {
    final ODatabase<?> db=server.openDatabase(getSystemDatabaseName(),serverUser,"",null,true);
    try {
      final Object result=db.command(new OCommandSQL(sql)).execute(args);
      return callback.call(result);
    }
  finally {
      db.close();
    }
  }
  finally {
    if (currentDB != null)     ODatabaseRecordThreadLocal.INSTANCE.set(currentDB);
 else     ODatabaseRecordThreadLocal.INSTANCE.remove();
  }
}
