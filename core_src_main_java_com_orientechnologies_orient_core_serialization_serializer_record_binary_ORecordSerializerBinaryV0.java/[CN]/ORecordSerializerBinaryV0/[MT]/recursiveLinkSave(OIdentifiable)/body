{
  if (link instanceof ORID) {
    if (((ORID)link).isValid() && ((ORID)link).isNew()) {
      final ODatabaseRecord database=ODatabaseRecordThreadLocal.INSTANCE.get();
      ORecordInternal<?> record=link.getRecord();
      database.save(record);
      return record;
    }
  }
 else   if (link instanceof ORecordInternal<?>) {
    ORID rid=link.getIdentity();
    if (((ORecordInternal<?>)link).isDirty() || (rid.isTemporary())) {
      final ODatabaseRecord database=ODatabaseRecordThreadLocal.INSTANCE.get();
      if (database != null) {
        if (link instanceof ODocument) {
          final OClass schemaClass=((ODocument)link).getSchemaClass();
          database.save((ORecordInternal<?>)link,schemaClass != null ? database.getClusterNameById(schemaClass.getClusterForNewInstance()) : null);
        }
 else         database.save((ORecordInternal<?>)link);
      }
    }
  }
  return link;
}
