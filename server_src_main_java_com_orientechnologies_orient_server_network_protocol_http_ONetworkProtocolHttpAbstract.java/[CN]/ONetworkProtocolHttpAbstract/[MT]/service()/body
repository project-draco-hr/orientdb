{
  OProfiler.getInstance().updateStatistic("Server.requests",+1);
  ++data.totalRequests;
  data.commandInfo=null;
  data.commandDetail=null;
  long begin=System.currentTimeMillis();
  final String command;
  if (request.url.length() < 2) {
    command="";
  }
 else {
    final int sep=request.url.indexOf("/",1);
    command=sep == -1 ? request.url.substring(1) : request.url.substring(1,sep);
  }
  OServerCommand cmd=commands.get(request.method + COMMAND_SEPARATOR + command);
  if (cmd != null)   try {
    if (cmd.beforeExecute(request)) {
      cmd.execute(request);
    }
  }
 catch (  Exception e) {
    handleError(e);
  }
 else {
    try {
      OLogManager.instance().warn(this,"->" + channel.socket.getInetAddress().getHostAddress() + ": Command not found: "+ request.method+ "."+ command);
      sendTextContent(405,"Command '" + command + "' not found",null,OHttpUtils.CONTENT_TEXT_PLAIN,"Command not found: " + command);
    }
 catch (    IOException e1) {
      sendShutdown();
    }
  }
  data.lastCommandInfo=data.commandInfo;
  data.lastCommandDetail=data.commandDetail;
  data.lastCommandExecutionTime=System.currentTimeMillis() - begin;
  data.totalCommandExecutionTime+=data.lastCommandExecutionTime;
}
