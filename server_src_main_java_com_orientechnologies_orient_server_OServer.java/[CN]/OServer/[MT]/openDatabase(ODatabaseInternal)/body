{
  if (database.isClosed())   if (database.getStorage() instanceof ODirectMemoryStorage)   database.create();
 else {
    final OServerUserConfiguration replicatorUser=getUser(ODistributedAbstractPlugin.REPLICATOR_USER);
    try {
      serverLogin(replicatorUser.name,replicatorUser.password,"database.passthrough");
    }
 catch (    OSecurityException ex) {
      throw ex;
    }
    database.activateOnCurrentThread();
    database.resetInitialization();
    database.setProperty(ODatabase.OPTIONS.SECURITY.toString(),OSecurityServerUser.class);
    database.open(replicatorUser.name,replicatorUser.password);
  }
  return database;
}
