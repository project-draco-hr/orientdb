{
  makeActive();
  try {
    if (!database.isClosed()) {
      final OStorage storage=database.getStorage();
      if (storage instanceof OAbstractPaginatedStorage) {
        if (((OAbstractPaginatedStorage)storage).getWALInstance() != null)         database.commit();
      }
    }
  }
 catch (  RuntimeException e) {
    OLogManager.instance().error(this,"Error during context close for db " + url,e);
    throw e;
  }
catch (  Exception e) {
    OLogManager.instance().error(this,"Error during context close for db " + url,e);
    throw new OException("Error during context close for db " + url,e);
  }
 finally {
    try {
      if (closeDb)       database.close();
    }
 catch (    Exception e) {
      OLogManager.instance().error(this,"Error during context close for db " + url,e);
    }
  }
  url=null;
  username=null;
  password=null;
  pollGraphFromStack(closeDb);
}
