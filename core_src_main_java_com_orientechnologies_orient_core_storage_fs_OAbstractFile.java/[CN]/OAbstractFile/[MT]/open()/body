{
  acquireWriteLock();
  try {
    if (!osFile.exists())     throw new FileNotFoundException("File: " + osFile.getAbsolutePath());
    openChannel((int)osFile.length());
    OLogManager.instance().debug(this,"Checking file integrity of " + osFile.getName() + "...");
    init();
    final int fileSize=getFileSize();
    int filledUpTo=getFilledUpTo();
    if (filledUpTo > 0 && filledUpTo > fileSize) {
      OLogManager.instance().error(this,"invalid filledUp value (%d) for file %s. Resetting the file size %d to the os file size: %d. Probably the file was not closed correctly last time. Please assure the right number of records in the cluster",filledUpTo,getOsFile().getAbsolutePath(),fileSize,fileSize);
      setSize(fileSize);
      setFilledUpTo(fileSize);
      filledUpTo=getFilledUpTo();
    }
    if (filledUpTo > fileSize || filledUpTo < 0)     OLogManager.instance().error(this,"Invalid filledUp size (=" + filledUpTo + "). The file could be corrupted",null,OStorageException.class);
    if (failCheck) {
      boolean softlyClosed=isSoftlyClosed();
      if (softlyClosed)       setSoftlyClosed(false);
      return softlyClosed;
    }
    return true;
  }
  finally {
    releaseWriteLock();
  }
}
