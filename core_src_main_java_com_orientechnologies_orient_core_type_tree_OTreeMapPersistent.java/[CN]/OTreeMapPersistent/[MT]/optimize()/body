{
  final long timer=OProfiler.getInstance().startChrono();
  lock.acquireExclusiveLock();
  try {
    if (root == null)     return;
    int total=0;
    int currentDepthLevel;
    int maxDepthLevel=0;
    for (OTreeMapEntryPersistent<K,V> e=(OTreeMapEntryPersistent<K,V>)getFirstEntry(); e != null; e=(OTreeMapEntryPersistent<K,V>)OTreeMap.successor(e)) {
      currentDepthLevel=e.getDepth();
      if (currentDepthLevel <= 5)       continue;
      total++;
      if (currentDepthLevel > maxDepthLevel)       maxDepthLevel=currentDepthLevel;
    }
    final int cutLevel=(int)(maxDepthLevel * OPTIMIZE_FACTOR);
    for (OTreeMapEntryPersistent<K,V> e=(OTreeMapEntryPersistent<K,V>)getFirstEntry(); e != null; e=(OTreeMapEntryPersistent<K,V>)OTreeMap.successor(e)) {
      if (e.getDepth() > cutLevel)       e.clear();
    }
  }
  finally {
    lock.releaseExclusiveLock();
    OProfiler.getInstance().stopChrono("OTreeMapPersistent.optimize",timer);
  }
}
